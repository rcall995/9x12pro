<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Outreach Scripts - 9x12 Pro</title>
    <link rel="icon" type="image/png" href="/images/favicon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/config.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        .copy-btn:active, .edit-btn:active { transform: scale(0.95); }
        .template-card { transition: all 0.2s ease; }
        .template-card:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.1); }
        .sequence-step { position: relative; }
        .sequence-step:not(:last-child)::after {
            content: '';
            position: absolute;
            left: 24px;
            top: 48px;
            bottom: -24px;
            width: 2px;
            background: linear-gradient(to bottom, #8b5cf6, #c4b5fd);
        }
        .tab-btn.active { background: #8b5cf6; color: white; }
        pre, textarea { white-space: pre-wrap; word-wrap: break-word; }
        .editing pre { display: none; }
        .editing textarea { display: block !important; }
        textarea.template-edit {
            display: none;
            width: 100%;
            min-height: 150px;
            font-family: inherit;
            font-size: 0.875rem;
            padding: 0.75rem;
            border: 2px solid #8b5cf6;
            border-radius: 0.5rem;
            resize: vertical;
        }
        .placeholder {
            background: #fef3c7;
            padding: 0 4px;
            border-radius: 3px;
            font-weight: 600;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 via-white to-indigo-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-purple-100 sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <a href="/app.html" class="text-purple-600 hover:text-purple-800 transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                    </svg>
                </a>
                <h1 class="text-2xl font-bold bg-gradient-to-r from-purple-600 to-indigo-600 bg-clip-text text-transparent">
                    Outreach Scripts
                </h1>
            </div>
            <button onclick="toggleSettings()" class="flex items-center gap-2 px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium text-gray-700 transition-colors">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
                My Info
            </button>
        </div>
    </header>

    <!-- Settings Panel (collapsible) -->
    <div id="settingsPanel" class="hidden bg-white border-b border-purple-200 shadow-sm">
        <div class="max-w-6xl mx-auto px-4 py-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4">Your Info (auto-fills templates)</h3>
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
                <div>
                    <label class="block text-xs font-semibold text-gray-600 mb-1">Your Name</label>
                    <input type="text" id="settingName" class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg text-sm focus:border-purple-500 focus:outline-none" placeholder="John Smith">
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-600 mb-1">Company</label>
                    <input type="text" id="settingCompany" class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg text-sm focus:border-purple-500 focus:outline-none" placeholder="ABC Marketing">
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-600 mb-1">Phone</label>
                    <input type="text" id="settingPhone" class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg text-sm focus:border-purple-500 focus:outline-none" placeholder="(555) 123-4567">
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-600 mb-1">Spot Price</label>
                    <input type="text" id="settingPrice" class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg text-sm focus:border-purple-500 focus:outline-none" placeholder="$400">
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-600 mb-1">Area Name</label>
                    <input type="text" id="settingArea" class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg text-sm focus:border-purple-500 focus:outline-none" placeholder="Kenmore">
                </div>
                <div>
                    <label class="block text-xs font-semibold text-gray-600 mb-1">Home Count</label>
                    <input type="text" id="settingHomes" class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg text-sm focus:border-purple-500 focus:outline-none" placeholder="5,000">
                </div>
            </div>
            <div class="flex gap-3 mt-4">
                <button onclick="saveSettings()" class="px-4 py-2 bg-purple-600 text-white rounded-lg font-semibold text-sm hover:bg-purple-700 transition-colors">
                    Save & Apply
                </button>
                <button onclick="resetAllTemplates()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold text-sm hover:bg-gray-300 transition-colors">
                    Reset All Templates
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="max-w-6xl mx-auto px-4 py-8">
        <!-- Intro -->
        <div class="bg-gradient-to-r from-purple-600 to-indigo-600 rounded-2xl p-6 mb-8 text-white">
            <h2 class="text-xl font-bold mb-2">Complete Outreach Templates</h2>
            <p class="text-purple-100">Email, SMS, LinkedIn, Cold Calls, Walk-ins & more. Click the pencil to edit. Yellow = placeholders to customize.</p>
        </div>

        <!-- Tabs -->
        <div class="flex flex-wrap gap-2 mb-4">
            <button onclick="showTab('email')" class="tab-btn active px-4 py-2 rounded-lg font-semibold transition-all bg-gray-100 text-gray-700 hover:bg-purple-100">
                Email Sequence
            </button>
            <button onclick="showTab('social')" class="tab-btn px-4 py-2 rounded-lg font-semibold transition-all bg-gray-100 text-gray-700 hover:bg-purple-100">
                Social DMs
            </button>
            <button onclick="showTab('sms')" class="tab-btn px-4 py-2 rounded-lg font-semibold transition-all bg-gray-100 text-gray-700 hover:bg-purple-100">
                SMS/Text
            </button>
            <button onclick="showTab('linkedin')" class="tab-btn px-4 py-2 rounded-lg font-semibold transition-all bg-gray-100 text-gray-700 hover:bg-purple-100">
                LinkedIn
            </button>
            <button onclick="showTab('calls')" class="tab-btn px-4 py-2 rounded-lg font-semibold transition-all bg-gray-100 text-gray-700 hover:bg-purple-100">
                Cold Calls
            </button>
            <button onclick="showTab('walkin')" class="tab-btn px-4 py-2 rounded-lg font-semibold transition-all bg-gray-100 text-gray-700 hover:bg-purple-100">
                Walk-ins
            </button>
            <button onclick="showTab('objections')" class="tab-btn px-4 py-2 rounded-lg font-semibold transition-all bg-gray-100 text-gray-700 hover:bg-purple-100">
                Objection Handlers
            </button>
        </div>

        <!-- Campaign & Business Selector -->
        <div id="campaignSelector" class="bg-white border-2 border-purple-200 rounded-xl p-4 mb-8 space-y-3">
            <!-- Campaign Row -->
            <div class="flex flex-wrap items-center gap-4">
                <div class="flex items-center gap-2">
                    <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                    </svg>
                    <label class="font-semibold text-gray-700 w-28">Campaign:</label>
                </div>
                <select id="campaignDropdown" onchange="onCampaignSelect()" class="flex-1 min-w-[200px] px-4 py-2 border-2 border-gray-200 rounded-lg text-sm font-medium focus:border-purple-500 focus:outline-none">
                    <option value="">-- Choose a campaign to auto-fill --</option>
                </select>
                <div id="campaignInfo" class="hidden text-sm text-gray-600 bg-purple-50 px-3 py-2 rounded-lg">
                    <span id="campaignInfoText"></span>
                </div>
            </div>
            <!-- Business Row -->
            <div class="flex flex-wrap items-center gap-4">
                <div class="flex items-center gap-2">
                    <svg class="w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                    </svg>
                    <label class="font-semibold text-gray-700 w-28">Business:</label>
                </div>
                <select id="businessDropdown" onchange="onBusinessSelect()" class="flex-1 min-w-[200px] px-4 py-2 border-2 border-gray-200 rounded-lg text-sm font-medium focus:border-indigo-500 focus:outline-none">
                    <option value="">-- Select a business from your pipeline --</option>
                </select>
                <div id="businessInfo" class="hidden text-sm text-gray-600 bg-indigo-50 px-3 py-2 rounded-lg flex items-center gap-2">
                    <span id="businessInfoText"></span>
                </div>
                <button id="textBusinessBtn" onclick="textSelectedBusiness()" class="hidden px-3 py-2 bg-green-600 text-white rounded-lg text-sm font-semibold hover:bg-green-700 transition-colors flex items-center gap-1" title="Text via Google Voice">
                    üí¨ Text
                </button>
            </div>
            <p id="campaignLoginMsg" class="hidden text-sm text-amber-600 mt-2">
                <a href="/app.html" class="underline font-medium">Sign in to 9x12 Pro</a> to load your campaigns and pipeline
            </p>
        </div>

        <!-- EMAIL SEQUENCE TAB -->
        <div id="tab-email" class="tab-content">
            <div class="mb-6">
                <h3 class="text-lg font-bold text-gray-800 mb-2">The 4-Email Sequence</h3>
                <p class="text-gray-600 text-sm">Send these over 2-3 weeks. Most responses come after emails 2-4. Don't give up after one email!</p>
            </div>

            <div class="space-y-6">
                <!-- Email 1 -->
                <div class="sequence-step">
                    <div class="template-card bg-white rounded-xl border-2 border-purple-200 p-6 shadow-sm" data-template="email1">
                        <div class="flex items-start gap-4 mb-4">
                            <div class="w-12 h-12 bg-purple-600 rounded-full flex items-center justify-center text-white font-bold text-lg shrink-0">1</div>
                            <div class="flex-1">
                                <h4 class="font-bold text-gray-900">Initial Outreach</h4>
                                <p class="text-sm text-gray-500">Day 1 - First contact</p>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="toggleEdit('email1')" class="edit-btn p-2 text-gray-500 hover:text-purple-600 hover:bg-purple-50 rounded-lg transition-colors" title="Edit template">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
                                    </svg>
                                </button>
                                <button onclick="copyTemplate('email1')" class="copy-btn px-3 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors text-sm">
                                    Copy
                                </button>
                                <button onclick="openEmailTemplate('email1')" class="px-3 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 transition-colors text-sm">
                                    Open Email
                                </button>
                            </div>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4">
                            <div class="flex items-center gap-2 mb-2">
                                <p class="text-xs text-purple-600 font-semibold">SUBJECT:</p>
                                <select onchange="selectSubjectLine('email1', this.value)" class="subject-dropdown text-xs border border-purple-300 rounded px-2 py-1 bg-white text-gray-600 cursor-pointer hover:border-purple-500">
                                    <option value="">-- Pick a subject --</option>
                                </select>
                            </div>
                            <p class="text-sm text-gray-700 mb-4 template-subject" id="email1-subject"></p>
                            <input type="text" class="template-subject-edit hidden w-full px-3 py-2 border-2 border-purple-500 rounded-lg text-sm mb-4" id="email1-subject-edit">
                            <p class="text-xs text-purple-600 font-semibold mb-2">BODY:</p>
                            <pre class="text-sm text-gray-700 font-sans template-body" id="email1-body"></pre>
                            <textarea class="template-edit" id="email1-body-edit"></textarea>
                        </div>
                        <div class="edit-actions hidden mt-4 flex gap-2 justify-end">
                            <button onclick="cancelEdit('email1')" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold text-sm hover:bg-gray-300">Cancel</button>
                            <button onclick="saveTemplate('email1')" class="px-4 py-2 bg-green-600 text-white rounded-lg font-semibold text-sm hover:bg-green-700">Save Changes</button>
                        </div>
                    </div>
                </div>

                <!-- Email 2 -->
                <div class="sequence-step">
                    <div class="template-card bg-white rounded-xl border-2 border-purple-200 p-6 shadow-sm" data-template="email2">
                        <div class="flex items-start gap-4 mb-4">
                            <div class="w-12 h-12 bg-purple-500 rounded-full flex items-center justify-center text-white font-bold text-lg shrink-0">2</div>
                            <div class="flex-1">
                                <h4 class="font-bold text-gray-900">Follow-Up #1</h4>
                                <p class="text-sm text-gray-500">Day 3-5 - Gentle bump</p>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="toggleEdit('email2')" class="edit-btn p-2 text-gray-500 hover:text-purple-600 hover:bg-purple-50 rounded-lg transition-colors" title="Edit template">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
                                    </svg>
                                </button>
                                <button onclick="copyTemplate('email2')" class="copy-btn px-3 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors text-sm">
                                    Copy
                                </button>
                                <button onclick="openEmailTemplate('email2')" class="px-3 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 transition-colors text-sm">
                                    Open Email
                                </button>
                            </div>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4">
                            <div class="flex items-center gap-2 mb-2">
                                <p class="text-xs text-purple-600 font-semibold">SUBJECT:</p>
                                <select onchange="selectSubjectLine('email2', this.value)" class="subject-dropdown text-xs border border-purple-300 rounded px-2 py-1 bg-white text-gray-600 cursor-pointer hover:border-purple-500">
                                    <option value="">-- Pick a subject --</option>
                                </select>
                            </div>
                            <p class="text-sm text-gray-700 mb-4 template-subject" id="email2-subject"></p>
                            <input type="text" class="template-subject-edit hidden w-full px-3 py-2 border-2 border-purple-500 rounded-lg text-sm mb-4" id="email2-subject-edit">
                            <p class="text-xs text-purple-600 font-semibold mb-2">BODY:</p>
                            <pre class="text-sm text-gray-700 font-sans template-body" id="email2-body"></pre>
                            <textarea class="template-edit" id="email2-body-edit"></textarea>
                        </div>
                        <div class="edit-actions hidden mt-4 flex gap-2 justify-end">
                            <button onclick="cancelEdit('email2')" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold text-sm hover:bg-gray-300">Cancel</button>
                            <button onclick="saveTemplate('email2')" class="px-4 py-2 bg-green-600 text-white rounded-lg font-semibold text-sm hover:bg-green-700">Save Changes</button>
                        </div>
                    </div>
                </div>

                <!-- Email 3 -->
                <div class="sequence-step">
                    <div class="template-card bg-white rounded-xl border-2 border-purple-200 p-6 shadow-sm" data-template="email3">
                        <div class="flex items-start gap-4 mb-4">
                            <div class="w-12 h-12 bg-purple-400 rounded-full flex items-center justify-center text-white font-bold text-lg shrink-0">3</div>
                            <div class="flex-1">
                                <h4 class="font-bold text-gray-900">Follow-Up #2</h4>
                                <p class="text-sm text-gray-500">Day 7-10 - Add value</p>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="toggleEdit('email3')" class="edit-btn p-2 text-gray-500 hover:text-purple-600 hover:bg-purple-50 rounded-lg transition-colors" title="Edit template">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
                                    </svg>
                                </button>
                                <button onclick="copyTemplate('email3')" class="copy-btn px-3 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors text-sm">
                                    Copy
                                </button>
                                <button onclick="openEmailTemplate('email3')" class="px-3 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 transition-colors text-sm">
                                    Open Email
                                </button>
                            </div>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4">
                            <div class="flex items-center gap-2 mb-2">
                                <p class="text-xs text-purple-600 font-semibold">SUBJECT:</p>
                                <select onchange="selectSubjectLine('email3', this.value)" class="subject-dropdown text-xs border border-purple-300 rounded px-2 py-1 bg-white text-gray-600 cursor-pointer hover:border-purple-500">
                                    <option value="">-- Pick a subject --</option>
                                </select>
                            </div>
                            <p class="text-sm text-gray-700 mb-4 template-subject" id="email3-subject"></p>
                            <input type="text" class="template-subject-edit hidden w-full px-3 py-2 border-2 border-purple-500 rounded-lg text-sm mb-4" id="email3-subject-edit">
                            <p class="text-xs text-purple-600 font-semibold mb-2">BODY:</p>
                            <pre class="text-sm text-gray-700 font-sans template-body" id="email3-body"></pre>
                            <textarea class="template-edit" id="email3-body-edit"></textarea>
                        </div>
                        <div class="edit-actions hidden mt-4 flex gap-2 justify-end">
                            <button onclick="cancelEdit('email3')" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold text-sm hover:bg-gray-300">Cancel</button>
                            <button onclick="saveTemplate('email3')" class="px-4 py-2 bg-green-600 text-white rounded-lg font-semibold text-sm hover:bg-green-700">Save Changes</button>
                        </div>
                    </div>
                </div>

                <!-- Email 4 -->
                <div class="sequence-step">
                    <div class="template-card bg-white rounded-xl border-2 border-purple-200 p-6 shadow-sm" data-template="email4">
                        <div class="flex items-start gap-4 mb-4">
                            <div class="w-12 h-12 bg-purple-300 rounded-full flex items-center justify-center text-white font-bold text-lg shrink-0">4</div>
                            <div class="flex-1">
                                <h4 class="font-bold text-gray-900">Final Attempt</h4>
                                <p class="text-sm text-gray-500">Day 14+ - Last chance</p>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="toggleEdit('email4')" class="edit-btn p-2 text-gray-500 hover:text-purple-600 hover:bg-purple-50 rounded-lg transition-colors" title="Edit template">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
                                    </svg>
                                </button>
                                <button onclick="copyTemplate('email4')" class="copy-btn px-3 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors text-sm">
                                    Copy
                                </button>
                                <button onclick="openEmailTemplate('email4')" class="px-3 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 transition-colors text-sm">
                                    Open Email
                                </button>
                            </div>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4">
                            <div class="flex items-center gap-2 mb-2">
                                <p class="text-xs text-purple-600 font-semibold">SUBJECT:</p>
                                <select onchange="selectSubjectLine('email4', this.value)" class="subject-dropdown text-xs border border-purple-300 rounded px-2 py-1 bg-white text-gray-600 cursor-pointer hover:border-purple-500">
                                    <option value="">-- Pick a subject --</option>
                                </select>
                            </div>
                            <p class="text-sm text-gray-700 mb-4 template-subject" id="email4-subject"></p>
                            <input type="text" class="template-subject-edit hidden w-full px-3 py-2 border-2 border-purple-500 rounded-lg text-sm mb-4" id="email4-subject-edit">
                            <p class="text-xs text-purple-600 font-semibold mb-2">BODY:</p>
                            <pre class="text-sm text-gray-700 font-sans template-body" id="email4-body"></pre>
                            <textarea class="template-edit" id="email4-body-edit"></textarea>
                        </div>
                        <div class="edit-actions hidden mt-4 flex gap-2 justify-end">
                            <button onclick="cancelEdit('email4')" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold text-sm hover:bg-gray-300">Cancel</button>
                            <button onclick="saveTemplate('email4')" class="px-4 py-2 bg-green-600 text-white rounded-lg font-semibold text-sm hover:bg-green-700">Save Changes</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Customer Update Emails -->
            <div class="mt-8 mb-4">
                <h3 class="text-lg font-bold text-gray-800 mb-2">Customer Update Emails</h3>
                <p class="text-gray-600 text-sm">Emails for existing advertisers - renewals and campaign status updates.</p>
            </div>

            <div class="grid md:grid-cols-2 gap-6 mb-8">
                <!-- Renewal Request Email -->
                <div class="template-card bg-white rounded-xl border-2 border-blue-200 p-6 shadow-sm" data-template="email5">
                    <div class="flex items-start gap-4 mb-4">
                        <div class="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center text-white text-2xl shrink-0">üîÑ</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-gray-900">Renewal Request</h4>
                            <p class="text-sm text-gray-500">Ask customers to continue</p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="toggleEdit('email5')" class="edit-btn p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors" title="Edit">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>
                            </button>
                            <button onclick="copyTemplate('email5')" class="copy-btn px-3 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors text-sm">Copy</button>
                            <button onclick="openEmailTemplate('email5')" class="px-3 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors text-sm">Open Email</button>
                        </div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <p class="text-xs text-blue-600 font-semibold mb-2">SUBJECT:</p>
                        <p class="text-sm text-gray-700 mb-4 template-subject" id="email5-subject"></p>
                        <input type="text" class="template-subject-edit hidden w-full px-3 py-2 border-2 border-blue-500 rounded-lg text-sm mb-4" id="email5-subject-edit">
                        <p class="text-xs text-blue-600 font-semibold mb-2">BODY:</p>
                        <pre class="text-sm text-gray-700 font-sans template-body" id="email5-body"></pre>
                        <textarea class="template-edit" id="email5-body-edit"></textarea>
                    </div>
                    <div class="edit-actions hidden mt-4 flex gap-2 justify-end">
                        <button onclick="cancelEdit('email5')" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold text-sm">Cancel</button>
                        <button onclick="saveTemplate('email5')" class="px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold text-sm">Save</button>
                    </div>
                </div>

                <!-- Sent to Print Email -->
                <div class="template-card bg-white rounded-xl border-2 border-purple-200 p-6 shadow-sm" data-template="email6">
                    <div class="flex items-start gap-4 mb-4">
                        <div class="w-12 h-12 bg-purple-600 rounded-full flex items-center justify-center text-white text-2xl shrink-0">üñ®Ô∏è</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-gray-900">Sent to Print</h4>
                            <p class="text-sm text-gray-500">Card is at the printer</p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="toggleEdit('email6')" class="edit-btn p-2 text-gray-500 hover:text-purple-600 hover:bg-purple-50 rounded-lg transition-colors" title="Edit">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>
                            </button>
                            <button onclick="copyTemplate('email6')" class="copy-btn px-3 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors text-sm">Copy</button>
                            <button onclick="openEmailTemplate('email6')" class="px-3 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 transition-colors text-sm">Open Email</button>
                        </div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <p class="text-xs text-purple-600 font-semibold mb-2">SUBJECT:</p>
                        <p class="text-sm text-gray-700 mb-4 template-subject" id="email6-subject"></p>
                        <input type="text" class="template-subject-edit hidden w-full px-3 py-2 border-2 border-purple-500 rounded-lg text-sm mb-4" id="email6-subject-edit">
                        <p class="text-xs text-purple-600 font-semibold mb-2">BODY:</p>
                        <pre class="text-sm text-gray-700 font-sans template-body" id="email6-body"></pre>
                        <textarea class="template-edit" id="email6-body-edit"></textarea>
                    </div>
                    <div class="edit-actions hidden mt-4 flex gap-2 justify-end">
                        <button onclick="cancelEdit('email6')" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold text-sm">Cancel</button>
                        <button onclick="saveTemplate('email6')" class="px-4 py-2 bg-purple-600 text-white rounded-lg font-semibold text-sm">Save</button>
                    </div>
                </div>

                <!-- Dropped at Post Office Email -->
                <div class="template-card bg-white rounded-xl border-2 border-teal-200 p-6 shadow-sm" data-template="email7">
                    <div class="flex items-start gap-4 mb-4">
                        <div class="w-12 h-12 bg-teal-600 rounded-full flex items-center justify-center text-white text-2xl shrink-0">üì¨</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-gray-900">Dropped at Post Office</h4>
                            <p class="text-sm text-gray-500">Hitting mailboxes tomorrow</p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="toggleEdit('email7')" class="edit-btn p-2 text-gray-500 hover:text-teal-600 hover:bg-teal-50 rounded-lg transition-colors" title="Edit">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>
                            </button>
                            <button onclick="copyTemplate('email7')" class="copy-btn px-3 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors text-sm">Copy</button>
                            <button onclick="openEmailTemplate('email7')" class="px-3 py-2 bg-teal-600 text-white rounded-lg font-semibold hover:bg-teal-700 transition-colors text-sm">Open Email</button>
                        </div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <p class="text-xs text-teal-600 font-semibold mb-2">SUBJECT:</p>
                        <p class="text-sm text-gray-700 mb-4 template-subject" id="email7-subject"></p>
                        <input type="text" class="template-subject-edit hidden w-full px-3 py-2 border-2 border-teal-500 rounded-lg text-sm mb-4" id="email7-subject-edit">
                        <p class="text-xs text-teal-600 font-semibold mb-2">BODY:</p>
                        <pre class="text-sm text-gray-700 font-sans template-body" id="email7-body"></pre>
                        <textarea class="template-edit" id="email7-body-edit"></textarea>
                    </div>
                    <div class="edit-actions hidden mt-4 flex gap-2 justify-end">
                        <button onclick="cancelEdit('email7')" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold text-sm">Cancel</button>
                        <button onclick="saveTemplate('email7')" class="px-4 py-2 bg-teal-600 text-white rounded-lg font-semibold text-sm">Save</button>
                    </div>
                </div>

                <!-- Custom Email -->
                <div class="template-card bg-white rounded-xl border-2 border-gray-300 p-6 shadow-sm" data-template="email8">
                    <div class="flex items-start gap-4 mb-4">
                        <div class="w-12 h-12 bg-gray-600 rounded-full flex items-center justify-center text-white text-2xl shrink-0">‚úèÔ∏è</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-gray-900">Custom Email</h4>
                            <p class="text-sm text-gray-500">Write your own message</p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="toggleEdit('email8')" class="edit-btn p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors" title="Edit">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>
                            </button>
                            <button onclick="copyTemplate('email8')" class="copy-btn px-3 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors text-sm">Copy</button>
                            <button onclick="openEmailTemplate('email8')" class="px-3 py-2 bg-gray-600 text-white rounded-lg font-semibold hover:bg-gray-700 transition-colors text-sm">Open Email</button>
                        </div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <p class="text-xs text-gray-600 font-semibold mb-2">SUBJECT:</p>
                        <p class="text-sm text-gray-700 mb-4 template-subject" id="email8-subject"></p>
                        <input type="text" class="template-subject-edit hidden w-full px-3 py-2 border-2 border-gray-500 rounded-lg text-sm mb-4" id="email8-subject-edit">
                        <p class="text-xs text-gray-600 font-semibold mb-2">BODY:</p>
                        <pre class="text-sm text-gray-700 font-sans template-body" id="email8-body"></pre>
                        <textarea class="template-edit" id="email8-body-edit"></textarea>
                    </div>
                    <div class="edit-actions hidden mt-4 flex gap-2 justify-end">
                        <button onclick="cancelEdit('email8')" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold text-sm">Cancel</button>
                        <button onclick="saveTemplate('email8')" class="px-4 py-2 bg-gray-600 text-white rounded-lg font-semibold text-sm">Save</button>
                    </div>
                </div>
            </div>

            <!-- Pro Tips -->
            <div class="mt-8 bg-amber-50 border-2 border-amber-200 rounded-xl p-6">
                <h4 class="font-bold text-amber-800 mb-3">Pro Tips from the Pros</h4>
                <ul class="text-sm text-amber-900 space-y-2">
                    <li><strong>Don't give up after email 1.</strong> Most responses come from emails 2-4.</li>
                    <li><strong>Reply to your own thread.</strong> Keep subject line as "Re: ..." to stay in their inbox.</li>
                    <li><strong>Time your sends.</strong> Tuesday-Thursday mornings work best. Avoid Mondays and Fridays.</li>
                    <li><strong>The "breakup email" works.</strong> Email 4 often gets the most responses!</li>
                    <li><strong>Call after email 4.</strong> "Hey, I sent a few emails - wanted to make sure I'm a real person!"</li>
                </ul>
            </div>
        </div>

        <!-- SOCIAL DMs TAB -->
        <div id="tab-social" class="tab-content hidden">
            <div class="mb-6">
                <h3 class="text-lg font-bold text-gray-800 mb-2">Social Media DM Templates</h3>
                <p class="text-gray-600 text-sm">Facebook Messenger and Instagram. Keep it short and casual - these aren't emails!</p>
            </div>

            <div class="grid md:grid-cols-2 gap-6">
                <!-- Facebook Messenger -->
                <div class="template-card bg-white rounded-xl border-2 border-blue-200 p-6 shadow-sm" data-template="fb">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white text-xl">f</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-gray-900">Facebook Messenger</h4>
                            <p class="text-xs text-gray-500">Message business pages</p>
                        </div>
                        <button onclick="toggleEdit('fb')" class="edit-btn p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors" title="Edit">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>
                        </button>
                        <button onclick="copyTemplate('fb')" class="copy-btn px-3 py-1.5 bg-blue-600 text-white rounded-lg text-sm font-semibold hover:bg-blue-700 transition-colors">
                            Copy
                        </button>
                        <button id="openFacebookBtn" onclick="openFacebookPage()" class="hidden px-3 py-1.5 bg-blue-700 text-white rounded-lg text-sm font-semibold hover:bg-blue-800 transition-colors" title="Copy message & open their Facebook page">
                            Open FB
                        </button>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <pre class="text-sm text-gray-700 font-sans template-body" id="fb-body"></pre>
                        <textarea class="template-edit" id="fb-body-edit"></textarea>
                    </div>
                    <div class="edit-actions hidden mt-4 flex gap-2 justify-end">
                        <button onclick="cancelEdit('fb')" class="px-3 py-1.5 bg-gray-200 text-gray-700 rounded-lg font-semibold text-sm">Cancel</button>
                        <button onclick="saveTemplate('fb')" class="px-3 py-1.5 bg-green-600 text-white rounded-lg font-semibold text-sm">Save</button>
                    </div>
                </div>

                <!-- Instagram DM -->
                <div class="template-card bg-white rounded-xl border-2 border-pink-200 p-6 shadow-sm" data-template="ig">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-10 h-10 bg-gradient-to-br from-purple-600 via-pink-500 to-orange-400 rounded-full flex items-center justify-center text-white text-xl">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073z"/></svg>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-bold text-gray-900">Instagram DM</h4>
                            <p class="text-xs text-gray-500">No message limits!</p>
                        </div>
                        <button onclick="toggleEdit('ig')" class="edit-btn p-2 text-gray-500 hover:text-pink-600 hover:bg-pink-50 rounded-lg transition-colors" title="Edit">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>
                        </button>
                        <button onclick="copyTemplate('ig')" class="copy-btn px-3 py-1.5 bg-gradient-to-r from-purple-600 to-pink-500 text-white rounded-lg text-sm font-semibold hover:opacity-90 transition-opacity">
                            Copy
                        </button>
                        <button id="openInstagramBtn" onclick="openInstagramPage()" class="hidden px-3 py-1.5 bg-gradient-to-r from-purple-700 to-pink-600 text-white rounded-lg text-sm font-semibold hover:opacity-90 transition-opacity" title="Copy message & open their Instagram page">
                            Open IG
                        </button>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <pre class="text-sm text-gray-700 font-sans template-body" id="ig-body"></pre>
                        <textarea class="template-edit" id="ig-body-edit"></textarea>
                    </div>
                    <div class="edit-actions hidden mt-4 flex gap-2 justify-end">
                        <button onclick="cancelEdit('ig')" class="px-3 py-1.5 bg-gray-200 text-gray-700 rounded-lg font-semibold text-sm">Cancel</button>
                        <button onclick="saveTemplate('ig')" class="px-3 py-1.5 bg-green-600 text-white rounded-lg font-semibold text-sm">Save</button>
                    </div>
                </div>

                <!-- Facebook Follow-up -->
                <div class="template-card bg-white rounded-xl border-2 border-blue-200 p-6 shadow-sm" data-template="fb-followup">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white text-xl">f</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-gray-900">FB Follow-up</h4>
                            <p class="text-xs text-gray-500">If no response after 3-5 days</p>
                        </div>
                        <button onclick="toggleEdit('fb-followup')" class="edit-btn p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors" title="Edit">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>
                        </button>
                        <button onclick="copyTemplate('fb-followup')" class="copy-btn px-3 py-1.5 bg-blue-600 text-white rounded-lg text-sm font-semibold hover:bg-blue-700 transition-colors">
                            Copy
                        </button>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <pre class="text-sm text-gray-700 font-sans template-body" id="fb-followup-body"></pre>
                        <textarea class="template-edit" id="fb-followup-body-edit"></textarea>
                    </div>
                    <div class="edit-actions hidden mt-4 flex gap-2 justify-end">
                        <button onclick="cancelEdit('fb-followup')" class="px-3 py-1.5 bg-gray-200 text-gray-700 rounded-lg font-semibold text-sm">Cancel</button>
                        <button onclick="saveTemplate('fb-followup')" class="px-3 py-1.5 bg-green-600 text-white rounded-lg font-semibold text-sm">Save</button>
                    </div>
                </div>

                <!-- Instagram Follow-up -->
                <div class="template-card bg-white rounded-xl border-2 border-pink-200 p-6 shadow-sm" data-template="ig-followup">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-10 h-10 bg-gradient-to-br from-purple-500 via-pink-400 to-orange-300 rounded-full flex items-center justify-center text-white text-xl">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073z"/></svg>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-bold text-gray-900">IG Follow-up</h4>
                            <p class="text-xs text-gray-500">If no response after 3-5 days</p>
                        </div>
                        <button onclick="toggleEdit('ig-followup')" class="edit-btn p-2 text-gray-500 hover:text-pink-600 hover:bg-pink-50 rounded-lg transition-colors" title="Edit">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>
                        </button>
                        <button onclick="copyTemplate('ig-followup')" class="copy-btn px-3 py-1.5 bg-gradient-to-r from-purple-600 to-pink-500 text-white rounded-lg text-sm font-semibold hover:opacity-90 transition-opacity">
                            Copy
                        </button>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <pre class="text-sm text-gray-700 font-sans template-body" id="ig-followup-body"></pre>
                        <textarea class="template-edit" id="ig-followup-body-edit"></textarea>
                    </div>
                    <div class="edit-actions hidden mt-4 flex gap-2 justify-end">
                        <button onclick="cancelEdit('ig-followup')" class="px-3 py-1.5 bg-gray-200 text-gray-700 rounded-lg font-semibold text-sm">Cancel</button>
                        <button onclick="saveTemplate('ig-followup')" class="px-3 py-1.5 bg-green-600 text-white rounded-lg font-semibold text-sm">Save</button>
                    </div>
                </div>
            </div>

            <!-- Social Tips -->
            <div class="mt-8 bg-blue-50 border-2 border-blue-200 rounded-xl p-6">
                <h4 class="font-bold text-blue-800 mb-3">Social DM Tips</h4>
                <ul class="text-sm text-blue-900 space-y-2">
                    <li><strong>Message BUSINESS pages on Facebook</strong> - they go to Meta Business Suite, not "Message Requests"</li>
                    <li><strong>Instagram has NO message limits</strong> - unlike Facebook jail, you can send many more</li>
                    <li><strong>Keep it SHORT</strong> - DMs aren't emails. 2-4 sentences max.</li>
                    <li><strong>Night time works great</strong> - business owners check social after hours</li>
                </ul>
            </div>
        </div>

        <!-- SMS TAB -->
        <div id="tab-sms" class="tab-content hidden">
            <div class="mb-6">
                <h3 class="text-lg font-bold text-gray-800 mb-2">SMS / Text Templates</h3>
                <p class="text-gray-600 text-sm">Ultra short - like texting a friend. Only use if you have their mobile number.</p>
            </div>

            <div class="grid md:grid-cols-2 gap-6">
                <!-- SMS templates with edit buttons -->
                <div class="template-card bg-white rounded-xl border-2 border-green-200 p-6 shadow-sm" data-template="sms1">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-10 h-10 bg-green-600 rounded-full flex items-center justify-center text-white text-xl">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-bold text-gray-900">Initial Text</h4>
                            <p class="text-xs text-gray-500">First contact via SMS</p>
                        </div>
                        <button onclick="toggleEdit('sms1')" class="edit-btn p-2 text-gray-500 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors" title="Edit">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>
                        </button>
                        <button onclick="copyTemplate('sms1')" class="copy-btn px-3 py-1.5 bg-green-600 text-white rounded-lg text-sm font-semibold hover:bg-green-700 transition-colors">
                            Copy
                        </button>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <pre class="text-sm text-gray-700 font-sans template-body" id="sms1-body"></pre>
                        <textarea class="template-edit" id="sms1-body-edit"></textarea>
                    </div>
                    <div class="edit-actions hidden mt-4 flex gap-2 justify-end">
                        <button onclick="cancelEdit('sms1')" class="px-3 py-1.5 bg-gray-200 text-gray-700 rounded-lg font-semibold text-sm">Cancel</button>
                        <button onclick="saveTemplate('sms1')" class="px-3 py-1.5 bg-green-600 text-white rounded-lg font-semibold text-sm">Save</button>
                    </div>
                </div>

                <div class="template-card bg-white rounded-xl border-2 border-green-200 p-6 shadow-sm" data-template="sms2">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center text-white text-xl">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-bold text-gray-900">Text Follow-up</h4>
                            <p class="text-xs text-gray-500">If no response</p>
                        </div>
                        <button onclick="toggleEdit('sms2')" class="edit-btn p-2 text-gray-500 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors" title="Edit">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>
                        </button>
                        <button onclick="copyTemplate('sms2')" class="copy-btn px-3 py-1.5 bg-green-600 text-white rounded-lg text-sm font-semibold hover:bg-green-700 transition-colors">
                            Copy
                        </button>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <pre class="text-sm text-gray-700 font-sans template-body" id="sms2-body"></pre>
                        <textarea class="template-edit" id="sms2-body-edit"></textarea>
                    </div>
                    <div class="edit-actions hidden mt-4 flex gap-2 justify-end">
                        <button onclick="cancelEdit('sms2')" class="px-3 py-1.5 bg-gray-200 text-gray-700 rounded-lg font-semibold text-sm">Cancel</button>
                        <button onclick="saveTemplate('sms2')" class="px-3 py-1.5 bg-green-600 text-white rounded-lg font-semibold text-sm">Save</button>
                    </div>
                </div>

                <div class="template-card bg-white rounded-xl border-2 border-green-200 p-6 shadow-sm" data-template="sms3">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-10 h-10 bg-green-400 rounded-full flex items-center justify-center text-white text-xl">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-bold text-gray-900">After Email</h4>
                            <p class="text-xs text-gray-500">Text after sending emails</p>
                        </div>
                        <button onclick="toggleEdit('sms3')" class="edit-btn p-2 text-gray-500 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors" title="Edit">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>
                        </button>
                        <button onclick="copyTemplate('sms3')" class="copy-btn px-3 py-1.5 bg-green-600 text-white rounded-lg text-sm font-semibold hover:bg-green-700 transition-colors">
                            Copy
                        </button>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <pre class="text-sm text-gray-700 font-sans template-body" id="sms3-body"></pre>
                        <textarea class="template-edit" id="sms3-body-edit"></textarea>
                    </div>
                    <div class="edit-actions hidden mt-4 flex gap-2 justify-end">
                        <button onclick="cancelEdit('sms3')" class="px-3 py-1.5 bg-gray-200 text-gray-700 rounded-lg font-semibold text-sm">Cancel</button>
                        <button onclick="saveTemplate('sms3')" class="px-3 py-1.5 bg-green-600 text-white rounded-lg font-semibold text-sm">Save</button>
                    </div>
                </div>

                <div class="template-card bg-white rounded-xl border-2 border-green-200 p-6 shadow-sm" data-template="sms4">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-10 h-10 bg-amber-500 rounded-full flex items-center justify-center text-white text-xl">!</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-gray-900">Deadline Urgency</h4>
                            <p class="text-xs text-gray-500">When card is almost full</p>
                        </div>
                        <button onclick="toggleEdit('sms4')" class="edit-btn p-2 text-gray-500 hover:text-amber-600 hover:bg-amber-50 rounded-lg transition-colors" title="Edit">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>
                        </button>
                        <button onclick="copyTemplate('sms4')" class="copy-btn px-3 py-1.5 bg-green-600 text-white rounded-lg text-sm font-semibold hover:bg-green-700 transition-colors">
                            Copy
                        </button>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <pre class="text-sm text-gray-700 font-sans template-body" id="sms4-body"></pre>
                        <textarea class="template-edit" id="sms4-body-edit"></textarea>
                    </div>
                    <div class="edit-actions hidden mt-4 flex gap-2 justify-end">
                        <button onclick="cancelEdit('sms4')" class="px-3 py-1.5 bg-gray-200 text-gray-700 rounded-lg font-semibold text-sm">Cancel</button>
                        <button onclick="saveTemplate('sms4')" class="px-3 py-1.5 bg-green-600 text-white rounded-lg font-semibold text-sm">Save</button>
                    </div>
                </div>
            </div>

            <!-- Customer Updates Section -->
            <div class="mt-8 mb-4">
                <h3 class="text-lg font-bold text-gray-800 mb-2">Customer Updates</h3>
                <p class="text-gray-600 text-sm">Messages for existing advertisers - renewals and campaign status updates.</p>
            </div>

            <div class="grid md:grid-cols-2 gap-6">
                <!-- Renewal Request -->
                <div class="template-card bg-white rounded-xl border-2 border-blue-200 p-6 shadow-sm" data-template="sms5">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white text-xl">üîÑ</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-gray-900">Renewal Request</h4>
                            <p class="text-xs text-gray-500">Ask current customers to continue</p>
                        </div>
                        <button onclick="toggleEdit('sms5')" class="edit-btn p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors" title="Edit">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>
                        </button>
                        <button onclick="copyTemplate('sms5')" class="copy-btn px-3 py-1.5 bg-blue-600 text-white rounded-lg text-sm font-semibold hover:bg-blue-700 transition-colors">
                            Copy
                        </button>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <pre class="text-sm text-gray-700 font-sans template-body" id="sms5-body"></pre>
                        <textarea class="template-edit" id="sms5-body-edit"></textarea>
                    </div>
                    <div class="edit-actions hidden mt-4 flex gap-2 justify-end">
                        <button onclick="cancelEdit('sms5')" class="px-3 py-1.5 bg-gray-200 text-gray-700 rounded-lg font-semibold text-sm">Cancel</button>
                        <button onclick="saveTemplate('sms5')" class="px-3 py-1.5 bg-blue-600 text-white rounded-lg font-semibold text-sm">Save</button>
                    </div>
                </div>

                <!-- Sent to Print -->
                <div class="template-card bg-white rounded-xl border-2 border-purple-200 p-6 shadow-sm" data-template="sms6">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-10 h-10 bg-purple-600 rounded-full flex items-center justify-center text-white text-xl">üñ®Ô∏è</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-gray-900">Sent to Print</h4>
                            <p class="text-xs text-gray-500">Update: card is at the printer</p>
                        </div>
                        <button onclick="toggleEdit('sms6')" class="edit-btn p-2 text-gray-500 hover:text-purple-600 hover:bg-purple-50 rounded-lg transition-colors" title="Edit">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>
                        </button>
                        <button onclick="copyTemplate('sms6')" class="copy-btn px-3 py-1.5 bg-purple-600 text-white rounded-lg text-sm font-semibold hover:bg-purple-700 transition-colors">
                            Copy
                        </button>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <pre class="text-sm text-gray-700 font-sans template-body" id="sms6-body"></pre>
                        <textarea class="template-edit" id="sms6-body-edit"></textarea>
                    </div>
                    <div class="edit-actions hidden mt-4 flex gap-2 justify-end">
                        <button onclick="cancelEdit('sms6')" class="px-3 py-1.5 bg-gray-200 text-gray-700 rounded-lg font-semibold text-sm">Cancel</button>
                        <button onclick="saveTemplate('sms6')" class="px-3 py-1.5 bg-purple-600 text-white rounded-lg font-semibold text-sm">Save</button>
                    </div>
                </div>

                <!-- Dropped at Post Office -->
                <div class="template-card bg-white rounded-xl border-2 border-teal-200 p-6 shadow-sm" data-template="sms7">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-10 h-10 bg-teal-600 rounded-full flex items-center justify-center text-white text-xl">üì¨</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-gray-900">Dropped at Post Office</h4>
                            <p class="text-xs text-gray-500">Update: hitting mailboxes tomorrow</p>
                        </div>
                        <button onclick="toggleEdit('sms7')" class="edit-btn p-2 text-gray-500 hover:text-teal-600 hover:bg-teal-50 rounded-lg transition-colors" title="Edit">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>
                        </button>
                        <button onclick="copyTemplate('sms7')" class="copy-btn px-3 py-1.5 bg-teal-600 text-white rounded-lg text-sm font-semibold hover:bg-teal-700 transition-colors">
                            Copy
                        </button>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <pre class="text-sm text-gray-700 font-sans template-body" id="sms7-body"></pre>
                        <textarea class="template-edit" id="sms7-body-edit"></textarea>
                    </div>
                    <div class="edit-actions hidden mt-4 flex gap-2 justify-end">
                        <button onclick="cancelEdit('sms7')" class="px-3 py-1.5 bg-gray-200 text-gray-700 rounded-lg font-semibold text-sm">Cancel</button>
                        <button onclick="saveTemplate('sms7')" class="px-3 py-1.5 bg-teal-600 text-white rounded-lg font-semibold text-sm">Save</button>
                    </div>
                </div>

                <!-- Custom Message -->
                <div class="template-card bg-white rounded-xl border-2 border-gray-300 p-6 shadow-sm" data-template="sms8">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-10 h-10 bg-gray-600 rounded-full flex items-center justify-center text-white text-xl">‚úèÔ∏è</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-gray-900">Custom Message</h4>
                            <p class="text-xs text-gray-500">Write your own message</p>
                        </div>
                        <button onclick="toggleEdit('sms8')" class="edit-btn p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors" title="Edit">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>
                        </button>
                        <button onclick="copyTemplate('sms8')" class="copy-btn px-3 py-1.5 bg-gray-600 text-white rounded-lg text-sm font-semibold hover:bg-gray-700 transition-colors">
                            Copy
                        </button>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <pre class="text-sm text-gray-700 font-sans template-body" id="sms8-body"></pre>
                        <textarea class="template-edit" id="sms8-body-edit"></textarea>
                    </div>
                    <div class="edit-actions hidden mt-4 flex gap-2 justify-end">
                        <button onclick="cancelEdit('sms8')" class="px-3 py-1.5 bg-gray-200 text-gray-700 rounded-lg font-semibold text-sm">Cancel</button>
                        <button onclick="saveTemplate('sms8')" class="px-3 py-1.5 bg-gray-600 text-white rounded-lg font-semibold text-sm">Save</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- LinkedIn Tab -->
        <div id="tab-linkedin" class="tab-content hidden">
            <div class="mb-6">
                <h3 class="text-lg font-bold text-gray-800 mb-2">LinkedIn Outreach</h3>
                <p class="text-gray-600 text-sm">Professional networking messages for business owners. Connect first, then send a message.</p>
            </div>

            <div class="space-y-6">
                <!-- Connection Request -->
                <div class="template-card bg-white border-2 border-sky-200 rounded-xl p-5" data-template="linkedin1">
                    <div class="flex items-start justify-between mb-3">
                        <div>
                            <span class="inline-flex items-center gap-2 px-3 py-1 bg-sky-100 text-sky-700 rounded-full text-sm font-semibold mb-2">
                                Step 1: Connection Request
                            </span>
                            <h4 class="font-bold text-gray-800">Connection Note (300 char limit)</h4>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="toggleEdit('linkedin1')" class="edit-btn p-2 bg-sky-100 text-sky-600 rounded-lg hover:bg-sky-200 transition-colors">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
                                </svg>
                            </button>
                            <button onclick="copyTemplate('linkedin1')" class="copy-btn px-3 py-2 bg-sky-600 text-white rounded-lg font-semibold text-sm hover:bg-sky-700 transition-colors">
                                Copy
                            </button>
                        </div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <pre id="linkedin1-body" class="text-sm text-gray-700 font-sans template-body whitespace-pre-wrap"></pre>
                        <textarea id="linkedin1-body-edit" class="template-edit"></textarea>
                    </div>
                </div>

                <!-- First Message -->
                <div class="template-card bg-white border-2 border-sky-200 rounded-xl p-5" data-template="linkedin2">
                    <div class="flex items-start justify-between mb-3">
                        <div>
                            <span class="inline-flex items-center gap-2 px-3 py-1 bg-sky-100 text-sky-700 rounded-full text-sm font-semibold mb-2">
                                Step 2: After Connection
                            </span>
                            <h4 class="font-bold text-gray-800">Introduction Message</h4>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="toggleEdit('linkedin2')" class="edit-btn p-2 bg-sky-100 text-sky-600 rounded-lg hover:bg-sky-200 transition-colors">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
                                </svg>
                            </button>
                            <button onclick="copyTemplate('linkedin2')" class="copy-btn px-3 py-2 bg-sky-600 text-white rounded-lg font-semibold text-sm hover:bg-sky-700 transition-colors">
                                Copy
                            </button>
                            <button id="openLinkedInBtn" onclick="openLinkedInPage()" class="hidden px-3 py-2 bg-sky-700 text-white rounded-lg font-semibold text-sm hover:bg-sky-800 transition-colors" title="Copy message & open their LinkedIn profile">
                                Open LI
                            </button>
                        </div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <pre id="linkedin2-body" class="text-sm text-gray-700 font-sans template-body whitespace-pre-wrap"></pre>
                        <textarea id="linkedin2-body-edit" class="template-edit"></textarea>
                    </div>
                </div>

                <!-- Follow-up -->
                <div class="template-card bg-white border-2 border-sky-200 rounded-xl p-5" data-template="linkedin3">
                    <div class="flex items-start justify-between mb-3">
                        <div>
                            <span class="inline-flex items-center gap-2 px-3 py-1 bg-sky-100 text-sky-700 rounded-full text-sm font-semibold mb-2">
                                Step 3: Follow-up
                            </span>
                            <h4 class="font-bold text-gray-800">Follow-up Message</h4>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="toggleEdit('linkedin3')" class="edit-btn p-2 bg-sky-100 text-sky-600 rounded-lg hover:bg-sky-200 transition-colors">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
                                </svg>
                            </button>
                            <button onclick="copyTemplate('linkedin3')" class="copy-btn px-3 py-2 bg-sky-600 text-white rounded-lg font-semibold text-sm hover:bg-sky-700 transition-colors">
                                Copy
                            </button>
                        </div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <pre id="linkedin3-body" class="text-sm text-gray-700 font-sans template-body whitespace-pre-wrap"></pre>
                        <textarea id="linkedin3-body-edit" class="template-edit"></textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cold Calls Tab -->
        <div id="tab-calls" class="tab-content hidden">
            <div class="mb-6">
                <h3 class="text-lg font-bold text-gray-800 mb-2">Cold Call Scripts</h3>
                <p class="text-gray-600 text-sm">Structured scripts with clear sections. Practice the opener until it's natural!</p>
            </div>

            <div class="space-y-6">
                <!-- Main Cold Call Script -->
                <div class="template-card bg-white border-2 border-green-200 rounded-xl p-5" data-template="call1">
                    <div class="flex items-start justify-between mb-3">
                        <div>
                            <h4 class="font-bold text-gray-800">Main Cold Call Script</h4>
                            <p class="text-sm text-gray-500">Full conversation flow with objection handling</p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="toggleEdit('call1')" class="edit-btn p-2 bg-green-100 text-green-600 rounded-lg hover:bg-green-200 transition-colors">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
                                </svg>
                            </button>
                            <button onclick="copyTemplate('call1')" class="copy-btn px-3 py-2 bg-green-600 text-white rounded-lg font-semibold text-sm hover:bg-green-700 transition-colors">
                                Copy
                            </button>
                        </div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <pre id="call1-body" class="text-sm text-gray-700 font-sans template-body whitespace-pre-wrap"></pre>
                        <textarea id="call1-body-edit" class="template-edit"></textarea>
                    </div>
                </div>

                <!-- Voicemail Script -->
                <div class="template-card bg-white border-2 border-green-200 rounded-xl p-5" data-template="voicemail1">
                    <div class="flex items-start justify-between mb-3">
                        <div>
                            <h4 class="font-bold text-gray-800">Voicemail Script</h4>
                            <p class="text-sm text-gray-500">Short, curiosity-inducing voicemail (under 30 seconds)</p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="toggleEdit('voicemail1')" class="edit-btn p-2 bg-green-100 text-green-600 rounded-lg hover:bg-green-200 transition-colors">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
                                </svg>
                            </button>
                            <button onclick="copyTemplate('voicemail1')" class="copy-btn px-3 py-2 bg-green-600 text-white rounded-lg font-semibold text-sm hover:bg-green-700 transition-colors">
                                Copy
                            </button>
                        </div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <pre id="voicemail1-body" class="text-sm text-gray-700 font-sans template-body whitespace-pre-wrap"></pre>
                        <textarea id="voicemail1-body-edit" class="template-edit"></textarea>
                    </div>
                </div>

                <!-- Gatekeeper Script -->
                <div class="template-card bg-white border-2 border-green-200 rounded-xl p-5" data-template="gatekeeper1">
                    <div class="flex items-start justify-between mb-3">
                        <div>
                            <h4 class="font-bold text-gray-800">Gatekeeper Script</h4>
                            <p class="text-sm text-gray-500">When someone else answers the phone</p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="toggleEdit('gatekeeper1')" class="edit-btn p-2 bg-green-100 text-green-600 rounded-lg hover:bg-green-200 transition-colors">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
                                </svg>
                            </button>
                            <button onclick="copyTemplate('gatekeeper1')" class="copy-btn px-3 py-2 bg-green-600 text-white rounded-lg font-semibold text-sm hover:bg-green-700 transition-colors">
                                Copy
                            </button>
                        </div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <pre id="gatekeeper1-body" class="text-sm text-gray-700 font-sans template-body whitespace-pre-wrap"></pre>
                        <textarea id="gatekeeper1-body-edit" class="template-edit"></textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- Walk-ins Tab -->
        <div id="tab-walkin" class="tab-content hidden">
            <div class="mb-6">
                <h3 class="text-lg font-bold text-gray-800 mb-2">Walk-in Scripts</h3>
                <p class="text-gray-600 text-sm">Face-to-face pitches for stopping by businesses. Bring a sample postcard!</p>
            </div>

            <div class="space-y-6">
                <!-- Main Walk-in Script -->
                <div class="template-card bg-white border-2 border-orange-200 rounded-xl p-5" data-template="walkin1">
                    <div class="flex items-start justify-between mb-3">
                        <div>
                            <h4 class="font-bold text-gray-800">Quick Intro</h4>
                            <p class="text-sm text-gray-500">30-second pitch when they're busy</p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="toggleEdit('walkin1')" class="edit-btn p-2 bg-orange-100 text-orange-600 rounded-lg hover:bg-orange-200 transition-colors">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
                                </svg>
                            </button>
                            <button onclick="copyTemplate('walkin1')" class="copy-btn px-3 py-2 bg-orange-600 text-white rounded-lg font-semibold text-sm hover:bg-orange-700 transition-colors">
                                Copy
                            </button>
                        </div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <pre id="walkin1-body" class="text-sm text-gray-700 font-sans template-body whitespace-pre-wrap"></pre>
                        <textarea id="walkin1-body-edit" class="template-edit"></textarea>
                    </div>
                </div>

                <!-- Full Walk-in Pitch -->
                <div class="template-card bg-white border-2 border-orange-200 rounded-xl p-5" data-template="walkin2">
                    <div class="flex items-start justify-between mb-3">
                        <div>
                            <h4 class="font-bold text-gray-800">Full Pitch</h4>
                            <p class="text-sm text-gray-500">When they have time to talk</p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="toggleEdit('walkin2')" class="edit-btn p-2 bg-orange-100 text-orange-600 rounded-lg hover:bg-orange-200 transition-colors">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
                                </svg>
                            </button>
                            <button onclick="copyTemplate('walkin2')" class="copy-btn px-3 py-2 bg-orange-600 text-white rounded-lg font-semibold text-sm hover:bg-orange-700 transition-colors">
                                Copy
                            </button>
                        </div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <pre id="walkin2-body" class="text-sm text-gray-700 font-sans template-body whitespace-pre-wrap"></pre>
                        <textarea id="walkin2-body-edit" class="template-edit"></textarea>
                    </div>
                </div>

                <!-- Leave Behind Info -->
                <div class="template-card bg-white border-2 border-orange-200 rounded-xl p-5" data-template="leavebehind1">
                    <div class="flex items-start justify-between mb-3">
                        <div>
                            <h4 class="font-bold text-gray-800">Leave Behind Note</h4>
                            <p class="text-sm text-gray-500">Handwrite on back of your business card</p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="toggleEdit('leavebehind1')" class="edit-btn p-2 bg-orange-100 text-orange-600 rounded-lg hover:bg-orange-200 transition-colors">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
                                </svg>
                            </button>
                            <button onclick="copyTemplate('leavebehind1')" class="copy-btn px-3 py-2 bg-orange-600 text-white rounded-lg font-semibold text-sm hover:bg-orange-700 transition-colors">
                                Copy
                            </button>
                        </div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <pre id="leavebehind1-body" class="text-sm text-gray-700 font-sans template-body whitespace-pre-wrap"></pre>
                        <textarea id="leavebehind1-body-edit" class="template-edit"></textarea>
                    </div>
                </div>
            </div>
        </div>

        <div id="tab-objections" class="tab-content hidden">
            <div class="mb-6">
                <h3 class="text-lg font-bold text-gray-800 mb-2">Objection Handlers</h3>
                <p class="text-gray-600 text-sm">Quick responses to common pushback. Copy and customize as needed.</p>
            </div>

            <div class="space-y-4" id="objections-container">
                <!-- Objections will be rendered by JS -->
            </div>
        </div>
    </main>

    <!-- Toast -->
    <div id="toast" class="fixed bottom-4 left-1/2 transform -translate-x-1/2 px-6 py-3 bg-gray-900 text-white rounded-xl shadow-lg opacity-0 transition-opacity duration-300 pointer-events-none z-50">
        <span id="toast-message">Copied!</span>
    </div>

    <script>
        // Supabase client
        let supabaseClient = null;
        let campaigns = [];
        let pricingData = {}; // Stores home counts by mailer_id

        // Template version - increment to force reset old templates
        const TEMPLATE_VERSION = 7;

        // Initialize Supabase with retry
        function initSupabase() {
            console.log('üîß initSupabase called');
            console.log('  - window.supabase:', !!window.supabase);
            console.log('  - window.APP_CONFIG:', !!window.APP_CONFIG);

            if (window.supabase && window.APP_CONFIG) {
                supabaseClient = window.supabase.createClient(
                    window.APP_CONFIG.supabase.url,
                    window.APP_CONFIG.supabase.anonKey
                );
                console.log('‚úÖ Supabase client created');
                return true;
            }
            return false;
        }

        // Wait for dependencies to load
        async function waitForSupabase(maxAttempts = 20) {
            for (let i = 0; i < maxAttempts; i++) {
                if (initSupabase()) {
                    return true;
                }
                console.log(`‚è≥ Waiting for Supabase... attempt ${i + 1}`);
                await new Promise(resolve => setTimeout(resolve, 200));
            }
            console.error('‚ùå Supabase failed to initialize after max attempts');
            return false;
        }

        // Default templates (raw, before variable replacement)
        const DEFAULT_TEMPLATES = {
            email1: {
                subject: 'Quick question about [BUSINESS_NAME]',
                body: `Hi,

We send out a community postcard called "[POSTCARD_NAME]" that reaches [HOME_COUNT] homes in [AREA].

We're filling spots for our next mailing and [BUSINESS_NAME] would be a great fit. You'd be the only [CATEGORY] on the card.

Interested in the details?

[YOUR_NAME]`
            },
            email2: {
                subject: 'Re: Quick question about [BUSINESS_NAME]',
                body: `Hi,

Just following up on my note from a few days ago about [POSTCARD_NAME].

I know you're busy - just wanted to make sure this didn't get buried.

The [CATEGORY] spot is still open if you're interested.

Worth a quick look?

[YOUR_NAME]`
            },
            email3: {
                subject: '[CATEGORY] spot update - [POSTCARD_NAME]',
                body: `Hi,

Wanted to give you a quick update - we're getting close to sending [POSTCARD_NAME] to print.

A few things that might help:

- Your ad reaches [HOME_COUNT] homes in [AREA]
- You'd be the ONLY [CATEGORY] on the card
- We handle all the design work
- It's a fraction of the cost of solo mailers

If timing isn't right, no worries at all. Just let me know either way?

[YOUR_NAME]`
            },
            email4: {
                subject: 'Closing the loop - [BUSINESS_NAME]',
                body: `Hi,

I've reached out a few times about [POSTCARD_NAME] and haven't heard back, so I'll assume the timing isn't right.

No hard feelings at all - I'll take you off my list.

If things change down the road, feel free to reach out. We do these mailings regularly and would love to have [BUSINESS_NAME] on a future card.

All the best,
[YOUR_NAME]`
            },
            email5: {
                subject: 'Ready for the next postcard?',
                body: `Hi,

Hope [POSTCARD_NAME] has been working well for you!

We're putting together the next card now and wanted to reach out before offering your [CATEGORY] spot to someone else.

Want me to save your spot? Same price, same category exclusivity.

Just reply "yes" and I'll get you set up.

Thanks,
[YOUR_NAME]`
            },
            email6: {
                subject: '[POSTCARD_NAME] - Sent to Print!',
                body: `Hi,

Quick update - [POSTCARD_NAME] has been sent to the printer!

Target delivery date: [TARGET_DATE]

I'll send you another update when it's been dropped at the post office. Keep an eye out for calls once it hits mailboxes!

Thanks for advertising with us.

[YOUR_NAME]`
            },
            email7: {
                subject: '[POSTCARD_NAME] - Hitting Mailboxes Tomorrow!',
                body: `Hi,

Great news! [POSTCARD_NAME] was just dropped off at the post office and should hit mailboxes tomorrow.

This is when you'll start seeing results - keep an eye on your phone for new calls!

If you have any questions or want to get on the next card, just let me know.

Thanks again for advertising with us!

[YOUR_NAME]`
            },
            email8: {
                subject: '[SUBJECT]',
                body: `[CUSTOM_MESSAGE]`
            },
            fb: {
                body: `Hey! We put out a community postcard called [POSTCARD_NAME] that reaches [HOME_COUNT] homes in [AREA].

We're filling spots for the next one and thought [BUSINESS_NAME] would be a great fit. You'd be the only [CATEGORY] on it.

Would you want to see what it looks like?

- [YOUR_NAME]`
            },
            ig: {
                body: `Hey! Love what you're doing with [BUSINESS_NAME]!

We do a community postcard that reaches [HOME_COUNT] homes in [AREA] - thought you might be interested. You'd be the only [CATEGORY] featured.

Want to see it?`
            },
            'fb-followup': {
                body: `Hey just bumping this up - the [CATEGORY] spot is still open on [POSTCARD_NAME] if you're interested!

No pressure either way.`
            },
            'ig-followup': {
                body: `Hey! Just following up on my message about the postcard. Still have the [CATEGORY] spot open if you're interested!`
            },
            sms1: {
                body: `Hey! This is [YOUR_NAME]. We do a community postcard that hits [HOME_COUNT] homes in [AREA] and have the [CATEGORY] spot open. Interested?`
            },
            sms2: {
                body: `Hey just circling back on the postcard - still have the [CATEGORY] spot if you're interested. Let me know either way!`
            },
            sms3: {
                body: `Hey it's [YOUR_NAME] - sent you an email about [POSTCARD_NAME]. Just wanted to make sure it didn't go to spam!`
            },
            sms4: {
                body: `Hey! Quick heads up - [POSTCARD_NAME] goes to print Friday. Still have the [CATEGORY] spot if you want it. Let me know!`
            },
            sms5: {
                body: `Hey! Hope [POSTCARD_NAME] has been working well for you. We're putting together the next card now - want me to save your spot? Same price, same [CATEGORY] exclusivity.`
            },
            sms6: {
                body: `Quick update - [POSTCARD_NAME] has been sent to print! Target delivery date is [TARGET_DATE]. I'll let you know when it drops. Thanks for being on the card!`
            },
            sms7: {
                body: `Great news! [POSTCARD_NAME] was just dropped off at the post office and should hit mailboxes tomorrow. Keep an eye out for calls! Thanks again for advertising with us.`
            },
            sms8: {
                body: `[CUSTOM_MESSAGE]`
            },
            // LinkedIn templates
            linkedin1: {
                body: `Hi! Fellow local business owner here. I do community postcards that reach [HOME_COUNT] homes in [AREA]. Would love to connect!`
            },
            linkedin2: {
                body: `Thanks for connecting!

I run a community postcard called [POSTCARD_NAME] that reaches [HOME_COUNT] homes in [AREA]. We're filling spots for the next mailing and I thought [BUSINESS_NAME] would be a great fit.

You'd be the only [CATEGORY] on the card - no competing ads.

Would you be interested in seeing what it looks like?

[YOUR_NAME]`
            },
            linkedin3: {
                body: `Hey! Just wanted to bump this - still have the [CATEGORY] spot open on [POSTCARD_NAME] if you're interested.

Happy to answer any questions. No pressure either way!`
            },
            // Cold call templates
            call1: {
                body: `=== OPENER ===
Hi, is this [BUSINESS_NAME]? Great! This is [YOUR_NAME]. I do a community postcard that goes out to [HOME_COUNT] homes in [AREA] - got a quick second?

=== PITCH (if they say yes) ===
Perfect. So basically, we put together a 9x12 postcard with local businesses like yours and mail it to every home in [AREA]. You'd be the only [CATEGORY] on it, so no competition.

The spot is [SPOT_PRICE] and we handle all the design work. Sound like something you'd be interested in?

=== IF INTERESTED ===
Great! I can email you some info and a sample. What's the best email for you?

=== IF NOT INTERESTED ===
No worries at all. Mind if I ask - is it the timing or just not a fit for your business right now?

=== COMMON OBJECTIONS ===
"Too expensive" ‚Üí Actually it's way cheaper than doing your own mailer. You're sharing the cost with other businesses but getting exclusive [CATEGORY] placement.

"Doesn't work" ‚Üí A lot of businesses say that about solo mailers. This is different - it's a trusted community card people actually keep.

"Too busy" ‚Üí Totally get it. Can I send you info to look at when you have a minute?`
            },
            voicemail1: {
                body: `Hi, this is [YOUR_NAME] calling about a local advertising opportunity. We do a community postcard that reaches [HOME_COUNT] homes in [AREA] and have the [CATEGORY] spot open. Give me a call back at [YOUR_PHONE] when you get a chance. Thanks!`
            },
            gatekeeper1: {
                body: `Hi! I'm [YOUR_NAME] with [YOUR_COMPANY]. I'm reaching out about a local advertising opportunity - is the owner available?

IF "What's this regarding?":
We do a community postcard that goes to [HOME_COUNT] homes in [AREA]. I wanted to see if they'd be interested in the [CATEGORY] spot.

IF "They're not available":
No problem! When would be a better time to call back? Or could I leave my number?`
            },
            // Walk-in templates
            walkin1: {
                body: `Hi! I'm [YOUR_NAME]. I do a community postcard called [POSTCARD_NAME] that goes out to [HOME_COUNT] homes in [AREA].

(Show sample postcard)

I've got the [CATEGORY] spot open - you'd be the only one on the card.

Got a business card? I'll send you the details!`
            },
            walkin2: {
                body: `Hi there! Is the owner around?

(If yes) Great! I'm [YOUR_NAME] and I put together this community postcard called [POSTCARD_NAME].

(Show sample postcard)

It goes out to [HOME_COUNT] homes right here in [AREA]. Each business gets their own section and you'd be the only [CATEGORY] on it.

The spot is [SPOT_PRICE] and I handle all the design work - you just tell me what you want it to say.

A lot of local businesses have seen great results - people actually keep these cards and refer back to them.

Would you be interested in being on the next one?`
            },
            leavebehind1: {
                body: `Stopped by to chat about [POSTCARD_NAME] - a community postcard hitting [HOME_COUNT] [AREA] homes.

[CATEGORY] spot is open!

[YOUR_NAME]
[YOUR_PHONE]`
            }
        };

        const DEFAULT_OBJECTIONS = [
            { id: 'obj1', objection: "I don't have the budget right now", response: "That's exactly why this works so well. Instead of covering the full cost of mailing on your own - which would be thousands - each business shares the expense. You're reaching [HOME_COUNT] local homes at a fraction of what solo direct mail would cost. Most of our advertisers see ROI with just 2-3 new customers." },
            { id: 'obj2', objection: "Does direct mail still work in 2025?", response: "Absolutely! Here's the thing - people get only 2-3 pieces of mail per day, but they scroll past thousands of online ads and only notice about 100. That means your postcard doesn't have to fight for attention. There's less noise, more attention, and a tangible presence they can't just scroll past or block." },
            { id: 'obj3', objection: "I tried direct mail before and it didn't work", response: "Solo direct mail is expensive and risky. This is different - you're part of a trusted community mailer that homeowners actually look at. Plus your cost is so low that even 2-3 new customers makes it profitable. And you're the only [CATEGORY] on the card, so there's no competition for attention." },
            { id: 'obj4', objection: "How do I know people will see my ad?", response: "Great question! The 6.5x12 inch size is required by USPS to be delivered with regular mail - it can't be thrown away by the carrier. Plus, being alongside other trusted local businesses increases engagement. People actually keep these cards as local directories and refer back to them when they need services." },
            { id: 'obj5', objection: "I just do word of mouth / referrals", response: "Word of mouth is the best! This actually helps with that - when your name is in front of [HOME_COUNT] households, people remember you when their neighbor asks for a recommendation. It's like priming the pump for referrals. You become the name that comes to mind." },
            { id: 'obj6', objection: "I already do Facebook/Google ads", response: "Those are great for people actively searching! This hits a different audience - the people who WOULD use a [CATEGORY] but aren't actively looking yet. The average person sees 2-3 pieces of mail daily vs thousands of digital ads. Most successful businesses do both - digital for active searchers, mail for brand awareness." },
            { id: 'obj7', objection: "I'm too busy / have too much work already", response: "That's a great problem to have! A lot of our advertisers use these mailings to stay visible during their slow season, or to be picky about jobs. When you're in front of [HOME_COUNT] homes regularly, you can choose the jobs you want instead of taking everything that comes in." },
            { id: 'obj8', objection: "Send me some info and I'll think about it", response: "Absolutely! What's the best email? I'll send that right over. Just so I know how to follow up - are you looking at this for the upcoming mailing or more for down the road? The [POSTCARD_NAME] goes to print soon so I want to make sure you don't miss the deadline if you're interested." },
            { id: 'obj9', objection: "How do I know this actually works?", response: "Great question. We've had businesses advertise with us who renew month after month because they see results. I can put you in touch with a current advertiser if you want to hear it directly from them. Or you could try one mailing and see for yourself - no long-term commitment required." },
            { id: 'obj10', objection: "What if I don't get any calls?", response: "Direct mail is about consistent presence, not just one-time hits. Most advertisers see the best results after 2-3 mailings when people start recognizing their name. That said, your cost is low enough that even 1-2 new customers covers your investment. And there's no long-term contract - try one and see how it goes." }
        ];

        // Subject line options for variety
        const SUBJECT_LINE_OPTIONS = [
            '[AREA] postcard - [CATEGORY] spot',
            '[BUSINESS_NAME] + [HOME_COUNT] mailboxes',
            'Idea for [BUSINESS_NAME]',
            '[AREA] homeowners',
            '[BUSINESS_NAME]',
            'Postcard going out to [AREA]',
            'Your [CATEGORY] spot in [AREA]',
            '[HOME_COUNT] [AREA] homes',
            'Quick question for [BUSINESS_NAME]',
            '[CATEGORY] advertising in [AREA]',
            'Local postcard opportunity',
            'Re: [AREA] community card'
        ];

        // State
        let settings = {
            yourName: '',
            yourCompany: '',
            yourPhone: '',
            spotPrice: '$400',
            zipCode: '',      // Actual ZIP code like "14217"
            areaName: '',     // Area/town name like "Kenmore"
            homeCount: '5,000',
            postcardName: '',
            businessName: '',  // Selected business name
            category: '',      // Selected business category
            businessPhone: '', // Selected business phone number
            businessEmail: '', // Selected business email
            businessFacebook: '', // Selected business Facebook URL
            businessInstagram: '', // Selected business Instagram URL
            businessLinkedIn: '' // Selected business LinkedIn URL
        };
        let templates = {};
        let objections = [];
        let pipelineBusinesses = []; // Businesses from kanban pipeline
        let currentTab = 'email'; // Track current tab for filtering
        let currentUserEmail = null; // For cloud sync

        // Load on page load
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üìÑ Outreach Scripts page loaded');

            loadSettings();
            loadTemplates();
            loadObjections();
            renderAllTemplates();
            renderObjections();

            // Initialize Supabase with retry and load campaigns
            const supabaseReady = await waitForSupabase();
            if (supabaseReady) {
                await checkAuthAndLoadCampaigns();
            } else {
                document.getElementById('campaignLoginMsg').classList.remove('hidden');
                document.getElementById('campaignLoginMsg').innerHTML = 'Failed to connect to database. <a href="/app.html" class="underline font-medium">Return to app</a>';
            }
        });

        // Check authentication and load campaigns
        async function checkAuthAndLoadCampaigns() {
            console.log('üîê Checking authentication...');
            try {
                const { data: { session } } = await supabaseClient.auth.getSession();
                console.log('üìã Session result:', session ? 'Found' : 'Not found');

                if (session && session.user && session.user.email) {
                    console.log('‚úÖ User logged in:', session.user.email);
                    currentUserEmail = session.user.email;
                    // User is logged in, load their campaigns, pricing data, pipeline, templates, and settings
                    await loadPricingData(session.user.email);
                    await loadCampaigns(session.user.email);
                    await loadPipelineBusinesses(session.user.email);
                    await loadTemplatesFromCloud();
                    await loadSettingsFromCloud();
                } else {
                    console.log('‚ùå No session found');
                    // Not logged in, show login message
                    document.getElementById('campaignLoginMsg').classList.remove('hidden');
                }
            } catch (err) {
                console.error('Auth check failed:', err);
                document.getElementById('campaignLoginMsg').classList.remove('hidden');
            }
        }

        // Load pricing data (contains home counts per campaign)
        async function loadPricingData(userEmail) {
            console.log('üí∞ Loading pricing data...');
            try {
                const { data, error } = await supabaseClient
                    .from('app_data')
                    .select('data')
                    .eq('user_email', userEmail)
                    .eq('data_type', 'pricing')
                    .single();

                if (error && error.code !== 'PGRST116') {
                    console.error('Pricing load error:', error);
                    return;
                }

                if (data && data.data) {
                    pricingData = data.data;
                    console.log('‚úÖ Pricing data loaded:', Object.keys(pricingData).length, 'campaigns');
                } else {
                    console.log('‚ö†Ô∏è No pricing data found');
                }
            } catch (err) {
                console.error('Failed to load pricing:', err);
            }
        }

        // Load campaigns from Supabase
        async function loadCampaigns(userEmail) {
            console.log('üì• Loading campaigns for:', userEmail);
            try {
                // Select all columns - address_count may not exist yet
                const { data, error } = await supabaseClient
                    .from('postcards')
                    .select('*')
                    .eq('user_email', userEmail)
                    .order('mail_date', { ascending: false });

                console.log('üìä Query result - data:', data?.length || 0, 'items, error:', error);

                if (error) throw error;

                if (data && data.length > 0) {
                    console.log('‚úÖ Campaigns loaded:', data.length);
                    console.log('üìã First campaign:', data[0]);
                    campaigns = data;
                    populateCampaignDropdown();
                } else {
                    console.log('‚ö†Ô∏è No campaigns found');
                    // No campaigns found
                    const dropdown = document.getElementById('campaignDropdown');
                    dropdown.innerHTML = '<option value="">No campaigns found - create one in 9x12 Pro</option>';
                }
            } catch (err) {
                console.error('‚ùå Failed to load campaigns:', err);
                const dropdown = document.getElementById('campaignDropdown');
                dropdown.innerHTML = '<option value="">Error loading campaigns</option>';
            }
        }

        // Load pipeline businesses from Supabase (kanban data)
        async function loadPipelineBusinesses(userEmail) {
            console.log('üì• Loading pipeline businesses for:', userEmail);
            try {
                const { data, error } = await supabaseClient
                    .from('app_data')
                    .select('data')
                    .eq('user_email', userEmail)
                    .eq('data_type', 'kanban')
                    .single();

                console.log('üìä Kanban query result - data:', data, 'error:', error);

                if (error && error.code !== 'PGRST116') {
                    console.error('Pipeline load error:', error);
                    return;
                }

                // data.data IS the columns object directly (not data.data.columns)
                if (data && data.data) {
                    // Collect businesses from all pipeline columns
                    const allBusinesses = [];
                    const columns = data.data;  // columns object is stored directly
                    console.log('üìã Pipeline columns found:', Object.keys(columns));

                    // Define column order for grouping (matching actual kanban column IDs)
                    const columnOrder = ['prospect-list', 'to-contact', 'in-progress', 'committed'];
                    const columnNames = {
                        'prospect-list': 'Prospect List',
                        'to-contact': 'To Contact',
                        'in-progress': 'In Progress',
                        'committed': 'Committed'
                    };

                    columnOrder.forEach(colId => {
                        const items = columns[colId] || [];
                        items.forEach(item => {
                            allBusinesses.push({
                                ...item,
                                pipelineStage: columnNames[colId] || colId
                            });
                        });
                    });

                    pipelineBusinesses = allBusinesses;
                    console.log('‚úÖ Pipeline businesses loaded:', pipelineBusinesses.length);
                    populateBusinessDropdown();
                } else {
                    console.log('‚ö†Ô∏è No pipeline data found');
                    const dropdown = document.getElementById('businessDropdown');
                    dropdown.innerHTML = '<option value="">No businesses in pipeline yet</option>';
                }
            } catch (err) {
                console.error('‚ùå Failed to load pipeline:', err);
            }
        }

        // Populate business dropdown (filtered by current tab)
        function populateBusinessDropdown() {
            const dropdown = document.getElementById('businessDropdown');

            // Filter function based on current tab
            const filterByTab = (biz) => {
                switch (currentTab) {
                    case 'email':
                        return !!biz.email;
                    case 'social':
                        return !!biz.facebook || !!biz.instagram;
                    case 'sms':
                    case 'calls':
                        return !!biz.phone;
                    case 'linkedin':
                        return !!biz.linkedin;
                    case 'walkin':
                    case 'objections':
                    default:
                        return true; // Show all for walk-ins, objections, and unknown tabs
                }
            };

            // Filter tab descriptions for empty state
            const tabDescriptions = {
                'email': 'email addresses',
                'social': 'Facebook or Instagram',
                'sms': 'phone numbers',
                'calls': 'phone numbers',
                'linkedin': 'LinkedIn profiles'
            };

            if (pipelineBusinesses.length === 0) {
                dropdown.innerHTML = '<option value="">No businesses in pipeline</option>';
                return;
            }

            // Filter businesses for current tab
            const filteredBusinesses = pipelineBusinesses
                .map((biz, index) => ({ ...biz, originalIndex: index }))
                .filter(filterByTab);

            if (filteredBusinesses.length === 0) {
                const desc = tabDescriptions[currentTab] || 'contact info';
                dropdown.innerHTML = `<option value="">No businesses with ${desc}</option>`;
                return;
            }

            dropdown.innerHTML = '<option value="">-- Select a business --</option>';

            // Group by pipeline stage
            const grouped = {};
            filteredBusinesses.forEach(biz => {
                const stage = biz.pipelineStage || 'Other';
                if (!grouped[stage]) grouped[stage] = [];
                grouped[stage].push(biz);
            });

            // Create optgroups for each stage
            Object.keys(grouped).forEach(stage => {
                const optgroup = document.createElement('optgroup');
                optgroup.label = `üìå ${stage}`;

                // Sort businesses by category within each stage
                const stageBusinesses = grouped[stage].sort((a, b) => {
                    const catA = (a.category || 'zzz').toLowerCase();
                    const catB = (b.category || 'zzz').toLowerCase();
                    return catA.localeCompare(catB);
                });

                // Group by category within stage
                let currentCategory = null;
                stageBusinesses.forEach(biz => {
                    const bizCategory = biz.category || 'Uncategorized';

                    // Add category header if category changed
                    if (bizCategory !== currentCategory) {
                        currentCategory = bizCategory;
                        const categoryHeader = document.createElement('option');
                        categoryHeader.disabled = true;
                        categoryHeader.textContent = `‚îÅ‚îÅ‚îÅ ${bizCategory.charAt(0).toUpperCase() + bizCategory.slice(1)} ‚îÅ‚îÅ‚îÅ`;
                        categoryHeader.style.fontWeight = 'bold';
                        categoryHeader.style.backgroundColor = '#f3f4f6';
                        optgroup.appendChild(categoryHeader);
                    }

                    const option = document.createElement('option');
                    option.value = biz.originalIndex;

                    // Build contact icons
                    const icons = [];
                    if (biz.phone) icons.push('üìû');
                    if (biz.email) icons.push('üìß');
                    if (biz.facebook) icons.push('üìò');
                    if (biz.instagram) icons.push('üì∑');
                    if (biz.linkedin) icons.push('üíº');
                    if (biz.website) icons.push('üåê');

                    const iconStr = icons.length > 0 ? ` ${icons.join('')}` : '';
                    option.textContent = `${biz.businessName || biz.name || 'Unknown'}${iconStr}`;
                    optgroup.appendChild(option);
                });

                dropdown.appendChild(optgroup);
            });
        }

        // Handle business selection
        function onBusinessSelect() {
            const dropdown = document.getElementById('businessDropdown');
            const infoDiv = document.getElementById('businessInfo');
            const infoText = document.getElementById('businessInfoText');
            const textBtn = document.getElementById('textBusinessBtn');
            const openFbBtn = document.getElementById('openFacebookBtn');
            const openIgBtn = document.getElementById('openInstagramBtn');
            const openLiBtn = document.getElementById('openLinkedInBtn');
            const selectedIndex = dropdown.value;

            if (selectedIndex === '' || selectedIndex === null) {
                infoDiv.classList.add('hidden');
                textBtn.classList.add('hidden');
                if (openFbBtn) openFbBtn.classList.add('hidden');
                if (openIgBtn) openIgBtn.classList.add('hidden');
                if (openLiBtn) openLiBtn.classList.add('hidden');
                settings.businessName = '';
                settings.category = '';
                settings.businessPhone = '';
                settings.businessEmail = '';
                settings.businessFacebook = '';
                settings.businessInstagram = '';
                settings.businessLinkedIn = '';
            } else {
                const business = pipelineBusinesses[parseInt(selectedIndex)];
                if (business) {
                    settings.businessName = business.businessName || business.name || '';
                    settings.category = business.category || '';
                    settings.businessPhone = business.phone || '';
                    settings.businessEmail = business.email || '';
                    settings.businessFacebook = business.facebook || '';
                    settings.businessInstagram = business.instagram || '';
                    settings.businessLinkedIn = business.linkedin || '';

                    // Show info
                    const categoryText = settings.category ? ` ‚Ä¢ ${settings.category}` : '';
                    infoText.textContent = `${settings.businessName}${categoryText}`;
                    infoDiv.classList.remove('hidden');

                    // Show/hide text button based on phone availability
                    if (settings.businessPhone) {
                        textBtn.classList.remove('hidden');
                    } else {
                        textBtn.classList.add('hidden');
                    }

                    // Show/hide social buttons based on URL availability
                    if (openFbBtn) {
                        if (settings.businessFacebook) {
                            openFbBtn.classList.remove('hidden');
                        } else {
                            openFbBtn.classList.add('hidden');
                        }
                    }
                    if (openIgBtn) {
                        if (settings.businessInstagram) {
                            openIgBtn.classList.remove('hidden');
                        } else {
                            openIgBtn.classList.add('hidden');
                        }
                    }
                    if (openLiBtn) {
                        if (settings.businessLinkedIn) {
                            openLiBtn.classList.remove('hidden');
                        } else {
                            openLiBtn.classList.add('hidden');
                        }
                    }

                    // Re-render templates with new business info
                    renderAllTemplates();
                }
            }
        }

        // Text selected business via Google Voice
        function textSelectedBusiness() {
            if (!settings.businessPhone) {
                showToast('No phone number for this business');
                return;
            }

            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

            // Copy phone to clipboard and open Google Voice
            navigator.clipboard.writeText(settings.businessPhone).then(() => {
                if (isMobile) {
                    // Mobile: Open Google Voice in new tab (will open app if installed)
                    window.open('https://voice.google.com/u/0/messages', '_blank');
                } else {
                    // Desktop: Open in popup window for side-by-side viewing
                    openGoogleVoicePopup();
                }
                showToast(`üìã Phone copied: ${settings.businessPhone}`);
            }).catch(() => {
                if (isMobile) {
                    window.open('https://voice.google.com/u/0/messages', '_blank');
                } else {
                    openGoogleVoicePopup();
                }
                showToast(`üì± Text: ${settings.businessPhone}`);
            });
        }

        // Open Google Voice in a separate popup window for side-by-side viewing
        function openGoogleVoicePopup() {
            // Calculate popup size (half screen width, full height)
            const width = Math.floor(screen.width / 2);
            const height = screen.height - 100;
            const left = screen.width - width; // Position on right side
            const top = 0;

            window.open(
                'https://voice.google.com/u/0/messages',
                'GoogleVoice',
                `width=${width},height=${height},left=${left},top=${top},resizable=yes,scrollbars=yes`
            );
        }

        // Open Facebook page for selected business
        function openFacebookPage() {
            if (!settings.businessFacebook) {
                showToast('No Facebook URL for this business');
                return;
            }
            // Copy the FB template to clipboard first
            const fbTemplate = templates['fb'];
            if (fbTemplate && fbTemplate.body) {
                const filledBody = fillVariables(fbTemplate.body);
                navigator.clipboard.writeText(filledBody).then(() => {
                    showToast('üìã Message copied! Opening Facebook...');
                }).catch(() => {
                    showToast('üìò Opening Facebook...');
                });
            }
            // Ensure URL has protocol
            let url = settings.businessFacebook;
            if (!url.startsWith('http')) {
                url = 'https://' + url;
            }
            window.open(url, '_blank');
        }

        // Open Instagram page for selected business
        function openInstagramPage() {
            if (!settings.businessInstagram) {
                showToast('No Instagram URL for this business');
                return;
            }
            // Copy the IG template to clipboard first
            const igTemplate = templates['ig'];
            if (igTemplate && igTemplate.body) {
                const filledBody = fillVariables(igTemplate.body);
                navigator.clipboard.writeText(filledBody).then(() => {
                    showToast('üìã Message copied! Opening Instagram...');
                }).catch(() => {
                    showToast('üì∑ Opening Instagram...');
                });
            }
            // Ensure URL has protocol
            let url = settings.businessInstagram;
            if (!url.startsWith('http')) {
                url = 'https://' + url;
            }
            window.open(url, '_blank');
        }

        // Open LinkedIn page for selected business
        function openLinkedInPage() {
            if (!settings.businessLinkedIn) {
                showToast('No LinkedIn URL for this business');
                return;
            }
            // Copy the LinkedIn template to clipboard first
            const liTemplate = templates['linkedin2'];
            if (liTemplate && liTemplate.body) {
                const filledBody = fillVariables(liTemplate.body);
                navigator.clipboard.writeText(filledBody).then(() => {
                    showToast('üìã Message copied! Opening LinkedIn...');
                }).catch(() => {
                    showToast('üíº Opening LinkedIn...');
                });
            }
            // Ensure URL has protocol
            let url = settings.businessLinkedIn;
            if (!url.startsWith('http')) {
                url = 'https://' + url;
            }
            window.open(url, '_blank');
        }

        // Populate campaign dropdown
        function populateCampaignDropdown() {
            const dropdown = document.getElementById('campaignDropdown');
            dropdown.innerHTML = '<option value="">-- Choose a campaign to auto-fill --</option>';

            campaigns.forEach((campaign, index) => {
                const option = document.createElement('option');
                option.value = index;
                const size = campaign.postcard_size || '9x12';
                const date = campaign.mail_date ? ` (${campaign.mail_date})` : '';
                option.textContent = `${campaign.town} ${size}${date}`;
                dropdown.appendChild(option);
            });
        }

        // Extract just the town/area name from full postcard name
        function extractTownName(fullName) {
            // Remove common prefixes and suffixes to get just the geographic area
            let town = fullName
                .replace(/^The\s+/gi, '')  // Remove leading "The "
                .replace(/^Where\s+/gi, '')  // Remove "Where " prefix
                .replace(/^Taste\s+of\s+/gi, '')  // Remove "Taste of " prefix
                .replace(/^Dining\s+Out\s+In\s+/gi, '')  // Remove "Dining Out In " prefix
                .replace(/\s+Eats$/gi, '')  // Remove " Eats" suffix
                .replace(/\s+Food\s+Guide$/gi, '')  // Remove " Food Guide" suffix
                .replace(/\s*Small Business Spotlight\s*/gi, '')
                .replace(/\s*Business Spotlight\s*/gi, '')
                .replace(/\s*Community Savings Card\s*/gi, '')
                .replace(/\s*Savings Card\s*/gi, '')
                .replace(/\s*Spotlight\s*/gi, '')
                .replace(/\s*Postcard\s*/gi, '')
                .replace(/\s*Mailer\s*/gi, '')
                .trim();
            return town || fullName; // Return original if nothing left
        }

        // Handle campaign selection
        function onCampaignSelect() {
            const dropdown = document.getElementById('campaignDropdown');
            const infoDiv = document.getElementById('campaignInfo');
            const infoText = document.getElementById('campaignInfoText');
            const selectedIndex = dropdown.value;

            if (selectedIndex === '' || selectedIndex === null) {
                infoDiv.classList.add('hidden');
                settings.postcardName = '';
                settings.townName = '';
                settings.defaultZip = '';
            } else {
                const campaign = campaigns[parseInt(selectedIndex)];
                if (campaign) {
                    // Extract just the town/area name
                    const areaOnly = extractTownName(campaign.town);
                    settings.areaName = areaOnly;

                    // Use campaign name as postcard name
                    // Only add "The" prefix for generic names that need it
                    const townLower = campaign.town.toLowerCase();
                    const isCompleteName = townLower.startsWith('the ') ||
                                           townLower.startsWith('where ') ||
                                           townLower.startsWith('taste of ') ||
                                           townLower.startsWith('dining out') ||
                                           townLower.includes('spotlight') ||
                                           townLower.includes('postcard') ||
                                           townLower.includes('savings') ||
                                           townLower.includes('card') ||
                                           townLower.includes('eats') ||
                                           townLower.includes('guide');

                    if (isCompleteName) {
                        // Already a complete name, use as-is
                        settings.postcardName = campaign.town;
                    } else {
                        // Generic town name, add "The X Spotlight"
                        settings.postcardName = `The ${campaign.town} Spotlight`;
                    }

                    // Get home count from pricing data (Set Ad Price section)
                    const mailerId = campaign.mailer_id;
                    const campaignPricing = pricingData[mailerId];
                    console.log('üí∞ Looking up pricing for:', mailerId);
                    console.log('üí∞ Campaign pricing data:', campaignPricing);
                    console.log('üí∞ Campaign address_count:', campaign.address_count);
                    console.log('üí∞ All pricingData keys:', Object.keys(pricingData));

                    if (campaignPricing && campaignPricing.homeCount) {
                        settings.homeCount = typeof campaignPricing.homeCount === 'number'
                            ? campaignPricing.homeCount.toLocaleString()
                            : campaignPricing.homeCount;
                        document.getElementById('settingHomes').value = settings.homeCount;
                        console.log('‚úÖ Home count from pricing:', settings.homeCount);
                    } else if (campaign.address_count) {
                        // Fallback to postcards table if available
                        settings.homeCount = campaign.address_count.toLocaleString();
                        document.getElementById('settingHomes').value = settings.homeCount;
                        console.log('‚úÖ Home count from campaign:', settings.homeCount);
                    } else {
                        // Keep existing or use default
                        if (!settings.homeCount) {
                            settings.homeCount = '5,000';
                        }
                        document.getElementById('settingHomes').value = settings.homeCount;
                        console.log('‚ö†Ô∏è Using default/existing home count:', settings.homeCount);
                        console.log('‚ö†Ô∏è To fix: Set pricing for this campaign in Set Ad Price section of main app');
                        showToast('‚ö†Ô∏è Home count not set for this campaign - using default. Set it in "Set Ad Price" in main app.');
                    }

                    // Update the settings form
                    document.getElementById('settingArea').value = areaOnly;

                    // Show info
                    const size = campaign.postcard_size || '9x12';
                    const homeDisplay = campaign.address_count ? campaign.address_count.toLocaleString() : settings.homeCount;
                    infoText.textContent = `üì¨ ${settings.postcardName} (${size}) - ${homeDisplay} homes`;
                    infoDiv.classList.remove('hidden');

                    showToast(`Campaign loaded: ${campaign.town}`);

                    // Debug: log what was set
                    console.log('üìã Campaign settings set:', {
                        postcardName: settings.postcardName,
                        areaName: settings.areaName,
                        homeCount: settings.homeCount
                    });
                }
            }

            // Persist settings to localStorage and cloud
            localStorage.setItem('outreach-scripts-settings', JSON.stringify(settings));
            saveSettingsToCloud();
            console.log('üíæ Settings saved to localStorage and cloud');

            // Re-render templates with updated settings
            renderAllTemplates();
            renderObjections();
        }

        // Settings functions
        function toggleSettings() {
            const panel = document.getElementById('settingsPanel');
            panel.classList.toggle('hidden');
        }

        function loadSettings() {
            // Try to load from main app's salesToolkitSettings first
            const mainAppSettings = localStorage.getItem('salesToolkitSettings');
            if (mainAppSettings) {
                const parsed = JSON.parse(mainAppSettings);
                settings.yourName = parsed.yourName || '';
                settings.yourCompany = parsed.yourCompany || '';
                settings.yourPhone = parsed.yourPhone || '';
                settings.spotPrice = parsed.spotPrice || '$400';
                settings.homeCount = parsed.homesReached || '5,000';
            }

            // Load outreach-specific settings (may override)
            const saved = localStorage.getItem('outreach-scripts-settings');
            if (saved) {
                const parsed = JSON.parse(saved);
                settings = { ...settings, ...parsed };
            }

            // Ensure critical values have defaults (in case localStorage had empty values)
            if (!settings.homeCount) settings.homeCount = '5,000';
            if (!settings.spotPrice) settings.spotPrice = '$400';

            console.log('üìã Settings loaded:', {
                homeCount: settings.homeCount,
                spotPrice: settings.spotPrice,
                areaName: settings.areaName,
                postcardName: settings.postcardName
            });

            // Populate form
            document.getElementById('settingName').value = settings.yourName || '';
            document.getElementById('settingCompany').value = settings.yourCompany || '';
            document.getElementById('settingPhone').value = settings.yourPhone || '';
            document.getElementById('settingPrice').value = settings.spotPrice;
            document.getElementById('settingArea').value = settings.areaName || '';
            document.getElementById('settingHomes').value = settings.homeCount;
        }

        function saveSettings() {
            settings = {
                ...settings,  // Keep postcardName and other campaign values
                yourName: document.getElementById('settingName').value,
                yourCompany: document.getElementById('settingCompany').value,
                yourPhone: document.getElementById('settingPhone').value,
                spotPrice: document.getElementById('settingPrice').value,
                areaName: document.getElementById('settingArea').value,
                homeCount: document.getElementById('settingHomes').value
            };
            localStorage.setItem('outreach-scripts-settings', JSON.stringify(settings));

            // Also update main app's settings
            const mainAppSettings = {
                yourName: settings.yourName,
                yourCompany: settings.yourCompany,
                yourPhone: settings.yourPhone,
                spotPrice: settings.spotPrice,
                homesReached: settings.homeCount
            };
            localStorage.setItem('salesToolkitSettings', JSON.stringify(mainAppSettings));

            // Save to cloud
            saveSettingsToCloud();

            renderAllTemplates();
            renderObjections();
            showToast('Settings saved!');
            toggleSettings();
        }

        // Load settings from Supabase cloud
        async function loadSettingsFromCloud() {
            if (!currentUserEmail || !supabaseClient) return;

            console.log('‚òÅÔ∏è Loading settings from cloud...');
            try {
                const { data, error } = await supabaseClient
                    .from('app_data')
                    .select('data')
                    .eq('user_email', currentUserEmail)
                    .eq('data_type', 'outreach-settings')
                    .single();

                if (error && error.code !== 'PGRST116') {
                    console.error('Cloud settings load error:', error);
                    return;
                }

                if (data && data.data) {
                    // Merge cloud settings with current (cloud takes precedence for campaign values)
                    settings = { ...settings, ...data.data };

                    // Ensure critical values have defaults (cloud may have stored empty strings)
                    if (!settings.homeCount) settings.homeCount = '5,000';
                    if (!settings.spotPrice) settings.spotPrice = '$400';

                    // Update localStorage
                    localStorage.setItem('outreach-scripts-settings', JSON.stringify(settings));
                    // Update form fields
                    document.getElementById('settingName').value = settings.yourName || '';
                    document.getElementById('settingCompany').value = settings.yourCompany || '';
                    document.getElementById('settingPhone').value = settings.yourPhone || '';
                    document.getElementById('settingPrice').value = settings.spotPrice;
                    document.getElementById('settingArea').value = settings.areaName || '';
                    document.getElementById('settingHomes').value = settings.homeCount;
                    renderAllTemplates();
                    console.log('‚úÖ Settings loaded from cloud:', settings);
                } else {
                    // No cloud settings yet - upload current local ones
                    console.log('‚ö†Ô∏è No cloud settings found, uploading local settings...');
                    await saveSettingsToCloud();
                }
            } catch (err) {
                console.error('Failed to load settings from cloud:', err);
            }
        }

        // Save settings to Supabase cloud
        async function saveSettingsToCloud() {
            if (!currentUserEmail || !supabaseClient) return;

            try {
                const { error } = await supabaseClient
                    .from('app_data')
                    .upsert({
                        user_email: currentUserEmail,
                        data_type: 'outreach-settings',
                        data: settings
                    }, {
                        onConflict: 'user_email,data_type'
                    });

                if (error) {
                    console.error('Cloud settings save error:', error);
                } else {
                    console.log('‚òÅÔ∏è Settings saved to cloud');
                }
            } catch (err) {
                console.error('Failed to save settings to cloud:', err);
            }
        }

        // Template functions
        function loadTemplates() {
            const savedVersion = localStorage.getItem('outreach-scripts-version');
            const saved = localStorage.getItem('outreach-scripts-templates');

            // Check if templates need to be reset due to version update
            if (!savedVersion || parseInt(savedVersion) < TEMPLATE_VERSION) {
                console.log('üìù Template version updated, resetting to new defaults');
                templates = JSON.parse(JSON.stringify(DEFAULT_TEMPLATES));
                localStorage.setItem('outreach-scripts-version', TEMPLATE_VERSION.toString());
                saveTemplates();
            } else if (saved) {
                templates = JSON.parse(saved);
            } else {
                templates = JSON.parse(JSON.stringify(DEFAULT_TEMPLATES));
            }
        }

        function saveTemplates() {
            localStorage.setItem('outreach-scripts-templates', JSON.stringify(templates));
            localStorage.setItem('outreach-scripts-version', TEMPLATE_VERSION.toString());
            // Also save to cloud if logged in
            saveTemplatesToCloud();
        }

        // Load templates from Supabase cloud
        async function loadTemplatesFromCloud() {
            if (!currentUserEmail || !supabaseClient) return;

            console.log('‚òÅÔ∏è Loading templates from cloud...');
            try {
                const { data, error } = await supabaseClient
                    .from('app_data')
                    .select('data')
                    .eq('user_email', currentUserEmail)
                    .eq('data_type', 'outreach-templates')
                    .single();

                if (error && error.code !== 'PGRST116') {
                    console.error('Cloud template load error:', error);
                    return;
                }

                if (data && data.data) {
                    templates = data.data;
                    // Also update localStorage
                    localStorage.setItem('outreach-scripts-templates', JSON.stringify(templates));
                    renderAllTemplates();
                    console.log('‚úÖ Templates loaded from cloud');
                } else {
                    // No cloud templates yet - upload current local ones
                    console.log('‚ö†Ô∏è No cloud templates found, uploading local templates...');
                    await saveTemplatesToCloud();
                }
            } catch (err) {
                console.error('Failed to load templates from cloud:', err);
            }
        }

        // Save templates to Supabase cloud
        async function saveTemplatesToCloud() {
            if (!currentUserEmail || !supabaseClient) return;

            try {
                const { error } = await supabaseClient
                    .from('app_data')
                    .upsert({
                        user_email: currentUserEmail,
                        data_type: 'outreach-templates',
                        data: templates
                    }, {
                        onConflict: 'user_email,data_type'
                    });

                if (error) {
                    console.error('Cloud template save error:', error);
                } else {
                    console.log('‚òÅÔ∏è Templates saved to cloud');
                }
            } catch (err) {
                console.error('Failed to save templates to cloud:', err);
            }
        }

        function resetAllTemplates() {
            if (confirm('Reset all templates to defaults? Your customizations will be lost.')) {
                templates = JSON.parse(JSON.stringify(DEFAULT_TEMPLATES));
                objections = JSON.parse(JSON.stringify(DEFAULT_OBJECTIONS));
                saveTemplates();
                localStorage.setItem('outreach-scripts-objections', JSON.stringify(objections));
                renderAllTemplates();
                renderObjections();
                showToast('All templates reset to defaults');
            }
        }

        function fillVariables(text) {
            if (!text) return '';
            // Strip "$" from spotPrice so templates can use "$[SPOT_PRICE]" without getting "$$"
            const priceValue = (settings.spotPrice || '[SPOT_PRICE]').replace(/^\$/, '');
            return text
                .replace(/\[YOUR_NAME\]/g, settings.yourName || '[YOUR_NAME]')
                .replace(/\[YOUR_PHONE\]/g, settings.yourPhone || '[YOUR_PHONE]')
                .replace(/\[YOUR_COMPANY\]/g, settings.yourCompany || '[YOUR_COMPANY]')
                .replace(/\[ZIP\]/g, settings.zipCode || '[ZIP]')
                .replace(/\[AREA\]/g, settings.areaName || '[AREA]')
                .replace(/\[POSTCARD_NAME\]/g, settings.postcardName || '[POSTCARD_NAME]')
                .replace(/\[HOME_COUNT\]/g, settings.homeCount || '[HOME_COUNT]')
                .replace(/\[SPOT_PRICE\]/g, priceValue)
                .replace(/\[BUSINESS_NAME\]/g, settings.businessName || '[BUSINESS_NAME]')
                .replace(/\[CATEGORY\]/g, settings.category || '[CATEGORY]');
        }

        function highlightPlaceholders(text) {
            // Highlight remaining placeholders in yellow
            return text.replace(/\[([A-Z_]+)\]/g, '<span class="placeholder">[$1]</span>');
        }

        function renderAllTemplates() {
            Object.keys(templates).forEach(id => {
                const template = templates[id];

                // Subject (for emails)
                const subjectEl = document.getElementById(id + '-subject');
                if (subjectEl && template.subject !== undefined) {
                    subjectEl.innerHTML = highlightPlaceholders(fillVariables(template.subject));
                }

                // Body
                const bodyEl = document.getElementById(id + '-body');
                if (bodyEl) {
                    bodyEl.innerHTML = highlightPlaceholders(fillVariables(template.body));
                }
            });

            // Refresh subject dropdowns with current variable values
            refreshSubjectDropdowns();
        }

        // Refresh subject dropdown previews (without changing selection)
        function refreshSubjectDropdowns() {
            const dropdowns = document.querySelectorAll('.subject-dropdown');
            dropdowns.forEach(dropdown => {
                const currentValue = dropdown.value;
                dropdown.innerHTML = '<option value="">-- Pick a subject --</option>';
                SUBJECT_LINE_OPTIONS.forEach((subject, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = fillVariables(subject);
                    dropdown.appendChild(option);
                });
                dropdown.value = currentValue; // Restore selection
            });
        }

        // Populate subject line dropdowns
        function populateSubjectDropdowns() {
            const dropdowns = document.querySelectorAll('.subject-dropdown');
            dropdowns.forEach(dropdown => {
                // Keep the first "-- Pick a subject --" option
                dropdown.innerHTML = '<option value="">-- Pick a subject --</option>';
                SUBJECT_LINE_OPTIONS.forEach((subject, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = fillVariables(subject);
                    dropdown.appendChild(option);
                });
            });
        }

        // Handle subject line selection
        function selectSubjectLine(templateId, optionIndex) {
            if (optionIndex === '' || optionIndex === null) return;

            const selectedSubject = SUBJECT_LINE_OPTIONS[parseInt(optionIndex)];
            if (selectedSubject && templates[templateId]) {
                templates[templateId].subject = selectedSubject;
                saveTemplates();
                renderAllTemplates();
                showToast('Subject updated!');
            }
        }

        function toggleEdit(id) {
            const card = document.querySelector(`[data-template="${id}"]`);
            const isEditing = card.classList.contains('editing');

            if (isEditing) {
                cancelEdit(id);
            } else {
                // Enter edit mode
                card.classList.add('editing');

                const template = templates[id];

                // Show subject edit if exists
                const subjectEdit = document.getElementById(id + '-subject-edit');
                const subjectDisplay = document.getElementById(id + '-subject');
                if (subjectEdit && template.subject !== undefined) {
                    subjectEdit.value = template.subject;
                    subjectEdit.classList.remove('hidden');
                    if (subjectDisplay) subjectDisplay.classList.add('hidden');
                }

                // Show body edit
                const bodyEdit = document.getElementById(id + '-body-edit');
                const bodyDisplay = document.getElementById(id + '-body');
                if (bodyEdit) {
                    bodyEdit.value = template.body;
                    bodyEdit.style.display = 'block';
                    if (bodyDisplay) bodyDisplay.style.display = 'none';
                }

                // Show save/cancel buttons
                const actions = card.querySelector('.edit-actions');
                if (actions) actions.classList.remove('hidden');
            }
        }

        function cancelEdit(id) {
            const card = document.querySelector(`[data-template="${id}"]`);
            card.classList.remove('editing');

            // Hide subject edit
            const subjectEdit = document.getElementById(id + '-subject-edit');
            const subjectDisplay = document.getElementById(id + '-subject');
            if (subjectEdit) {
                subjectEdit.classList.add('hidden');
                if (subjectDisplay) subjectDisplay.classList.remove('hidden');
            }

            // Hide body edit
            const bodyEdit = document.getElementById(id + '-body-edit');
            const bodyDisplay = document.getElementById(id + '-body');
            if (bodyEdit) {
                bodyEdit.style.display = 'none';
                if (bodyDisplay) bodyDisplay.style.display = 'block';
            }

            // Hide save/cancel buttons
            const actions = card.querySelector('.edit-actions');
            if (actions) actions.classList.add('hidden');
        }

        function saveTemplate(id) {
            const subjectEdit = document.getElementById(id + '-subject-edit');
            const bodyEdit = document.getElementById(id + '-body-edit');

            if (subjectEdit && templates[id].subject !== undefined) {
                templates[id].subject = subjectEdit.value;
            }
            if (bodyEdit) {
                templates[id].body = bodyEdit.value;
            }

            saveTemplates();
            cancelEdit(id);
            renderAllTemplates();
            showToast('Template saved!');
        }

        function copyTemplate(id) {
            const template = templates[id];
            let text = '';

            if (template.subject) {
                text = 'Subject: ' + fillVariables(template.subject) + '\n\n';
            }
            text += fillVariables(template.body);

            navigator.clipboard.writeText(text).then(() => {
                showToast('Copied to clipboard!');
            }).catch(() => {
                showToast('Failed to copy');
            });
        }

        function openEmailTemplate(id) {
            const template = templates[id];
            if (!template || !template.subject) return;

            // Debug: log settings to see what values are being used
            console.log('üìß Opening email with settings:', {
                postcardName: settings.postcardName,
                areaName: settings.areaName,
                homeCount: settings.homeCount,
                homeCountType: typeof settings.homeCount,
                homeCountLength: settings.homeCount ? settings.homeCount.length : 'null/undefined',
                spotPrice: settings.spotPrice,
                businessName: settings.businessName,
                category: settings.category
            });
            console.log('üìß Full settings object:', JSON.stringify(settings, null, 2));
            console.log('üìß Template body BEFORE fill:', template.body);
            console.log('üìß Template body contains [HOME_COUNT]?', template.body.includes('[HOME_COUNT]'));

            const filledBody = fillVariables(template.body);
            console.log('üìß Template body AFTER fill:', filledBody);
            console.log('üìß Still contains [HOME_COUNT]?', filledBody.includes('[HOME_COUNT]'));

            const subject = encodeURIComponent(fillVariables(template.subject));
            const body = encodeURIComponent(filledBody);

            // Get recipient email if a business is selected
            let recipient = '';
            if (settings.businessEmail) {
                recipient = settings.businessEmail;
            }

            const mailtoLink = `mailto:${recipient}?subject=${subject}&body=${body}`;
            window.open(mailtoLink, '_self');
        }

        // Objections
        function loadObjections() {
            const saved = localStorage.getItem('outreach-scripts-objections');
            if (saved) {
                objections = JSON.parse(saved);
            } else {
                objections = JSON.parse(JSON.stringify(DEFAULT_OBJECTIONS));
            }
        }

        function renderObjections() {
            const container = document.getElementById('objections-container');
            container.innerHTML = objections.map(obj => `
                <div class="template-card bg-white rounded-xl border-2 border-red-100 p-5 shadow-sm" data-objection="${obj.id}">
                    <div class="flex items-start justify-between gap-4">
                        <div class="flex-1">
                            <p class="text-red-600 font-semibold text-sm mb-2">"${obj.objection}"</p>
                            <p class="text-gray-700 text-sm objection-response" id="${obj.id}-response">${highlightPlaceholders(fillVariables(obj.response))}</p>
                            <textarea class="template-edit hidden mt-2" id="${obj.id}-edit">${obj.response}</textarea>
                        </div>
                        <div class="flex flex-col gap-2 shrink-0">
                            <button onclick="toggleObjEdit('${obj.id}')" class="edit-btn p-2 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors" title="Edit">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>
                            </button>
                            <button onclick="copyObjText('${obj.id}')" class="copy-btn px-3 py-1.5 bg-gray-200 text-gray-700 rounded-lg text-sm font-semibold hover:bg-gray-300 transition-colors">
                                Copy
                            </button>
                        </div>
                    </div>
                    <div class="edit-actions hidden mt-4 flex gap-2 justify-end">
                        <button onclick="cancelObjEdit('${obj.id}')" class="px-3 py-1.5 bg-gray-200 text-gray-700 rounded-lg font-semibold text-sm">Cancel</button>
                        <button onclick="saveObjEdit('${obj.id}')" class="px-3 py-1.5 bg-green-600 text-white rounded-lg font-semibold text-sm">Save</button>
                    </div>
                </div>
            `).join('');
        }

        function toggleObjEdit(id) {
            const card = document.querySelector(`[data-objection="${id}"]`);
            const responseEl = document.getElementById(id + '-response');
            const editEl = document.getElementById(id + '-edit');
            const actions = card.querySelector('.edit-actions');

            if (editEl.classList.contains('hidden')) {
                editEl.classList.remove('hidden');
                editEl.style.display = 'block';
                responseEl.classList.add('hidden');
                actions.classList.remove('hidden');
            } else {
                cancelObjEdit(id);
            }
        }

        function cancelObjEdit(id) {
            const card = document.querySelector(`[data-objection="${id}"]`);
            const responseEl = document.getElementById(id + '-response');
            const editEl = document.getElementById(id + '-edit');
            const actions = card.querySelector('.edit-actions');

            editEl.classList.add('hidden');
            editEl.style.display = 'none';
            responseEl.classList.remove('hidden');
            actions.classList.add('hidden');
        }

        function saveObjEdit(id) {
            const editEl = document.getElementById(id + '-edit');
            const obj = objections.find(o => o.id === id);
            if (obj) {
                obj.response = editEl.value;
                localStorage.setItem('outreach-scripts-objections', JSON.stringify(objections));
                renderObjections();
                showToast('Response saved!');
            }
        }

        function copyObjText(id) {
            const obj = objections.find(o => o.id === id);
            if (obj) {
                navigator.clipboard.writeText(fillVariables(obj.response)).then(() => {
                    showToast('Copied to clipboard!');
                });
            }
        }

        // Tab switching
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('tab-' + tabName).classList.remove('hidden');
            event.target.classList.add('active');

            // Track current tab and refresh business dropdown with filter
            currentTab = tabName;
            populateBusinessDropdown();
        }

        // Toast notification
        function showToast(message) {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            toastMessage.textContent = message;
            toast.classList.remove('opacity-0');
            toast.classList.add('opacity-100');
            setTimeout(() => {
                toast.classList.remove('opacity-100');
                toast.classList.add('opacity-0');
            }, 2000);
        }
    </script>
</body>
</html>
