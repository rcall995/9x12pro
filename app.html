<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>9x12 Pro - Community Card Management</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes" />
  <meta name="description" content="Manage your direct mail postcard campaigns, track prospects, and grow your business" />

  <!-- PWA Meta Tags -->
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="9x12 Pro" />
  <meta name="theme-color" content="#4F46E5" />

  <!-- PWA Manifest -->
  <!-- PWA manifest disabled for better iPad performance -->
  <!-- <link rel="manifest" href="/manifest.json" /> -->

  <!-- Favicons -->
  <link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png">
  <link rel="apple-touch-icon" sizes="192x192" href="/icon-192.png">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='40' fill='%234F46E5'/><text x='50' y='60' font-family='Arial' font-size='24' font-weight='bold' fill='white' text-anchor='middle'>9x12</text></svg>" />

  <!-- VERSION: 2025-01-14-v22 PWA Support -->
  <!-- Aggressive Cache Busting for iOS/Safari -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <meta name="cache-control" content="no-cache" />
  <meta name="expires" content="0" />
  <meta name="format-detection" content="telephone=no" />
  <script>
    // Cache busting - automatic, no manual version updates needed
    // Service worker (v110) handles actual caching, this just ensures fresh loads on deploy
    window.CACHE_BUST = '?v=' + Date.now();
  </script>

  <!-- Sentry Error Tracking - Load first to catch all errors -->
  <script
    src="https://browser.sentry-cdn.com/8.45.0/bundle.tracing.min.js"
    crossorigin="anonymous"
  ></script>
  <script>
    Sentry.init({
      dsn: "https://eba65eb08b1243f9141527ebf8743ebe@o4510840630149120.ingest.us.sentry.io/4510840636702720",
      integrations: [Sentry.browserTracingIntegration()],
      // Performance monitoring sample rate (10% of transactions)
      tracesSampleRate: 0.1,
      // Only send errors in production
      enabled: window.location.hostname !== 'localhost',
      // Add user email when available
      beforeSend(event) {
        const userEmail = window.currentAuthUser?.email;
        if (userEmail) {
          event.user = { email: userEmail };
        }
        return event;
      }
    });
    console.log('üõ°Ô∏è Sentry error tracking initialized');
  </script>

  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Google Maps API callback must be defined BEFORE script loads -->
  <script>
    window.googleMapsLoaded = false;
    window.initGoogleMaps = function() {
      window.googleMapsLoaded = true;
    };
  </script>
  <!-- Cache-busting: uses timestamp so no manual version sync needed.
       The display version lives only in config.js (APP_CONFIG.app.version). -->
  <script>window._v = Date.now();</script>
  <!-- Core Utilities - Load First (synchronous for dependencies) -->
  <script>
    ['config.js','error-handler.js','utils.js','storage.js','utilities.js','cloud-sync.js'].forEach(function(s) {
      document.write('<script src="' + s + '?v=' + window._v + '"><\/script>');
    });
  </script>

  <!-- New Modular Components -->
  <script>
    ['components/Toast.js','components/BusinessModal.js','components/FilterBar.js'].forEach(function(s) {
      document.write('<script src="' + s + '?v=' + window._v + '"><\/script>');
    });
  </script>

  <!-- Google Maps JavaScript API - PLACES LIBRARY DISABLED TO PREVENT CHARGES -->
  <script>
    // IMPORTANT: Places API costs $32 per 1,000 requests - DISABLED
    // Use API key from config (Geocoding only - free tier available)
    (function() {
      var script = document.createElement('script');
      // REMOVED: &libraries=places to prevent costly API calls
      script.src = 'https://maps.googleapis.com/maps/api/js?key=' + window.APP_CONFIG.googleMaps.apiKey + '&callback=initGoogleMaps';
      script.async = true;
      script.defer = true;
      document.head.appendChild(script);
    })();
  </script>
  <!-- Supabase JS Client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // Initialize Supabase client IMMEDIATELY so auth-root.js can find it
    console.log('üîß HEAD: Initializing Supabase client...');
    (function() {
      // Wait a tiny bit for supabase library to be available
      var attempts = 0;
      var initInterval = setInterval(function() {
        attempts++;
        if (window.supabase && window.supabase.createClient && window.APP_CONFIG) {
          clearInterval(initInterval);
          // Use credentials from config
          window.supabaseClient = window.supabase.createClient(
            window.APP_CONFIG.supabase.url,
            window.APP_CONFIG.supabase.anonKey
          );
          console.log('‚úÖ HEAD: window.supabaseClient created after', attempts, 'attempts');
        } else if (attempts > 50) {
          clearInterval(initInterval);
          console.error('‚ùå Supabase library not loaded after 50 attempts');
        }
      }, 10);
    })();
  </script>

  <!-- External Stylesheet - dynamic cache bust -->
  <script>
    (function() {
      var link = document.createElement('link');
      link.rel = 'stylesheet';
      link.href = 'styles.css' + window.CACHE_BUST;
      document.head.appendChild(link);
    })();
  </script>
</head>
<body class="bg-gray-100 min-h-screen font-sans">
  <!-- Loading Overlay - shows while app data is loading -->
  <div id="app-loading-overlay" style="position: fixed; inset: 0; width: 100vw; height: 100vh; background: #667eea; z-index: 999999; display: flex; align-items: center; justify-content: center;">
    <div style="text-align: center;">
      <div style="width: 48px; height: 48px; border: 4px solid rgba(255,255,255,0.3); border-top-color: white; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 16px;"></div>
      <p style="color: white; font-size: 14px; font-weight: 500;">Loading...</p>
    </div>
  </div>
  <style>
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>

  <!-- Inline script to set initial tab state - injects CSS immediately to prevent flash -->
  <script>
    (function() {
      // Get saved tab IMMEDIATELY and inject CSS to hide wrong tabs
      var savedTab = localStorage.getItem('9x12_active_tab') || 'dashboard';

      // Create style to hide all non-active tabs before DOM renders
      var style = document.createElement('style');
      style.id = 'initial-tab-style';
      style.textContent = '.tab-pane:not([data-content="' + savedTab + '"]) { display: none !important; }';
      document.head.appendChild(style);

      // Remove the style once proper tab switching takes over
      document.addEventListener('DOMContentLoaded', function() {
        // Small delay to let switchTab run first
        setTimeout(function() {
          var initialStyle = document.getElementById('initial-tab-style');
          if (initialStyle) initialStyle.remove();
        }, 100);
      });
    })();
  </script>
  <header class="bg-gradient-to-r from-blue-700 via-blue-600 to-blue-500 shadow-lg px-4 py-3 flex flex-col md:flex-row md:justify-between md:items-center gap-3 sticky top-0 z-30">
    <div class="flex items-center gap-3">
      <h1 class="text-2xl font-bold flex items-center gap-2">
        <span class="text-white font-black text-3xl">9√ó12</span>
        <span class="font-bold text-indigo-100">PRO</span>
      </h1>
      <span class="hidden md:inline-block text-xs text-indigo-200 font-medium bg-white/10 px-2 py-1 rounded-full">Community Card Management</span>
      <span id="appVersionDisplay" class="hidden md:inline-block text-xs text-indigo-300/70 font-mono ml-2"></span>
    </div>

    <!-- Current Postcard Selector (Main Control) - Split into Town and Month -->
    <!-- Only visible on Postcards & Activation tab -->
    <div id="postcardSelectorContainer" class="flex-1 flex justify-center hidden">
      <div class="flex flex-col md:flex-row items-center gap-2">
        <label class="text-sm font-semibold text-white/90 whitespace-nowrap">Town:</label>
        <select id="headerTownSelect" onchange="onTownChanged()" class="border-2 border-white/30 rounded-lg px-3 py-2 bg-white/95 text-sm font-medium hover:border-white/50 focus:outline-none focus:ring-2 focus:ring-white/50 focus:border-transparent text-gray-800" style="min-width: 150px;">
          <option value="">‚Äî Select Town ‚Äî</option>
        </select>
        <label class="text-sm font-semibold text-white/90 whitespace-nowrap">Month:</label>
        <select id="headerMonthSelect" onchange="updatePostcardFromSelectors()" class="border-2 border-white/30 rounded-lg px-3 py-2 bg-white/95 text-sm font-medium hover:border-white/50 focus:outline-none focus:ring-2 focus:ring-white/50 focus:border-transparent text-gray-800" style="min-width: 150px;">
          <option value="">‚Äî Select Month ‚Äî</option>
        </select>
      </div>
    </div>

    <div class="flex items-center gap-2 md:gap-3">
      <!-- Auto-Save Status Indicator (Compact) -->
      <div id="autoSaveStatus" class="flex items-center gap-1 px-2 py-1 rounded-md text-xs font-medium bg-white/20 text-white border border-white/30" style="display: none;">
        <span id="autoSaveIcon">‚úì</span>
        <span id="autoSaveText" class="hidden lg:inline">Saved</span>
      </div>
      <button id="btnManualSave" onclick="manualSaveNow()" class="px-2 py-1 bg-white/20 text-white rounded-md text-xs hover:bg-white/30 font-medium border border-white/30 hidden">
        <span class="hidden sm:inline">‚òÅÔ∏è</span>
      </button>
    </div>
  </header>

  <!-- Offline Indicator Banner -->
  <div id="offlineBanner" class="hidden bg-amber-500 text-white px-4 py-2 text-center font-medium text-sm">
    <span class="inline-flex items-center gap-2">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636a9 9 0 010 12.728m-3.536-3.536a5 5 0 010-7.072M3 3l18 18"></path>
      </svg>
      You're offline - Changes will sync when connection returns
      <span id="pendingSyncCount" class="bg-amber-600 px-2 py-0.5 rounded-full text-xs hidden">0 pending</span>
    </span>
  </div>

  <!-- Sync Queue Status (shows when syncing pending changes) -->
  <div id="syncQueueBanner" class="hidden bg-blue-500 text-white px-4 py-2 text-center font-medium text-sm">
    <span class="inline-flex items-center gap-2">
      <svg class="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
      Syncing <span id="syncingCount">0</span> pending changes...
    </span>
  </div>

  <!-- Main Navigation -->
  <div class="max-w-6xl mx-auto px-3 mt-4">
    <div id="mainNavigation" class="bg-white border-2 border-gray-200 rounded-xl p-2 shadow-sm">
      <div class="flex items-center justify-between gap-1">
        <button onclick="switchTab('dashboard')" data-tab="dashboard" class="tab-btn flex-1 flex flex-col lg:flex-row items-center justify-center gap-1 lg:gap-2 px-2 py-2 lg:py-2.5 rounded-lg transition-all hover:bg-indigo-50 group" id="nav-dashboard" title="Dashboard - Your command center with tasks, financials & overview">
          <span class="text-xl lg:text-2xl">üè†</span>
          <span class="text-xs lg:text-sm font-bold text-gray-600 group-hover:text-indigo-600">Dashboard</span>
        </button>
        <button onclick="switchTab('manager')" data-tab="manager" class="tab-btn flex-1 flex flex-col lg:flex-row items-center justify-center gap-1 lg:gap-2 px-2 py-2 lg:py-2.5 rounded-lg transition-all hover:bg-indigo-50 group" id="nav-campaigns" title="Postcard Campaigns - Design & manage your postcard layouts">
          <span class="text-xl lg:text-2xl">üìÆ</span>
          <span class="text-xs lg:text-sm font-bold text-gray-600 group-hover:text-indigo-600">Postcards</span>
        </button>
        <button onclick="switchTab('lead-generation')" data-tab="lead-generation" class="tab-btn flex-1 flex flex-col lg:flex-row items-center justify-center gap-1 lg:gap-2 px-2 py-2 lg:py-2.5 rounded-lg transition-all hover:bg-indigo-50 group" id="nav-generator" title="Prospect Radar - Find local businesses by ZIP code and category">
          <span class="text-xl lg:text-2xl">üîç</span>
          <span class="text-xs lg:text-sm font-bold text-gray-600 group-hover:text-indigo-600 whitespace-nowrap">Prospect Radar</span>
        </button>
        <button onclick="switchTab('clients')" data-tab="clients" class="tab-btn flex-1 flex flex-col lg:flex-row items-center justify-center gap-1 lg:gap-2 px-2 py-2 lg:py-2.5 rounded-lg transition-all hover:bg-indigo-50 group" id="nav-clients" title="Businesses - All prospects and clients in one place">
          <span class="text-xl lg:text-2xl">üë•</span>
          <span class="text-xs lg:text-sm font-bold text-gray-600 group-hover:text-indigo-600">Businesses</span>
        </button>
        <button onclick="switchTab('pipeline')" data-tab="pipeline" class="tab-btn flex-1 flex flex-col lg:flex-row items-center justify-center gap-1 lg:gap-2 px-2 py-2 lg:py-2.5 rounded-lg transition-all hover:bg-indigo-50 group" id="nav-pipeline" title="Pipeline - Manage your sales funnel with drag & drop board">
          <span class="text-xl lg:text-2xl">üìä</span>
          <span class="text-xs lg:text-sm font-bold text-gray-600 group-hover:text-indigo-600">Pipeline</span>
        </button>
        <button onclick="switchTab('outreach')" data-tab="outreach" class="tab-btn flex-1 flex flex-col lg:flex-row items-center justify-center gap-1 lg:gap-2 px-2 py-2 lg:py-2.5 rounded-lg transition-all hover:bg-indigo-50 group" id="nav-outreach" title="Outreach - Work through your To Contact list efficiently">
          <span class="text-xl lg:text-2xl">üìû</span>
          <span class="text-xs lg:text-sm font-bold text-gray-600 group-hover:text-indigo-600">Outreach</span>
        </button>
      </div>
    </div>
  </div>

  <main class="max-w-6xl mx-auto mt-6 px-3 pb-20">
    <div id="tabContent">

        <!-- SUPERCHARGED DASHBOARD TAB -->
        <div data-content="dashboard" class="tab-pane active-pane">
            <!-- COMMAND CENTER BANNER -->
            <div class="hero-section mb-6">
                <div class="relative z-10">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <div class="w-16 h-16 bg-white/20 rounded-2xl flex items-center justify-center">
                                <span class="text-4xl">üéØ</span>
                            </div>
                            <div>
                                <h2 class="text-3xl md:text-4xl font-bold tracking-tight">Dashboard</h2>
                                <p class="text-lg text-blue-100 mt-1">Your business at a glance</p>
                            </div>
                        </div>
                        <a href="facing-slip.html" target="_blank" class="px-4 py-2.5 bg-amber-500 hover:bg-amber-400 text-white rounded-xl font-bold text-sm flex items-center gap-2 transition-all shadow-lg hover:shadow-xl hover:scale-105">
                            <span>üìã</span>
                            <span class="hidden md:inline">Facing Slip Generator</span>
                            <span class="md:hidden">Slips</span>
                        </a>
                    </div>
                </div>
            </div>

            <!-- HOME/OVERVIEW CONTENT (no sub-navigation) -->

            <!-- GETTING STARTED CHECKLIST (Full Width) -->
            <div id="gettingStartedWidget" class="bg-white rounded-xl border border-gray-200 p-5 mb-6" style="box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-10 h-10 rounded-lg bg-blue-50 flex items-center justify-center">
                        <span class="text-xl">üöÄ</span>
                    </div>
                    <div class="flex-1">
                        <h4 class="text-lg font-semibold text-gray-900">Getting Started</h4>
                        <p class="text-xs text-gray-500" id="checklistProgress">0 of 5 complete</p>
                    </div>
                    <button onclick="dismissGettingStarted()" class="text-gray-400 hover:text-gray-600 transition p-1" title="Dismiss">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                        </svg>
                    </button>
                </div>
                <div class="space-y-2" id="checklistItems">
                    <!-- Dynamically populated by renderGettingStartedChecklist() -->
                </div>
            </div>

            <!-- QUICK STATS CARDS -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                <!-- Prospects in Pool -->
                <div class="bg-white rounded-xl border border-gray-200 p-5 hover:border-blue-300 transition-all" style="box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
                    <div class="flex items-center justify-between mb-3">
                        <div class="w-10 h-10 rounded-lg bg-teal-50 flex items-center justify-center">
                            <span class="text-xl">üéØ</span>
                        </div>
                    </div>
                    <p id="statsProspects" class="text-3xl font-bold text-gray-900 mb-1">0</p>
                    <p class="text-sm text-gray-500">Prospects</p>
                </div>

                <!-- Active Leads -->
                <div class="bg-white rounded-xl border border-gray-200 p-5 hover:border-blue-300 transition-all" style="box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
                    <div class="flex items-center justify-between mb-3">
                        <div class="w-10 h-10 rounded-lg bg-blue-50 flex items-center justify-center">
                            <span class="text-xl">üìä</span>
                        </div>
                    </div>
                    <p id="statsLeads" class="text-3xl font-bold text-gray-900 mb-1">0</p>
                    <p class="text-sm text-gray-500">Active Leads</p>
                </div>

                <!-- Campaigns -->
                <div class="bg-white rounded-xl border border-gray-200 p-5 hover:border-blue-300 transition-all" style="box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
                    <div class="flex items-center justify-between mb-3">
                        <div class="w-10 h-10 rounded-lg bg-purple-50 flex items-center justify-center">
                            <span class="text-xl">üìÆ</span>
                        </div>
                    </div>
                    <p id="statsCampaigns" class="text-3xl font-bold text-gray-900 mb-1">0</p>
                    <p class="text-sm text-gray-500">Campaigns</p>
                </div>

                <!-- Active Clients -->
                <div class="bg-white rounded-xl border border-gray-200 p-5 hover:border-blue-300 transition-all" style="box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
                    <div class="flex items-center justify-between mb-3">
                        <div class="w-10 h-10 rounded-lg bg-green-50 flex items-center justify-center">
                            <span class="text-xl">üë•</span>
                        </div>
                    </div>
                    <p id="statsClients" class="text-3xl font-bold text-gray-900 mb-1">0</p>
                    <p class="text-sm text-gray-500">Clients</p>
                </div>
            </div>

            <!-- CARDS IN PROGRESS SECTION -->
            <div id="cardsInProgressSection" class="mb-8">
                <!-- Dynamically populated by renderCardsInProgress() -->
            </div>

            <!-- TWO-COLUMN LAYOUT: TASKS + FINANCIALS -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-5 mb-8">
                <!-- TASKS WIDGET -->
                <div class="bg-white rounded-xl border border-gray-200 p-5" style="box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-lg bg-green-50 flex items-center justify-center">
                                <span class="text-xl">‚úÖ</span>
                            </div>
                            <div>
                                <h4 class="text-lg font-semibold text-gray-900">Tasks</h4>
                                <p class="text-xs text-gray-500" id="dashboardTaskStatus">Loading...</p>
                            </div>
                        </div>
                        <button onclick="openTaskModal()" class="px-3 py-1.5 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors">
                            + Add
                        </button>
                    </div>
                    <div id="dashboardTaskList" class="space-y-2 max-h-56 overflow-y-auto">
                        <p class="text-sm text-gray-500 text-center py-4">Loading tasks...</p>
                    </div>
                    <div class="mt-4 pt-3 border-t border-gray-100">
                        <button onclick="switchTab('tasks')" class="text-sm text-blue-600 hover:text-blue-800 font-medium">
                            View all tasks ‚Üí
                        </button>
                    </div>
                </div>

                <!-- FINANCIAL SUMMARY WIDGET -->
                <div class="bg-white rounded-xl border border-gray-200 p-5" style="box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-lg bg-amber-50 flex items-center justify-center">
                                <span class="text-xl">üí∞</span>
                            </div>
                            <div>
                                <h4 class="text-lg font-semibold text-gray-900">Financials</h4>
                                <p class="text-xs text-gray-500">This month</p>
                            </div>
                        </div>
                        <button onclick="showAddTransactionModal()" class="px-3 py-1.5 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors">
                            + Add
                        </button>
                    </div>
                    <!-- This Month Summary -->
                    <div class="grid grid-cols-3 gap-3 mb-4">
                        <div class="text-center p-3 bg-gray-50 rounded-lg">
                            <p class="text-xs text-gray-500 mb-1">Revenue</p>
                            <p id="dashboardRevenueMonth" class="text-xl font-bold text-green-600">$0</p>
                        </div>
                        <div class="text-center p-3 bg-gray-50 rounded-lg">
                            <p class="text-xs text-gray-500 mb-1">Expenses</p>
                            <p id="dashboardExpensesMonth" class="text-xl font-bold text-red-500">$0</p>
                        </div>
                        <div class="text-center p-3 bg-gray-50 rounded-lg">
                            <p class="text-xs text-gray-500 mb-1">Profit</p>
                            <p id="dashboardProfitMonth" class="text-xl font-bold text-blue-600">$0</p>
                        </div>
                    </div>
                    <!-- All Time Summary -->
                    <div class="flex items-center justify-between text-sm px-1 py-2 border-t border-gray-100">
                        <span class="text-gray-500">All time:</span>
                        <div class="flex gap-4">
                            <span class="text-green-600 font-medium"><span id="dashboardRevenueAll">$0</span></span>
                            <span class="text-red-500 font-medium"><span id="dashboardExpensesAll">$0</span></span>
                            <span class="text-blue-600 font-medium"><span id="dashboardProfitAll">$0</span></span>
                        </div>
                    </div>
                    <div class="mt-3 pt-3 border-t border-gray-100">
                        <button onclick="switchTab('reports')" class="text-sm text-blue-600 hover:text-blue-800 font-medium">
                            View full reports ‚Üí
                        </button>
                    </div>
                </div>
            </div>

            <!-- CONTRACT RENEWALS WIDGET -->
            <div class="bg-white rounded-xl border border-orange-200 p-5 mb-6" style="box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-lg bg-orange-50 flex items-center justify-center">
                            <span class="text-xl">üîÑ</span>
                        </div>
                        <div>
                            <h4 class="text-lg font-semibold text-gray-900">Contract Renewals</h4>
                            <p class="text-xs text-gray-500">Clients due for renewal (30+ days since mail drop)</p>
                        </div>
                    </div>
                    <button onclick="checkRenewals()" class="px-3 py-1.5 bg-orange-600 text-white rounded-lg text-sm font-medium hover:bg-orange-700 transition-colors">
                        üîÑ Refresh
                    </button>
                </div>
                <div id="dashboardRenewalList" class="space-y-2 max-h-48 overflow-y-auto">
                    <p class="text-sm text-gray-500 text-center py-4">Select a campaign to check renewals</p>
                </div>
            </div>

            <!-- STORAGE & CACHE WIDGET (hidden by default, admin use only) -->
            <div class="hidden bg-white rounded-xl border border-gray-200 p-5 mt-6" id="storageCacheWidget" style="box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center">
                        <span class="text-xl">üíæ</span>
                    </div>
                    <div>
                        <h4 class="text-lg font-semibold text-gray-900">Storage & Cache</h4>
                        <p class="text-xs text-gray-500">Manage local browser storage</p>
                    </div>
                </div>
                <div class="flex flex-col sm:flex-row gap-4 items-start sm:items-center">
                    <div class="flex-1">
                        <p class="text-sm text-gray-600" id="cacheStatusText">Loading cache info...</p>
                    </div>
                    <button onclick="clearLocalCache()" class="px-3 py-1.5 bg-red-500 text-white rounded-lg font-medium hover:bg-red-600 transition-colors text-sm">
                        Clear Cache
                    </button>
                </div>
            </div>
        </div>
        <!-- END DASHBOARD/HOME TAB -->

        <!-- TASKS TAB (new main tab) -->
        <div data-content="tasks" class="tab-pane hidden">
                <!-- HERO SECTION -->
                <div class="hero-section mb-6" style="background: linear-gradient(135deg, #059669 0%, #10b981 50%, #0ea5e9 100%);">
                    <div class="relative z-10">
                        <div class="flex items-center gap-4">
                            <div class="w-16 h-16 bg-white/20 rounded-2xl flex items-center justify-center">
                                <span class="text-4xl">‚úÖ</span>
                            </div>
                            <div>
                                <h2 class="text-3xl md:text-4xl font-bold tracking-tight">Tasks & Follow-Ups</h2>
                                <p class="text-lg text-green-100 mt-1">Stay on top of your to-do list</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TASKS LIST -->
                <div class="bg-white rounded-2xl shadow-xl border-2 border-green-100 p-6 md:p-8">
                    <div class="flex justify-between items-center mb-6">
                        <div class="flex items-center gap-3">
                            <span class="text-4xl">üìù</span>
                            <div>
                                <h4 class="text-2xl font-black text-gray-900">All Tasks</h4>
                                <p class="text-sm text-gray-500">Your complete task list</p>
                            </div>
                        </div>
                        <button onclick="openTaskModal()" class="px-6 py-3 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-xl text-sm font-bold hover:from-green-700 hover:to-emerald-700 shadow-lg transform hover:scale-105 transition-all">
                            + Add Task
                        </button>
                    </div>
                    <p id="overdueText" class="text-sm text-gray-600 mb-4 font-medium">Loading...</p>
                    <div id="taskList" class="space-y-3 text-sm">
                        <!-- Tasks dynamically populated -->
                    </div>
                </div>
        </div>
        <!-- END TASKS TAB -->

        <!-- REPORTS TAB (standalone main tab) -->
        <div data-content="reports" class="tab-pane hidden">
                <!-- HERO SECTION -->
                <div class="hero-section mb-6" style="background: linear-gradient(135deg, #d97706 0%, #f59e0b 50%, #0ea5e9 100%);">
                    <div class="relative z-10">
                        <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-4">
                            <div class="flex items-center gap-4">
                                <div class="w-16 h-16 bg-white/20 rounded-2xl flex items-center justify-center">
                                    <span class="text-4xl">üí∞</span>
                                </div>
                                <div>
                                    <h2 class="text-3xl md:text-4xl font-bold tracking-tight">Financial Reports</h2>
                                    <p class="text-lg text-amber-100 mt-1">Track revenue, expenses & growth</p>
                                </div>
                            </div>
                            <div class="flex gap-2 flex-wrap">
                                <button onclick="showAddTransactionModal()" class="px-4 py-2 bg-white/20 hover:bg-white/30 text-white rounded-lg font-semibold transition-all">
                                    + Add
                                </button>
                                <button onclick="exportFinancialCSV()" class="px-4 py-2 bg-white/20 hover:bg-white/30 text-white rounded-lg font-semibold transition-all">
                                    Export
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- MODERN FINANCIAL SUMMARY CARDS -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-2xl shadow-xl border-2 border-green-100 p-6 hover:shadow-2xl transition-all">
                        <div class="flex items-center gap-2 mb-3">
                            <span class="text-3xl">üíµ</span>
                            <div class="text-base font-bold text-gray-600">Total Revenue</div>
                        </div>
                        <div id="totalRevenue" class="text-4xl font-black text-green-600">$0.00</div>
                    </div>
                    <div class="bg-white rounded-2xl shadow-xl border-2 border-red-100 p-6 hover:shadow-2xl transition-all">
                        <div class="flex items-center gap-2 mb-3">
                            <span class="text-3xl">üí≥</span>
                            <div class="text-base font-bold text-gray-600">Total Expenses</div>
                        </div>
                        <div id="totalExpenses" class="text-4xl font-black text-red-600">$0.00</div>
                    </div>
                    <div class="bg-white rounded-2xl shadow-xl border-2 border-blue-100 p-6 hover:shadow-2xl transition-all">
                        <div class="flex items-center gap-2 mb-3">
                            <span class="text-3xl">üìä</span>
                            <div class="text-base font-bold text-gray-600">Net Income</div>
                        </div>
                        <div id="netIncome" class="text-4xl font-black text-blue-600">$0.00</div>
                    </div>
                    <div class="bg-white rounded-2xl shadow-xl border-2 border-purple-100 p-6 hover:shadow-2xl transition-all">
                        <div class="flex items-center gap-2 mb-3">
                            <span class="text-3xl">üè¶</span>
                            <div class="text-base font-bold text-gray-600">Current Balance</div>
                        </div>
                        <div id="currentBalance" class="text-4xl font-black text-purple-600">$0.00</div>
                    </div>
                </div>

                <!-- MODERN FILTERS -->
                <div class="bg-gradient-to-r from-orange-50 to-rose-50 border-2 border-orange-200 rounded-2xl p-6 mb-8">
                    <div class="flex flex-col md:flex-row gap-4 items-start md:items-center">
                        <div class="flex items-center gap-3 flex-1">
                            <span class="text-2xl">üìÖ</span>
                            <div class="flex-1">
                                <label class="text-sm font-bold text-gray-700 mb-1 block">Period:</label>
                                <select id="financialPeriodFilter" onchange="renderFinancialRegister()" class="w-full border-2 border-orange-200 rounded-lg px-4 py-2.5 text-sm font-bold bg-white">
                                    <option value="all">All Time</option>
                                    <option value="current-month">Current Month</option>
                                    <option value="last-month">Last Month</option>
                                    <option value="current-year" selected>Current Year (2025)</option>
                                    <option value="q1">Q1 2025</option>
                                    <option value="q2">Q2 2025</option>
                                    <option value="q3">Q3 2025</option>
                                    <option value="q4">Q4 2025</option>
                                </select>
                            </div>
                        </div>
                        <div class="flex items-center gap-3 flex-1">
                            <span class="text-2xl">üè∑Ô∏è</span>
                            <div class="flex-1">
                                <label class="text-sm font-bold text-gray-700 mb-1 block">Category:</label>
                                <select id="financialCategoryFilter" onchange="renderFinancialRegister()" class="w-full border-2 border-orange-200 rounded-lg px-4 py-2.5 text-sm font-bold bg-white">
                                    <option value="all">All Categories</option>
                                    <option value="revenue">Revenue</option>
                                    <option value="cogs">COGS</option>
                                    <option value="operating">Operating Expenses</option>
                                    <option value="owner">Owner Draw</option>
                                </select>
                            </div>
                        </div>
                        <button onclick="showProfitLossReport()" class="px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl hover:from-blue-700 hover:to-indigo-700 font-bold shadow-lg transform hover:scale-105 transition-all whitespace-nowrap">
                            üìä View P&L Report
                        </button>
                    </div>
                </div>

                <!-- MODERN TRANSACTION TABLE -->
                <div class="bg-white rounded-2xl shadow-xl border-2 border-gray-100 overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead class="bg-gradient-to-r from-gray-50 to-gray-100 border-b-2 border-gray-200">
                                <tr>
                                    <th class="px-6 py-4 text-left font-black text-gray-700">Date</th>
                                    <th class="px-6 py-4 text-left font-black text-gray-700">Description</th>
                                    <th class="px-6 py-4 text-left font-black text-gray-700">Category</th>
                                    <th class="px-6 py-4 text-right font-black text-gray-700">Amount</th>
                                    <th class="px-6 py-4 text-right font-black text-gray-700">Balance</th>
                                    <th class="px-6 py-4 text-left font-black text-gray-700">Notes</th>
                                    <th class="px-6 py-4 text-center font-black text-gray-700">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="financialRegisterBody">
                                <tr>
                                    <td colspan="7" class="px-6 py-12 text-center text-gray-500 font-medium">
                                        Loading transactions...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- TRANSACTION COUNT -->
                <div class="mt-6 text-center">
                    <span id="transactionCount" class="text-base font-bold text-gray-600 bg-gray-100 px-6 py-3 rounded-xl">0 transactions</span>
                </div>
            </div>
        </div>
        <!-- END REPORTS TAB -->

        <!-- SALES PIPELINE TAB -->
        <div data-content="pipeline" class="tab-pane hidden">
            <!-- HERO SECTION -->
            <div class="hero-section mb-6" style="background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 50%, #0ea5e9 100%);">
                <div class="relative z-10">
                    <div class="flex items-center gap-4">
                        <div class="w-16 h-16 bg-white/20 rounded-2xl flex items-center justify-center">
                            <span class="text-4xl">üìä</span>
                        </div>
                        <div>
                            <h2 class="text-3xl md:text-4xl font-bold tracking-tight">Sales Pipeline</h2>
                            <p class="text-lg text-indigo-100 mt-1">Drag & drop to manage your deals</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SALES PIPELINE KANBAN -->
            <div class="bg-white rounded-2xl shadow-xl border-2 border-indigo-100 p-6 md:p-8">
                <div class="flex justify-between items-center mb-6 cursor-pointer" onclick="toggleSalesActivity()">
                    <div class="flex items-center gap-3">
                        <span class="text-4xl">üéØ</span>
                        <div>
                            <h4 class="text-2xl font-black text-gray-900">Your Pipeline</h4>
                            <p class="text-sm text-gray-500">Move cards between stages</p>
                        </div>
                    </div>
                    <button class="p-2 hover:bg-indigo-50 rounded-lg transition-colors">
                        <svg id="salesActivityToggleIcon" class="w-6 h-6 transform transition-transform duration-200 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </button>
                </div>

                <!-- Daily Goal Progress - always visible -->
                <div id="dailyGoalContainer">
                    <!-- Daily goal dynamically populated -->
                </div>

                <!-- CONTACT STATUS DASHBOARD -->
                <div id="contactStatusDashboardWrapper" class="mb-6">
                    <div class="bg-gradient-to-r from-emerald-50 to-teal-50 border-2 border-emerald-300 rounded-2xl p-4 md:p-6">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-3">
                                <span class="text-3xl">üìä</span>
                                <div>
                                    <h4 class="text-lg md:text-xl font-bold text-gray-900">Contact Status</h4>
                                    <p class="text-xs md:text-sm text-gray-600">Businesses contacted by channel</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-2">
                                <button onclick="openTemplatePicker()" class="text-sm text-purple-600 hover:text-purple-800 font-medium bg-purple-50 px-2 py-1 rounded">
                                    üìã Templates
                                </button>
                                <button onclick="toggleContactStatusExpanded()" id="btnContactStatusToggle" class="text-sm text-emerald-600 hover:text-emerald-800 font-medium">
                                    ‚ûï Expand
                                </button>
                                <button onclick="refreshContactStatusDashboard()" class="text-sm text-emerald-600 hover:text-emerald-800 font-medium">
                                    üîÑ
                                </button>
                            </div>
                        </div>

                        <!-- Summary Row (always visible) -->
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4">
                            <div onclick="showContactedByChannel('texted')" class="bg-white rounded-xl p-3 border border-green-200 cursor-pointer hover:border-green-400 transition-colors">
                                <div class="flex items-center justify-between">
                                    <span class="text-2xl">üì±</span>
                                    <span id="textedCount" class="text-2xl font-bold text-green-600">0</span>
                                </div>
                                <div class="text-xs font-medium text-gray-600 mt-1">Texted</div>
                            </div>
                            <div onclick="showContactedByChannel('emailed')" class="bg-white rounded-xl p-3 border border-blue-200 cursor-pointer hover:border-blue-400 transition-colors">
                                <div class="flex items-center justify-between">
                                    <span class="text-2xl">‚úâÔ∏è</span>
                                    <span id="emailedCount" class="text-2xl font-bold text-blue-600">0</span>
                                </div>
                                <div class="text-xs font-medium text-gray-600 mt-1">Emailed</div>
                            </div>
                            <div onclick="showContactedByChannel('facebookMessaged')" class="bg-white rounded-xl p-3 border border-indigo-200 cursor-pointer hover:border-indigo-400 transition-colors">
                                <div class="flex items-center justify-between">
                                    <span class="text-2xl">üìò</span>
                                    <span id="facebookCount" class="text-2xl font-bold text-indigo-600">0</span>
                                </div>
                                <div class="text-xs font-medium text-gray-600 mt-1">FB Messaged</div>
                            </div>
                            <div onclick="showContactedByChannel('dmed')" class="bg-white rounded-xl p-3 border border-pink-200 cursor-pointer hover:border-pink-400 transition-colors">
                                <div class="flex items-center justify-between">
                                    <span class="text-2xl">üì∑</span>
                                    <span id="instagramCount" class="text-2xl font-bold text-pink-600">0</span>
                                </div>
                                <div class="text-xs font-medium text-gray-600 mt-1">IG DM'd</div>
                            </div>
                        </div>

                        <!-- Expanded Detail Section - 4 columns showing all channels -->
                        <div id="contactStatusExpanded" class="hidden">
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                <!-- Texted Column -->
                                <div class="bg-white rounded-xl p-3 border border-green-200">
                                    <div class="flex items-center gap-2 mb-2 pb-2 border-b border-green-100">
                                        <span class="text-lg">üì±</span>
                                        <span class="font-bold text-green-700 text-sm">Texted</span>
                                    </div>
                                    <div id="textedList" class="space-y-2 max-h-64 overflow-y-auto">
                                        <p class="text-xs text-gray-400 italic">No texted businesses</p>
                                    </div>
                                </div>
                                <!-- Emailed Column -->
                                <div class="bg-white rounded-xl p-3 border border-blue-200">
                                    <div class="flex items-center gap-2 mb-2 pb-2 border-b border-blue-100">
                                        <span class="text-lg">‚úâÔ∏è</span>
                                        <span class="font-bold text-blue-700 text-sm">Emailed</span>
                                    </div>
                                    <div id="emailedList" class="space-y-2 max-h-64 overflow-y-auto">
                                        <p class="text-xs text-gray-400 italic">No emailed businesses</p>
                                    </div>
                                </div>
                                <!-- FB Messaged Column -->
                                <div class="bg-white rounded-xl p-3 border border-indigo-200">
                                    <div class="flex items-center gap-2 mb-2 pb-2 border-b border-indigo-100">
                                        <span class="text-lg">üìò</span>
                                        <span class="font-bold text-indigo-700 text-sm">FB Messaged</span>
                                    </div>
                                    <div id="facebookList" class="space-y-2 max-h-64 overflow-y-auto">
                                        <p class="text-xs text-gray-400 italic">No FB messaged businesses</p>
                                    </div>
                                </div>
                                <!-- IG DM'd Column -->
                                <div class="bg-white rounded-xl p-3 border border-pink-200">
                                    <div class="flex items-center gap-2 mb-2 pb-2 border-b border-pink-100">
                                        <span class="text-lg">üì∑</span>
                                        <span class="font-bold text-pink-700 text-sm">IG DM'd</span>
                                    </div>
                                    <div id="instagramList" class="space-y-2 max-h-64 overflow-y-auto">
                                        <p class="text-xs text-gray-400 italic">No IG DM'd businesses</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ANALYTICS DASHBOARD -->
                <div id="analyticsDashboardWrapper" class="mb-6">
                    <div class="bg-gradient-to-r from-slate-50 to-gray-50 border-2 border-slate-300 rounded-2xl p-4 md:p-6">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-3">
                                <span class="text-3xl">üìà</span>
                                <div>
                                    <h4 class="text-lg md:text-xl font-bold text-gray-900">Analytics</h4>
                                    <p class="text-xs md:text-sm text-gray-600">Performance metrics and trends</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-2">
                                <select id="analyticsTimeRange" onchange="refreshAnalytics()" class="text-sm border rounded px-2 py-1">
                                    <option value="7">Last 7 days</option>
                                    <option value="30" selected>Last 30 days</option>
                                    <option value="90">Last 90 days</option>
                                    <option value="all">All time</option>
                                </select>
                                <button onclick="exportAnalytics()" class="text-sm text-slate-600 hover:text-slate-800 font-medium">
                                    üì• Export
                                </button>
                            </div>
                        </div>

                        <!-- Key Metrics Row -->
                        <div class="grid grid-cols-2 md:grid-cols-5 gap-3 mb-4">
                            <div class="bg-white rounded-xl p-3 border border-slate-200">
                                <div class="text-xs font-medium text-gray-500 mb-1">Total Outreach</div>
                                <div id="analyticsTotalOutreach" class="text-2xl font-bold text-slate-700">0</div>
                            </div>
                            <div class="bg-white rounded-xl p-3 border border-green-200">
                                <div class="text-xs font-medium text-gray-500 mb-1">Response Rate</div>
                                <div id="analyticsResponseRate" class="text-2xl font-bold text-green-600">0%</div>
                            </div>
                            <div class="bg-white rounded-xl p-3 border border-blue-200">
                                <div class="text-xs font-medium text-gray-500 mb-1">Interested</div>
                                <div id="analyticsInterested" class="text-2xl font-bold text-blue-600">0</div>
                            </div>
                            <div class="bg-white rounded-xl p-3 border border-purple-200">
                                <div class="text-xs font-medium text-gray-500 mb-1">Conversion Rate</div>
                                <div id="analyticsConversionRate" class="text-2xl font-bold text-purple-600">0%</div>
                            </div>
                            <div class="bg-white rounded-xl p-3 border border-amber-200">
                                <div class="text-xs font-medium text-gray-500 mb-1">New Clients</div>
                                <div id="analyticsNewClients" class="text-2xl font-bold text-amber-600">0</div>
                            </div>
                        </div>

                        <!-- Channel Performance -->
                        <div class="bg-white rounded-xl p-4 border border-slate-200">
                            <div class="text-sm font-bold text-gray-700 mb-3">Channel Performance</div>
                            <div id="analyticsChannelBars" class="space-y-2">
                                <!-- Channel bars will be rendered here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Campaign Board Filters (persistent - not rebuilt with board) -->
                <div id="campaignBoardFilters"></div>

                <!-- Collapsible Kanban Columns -->
                <div id="salesActivityKanbanColumns" class="transition-all duration-300 ease-in-out overflow-hidden">
                    <!-- Kanban columns dynamically populated -->
                </div>
            </div>

            <!-- QUICK SEND (appears when prospects selected) -->
            <div id="bulkSendSection" class="hidden bg-gradient-to-br from-green-50 to-teal-50 rounded-2xl shadow-xl border-2 border-green-300 p-6 md:p-8 mt-8">
                <div class="flex items-center gap-3 mb-6">
                    <span class="text-4xl">üì§</span>
                    <div>
                        <h4 class="text-2xl font-black text-gray-900">Quick Send</h4>
                        <p class="text-sm text-gray-500">Send messages to <span id="bulkSendCount" class="font-bold text-green-600">(0 selected)</span> prospects</p>
                    </div>
                </div>

                <div class="space-y-4">
                    <div>
                        <label class="text-sm font-bold text-gray-700 block mb-2">Select Template</label>
                        <select id="bulkSendTemplateSelector" class="border-2 border-gray-300 rounded-lg p-3 w-full bg-white text-sm font-medium">
                            <option value="">‚Äî Choose a template ‚Äî</option>
                        </select>
                    </div>

                    <div id="bulkSendPreview" class="hidden p-4 bg-white rounded-lg border-2 border-gray-200">
                        <p class="text-xs font-bold text-gray-500 mb-2">Preview</p>
                        <p id="bulkSendPreviewText" class="text-sm text-gray-700 whitespace-pre-wrap"></p>
                    </div>

                    <div class="grid grid-cols-2 md:grid-cols-5 gap-3">
                        <button id="btnBulkSendSMS" onclick="bulkSendSMS()" class="px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-bold text-sm disabled:opacity-50 disabled:cursor-not-allowed shadow-lg" disabled>
                            üì± SMS
                        </button>
                        <button id="btnBulkSendGoogleVoice" onclick="bulkSendGoogleVoice()" class="px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 font-bold text-sm disabled:opacity-50 disabled:cursor-not-allowed shadow-lg" disabled>
                            üìû Voice
                        </button>
                        <button id="btnBulkSendEmail" onclick="bulkSendEmail()" class="px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 font-bold text-sm disabled:opacity-50 disabled:cursor-not-allowed shadow-lg" disabled>
                            üìß Email
                        </button>
                        <button id="btnBulkOpenLinkedIn" onclick="bulkOpenLinkedIn()" class="px-4 py-3 bg-sky-600 text-white rounded-lg hover:bg-sky-700 font-bold text-sm disabled:opacity-50 disabled:cursor-not-allowed shadow-lg" disabled>
                            üíº LinkedIn
                        </button>
                        <button id="btnBulkOpenFacebook" onclick="bulkOpenFacebook()" class="px-4 py-3 bg-blue-800 text-white rounded-lg hover:bg-blue-900 font-bold text-sm disabled:opacity-50 disabled:cursor-not-allowed shadow-lg" disabled>
                            üìò Facebook
                        </button>
                    </div>
                </div>
            </div>

        </div>

        <!-- LEAD GENERATION TAB -->
        <div data-content="lead-generation" class="tab-pane hidden">
            <!-- HERO SECTION (Simple Banner) -->
            <div class="hero-section mb-6">
                <div class="relative z-10">
                    <div class="flex items-center gap-4">
                        <div class="w-16 h-16 bg-white/20 rounded-2xl flex items-center justify-center">
                            <span class="text-4xl">üîç</span>
                        </div>
                        <div>
                            <h2 class="text-3xl md:text-4xl font-bold tracking-tight">Prospect Radar</h2>
                            <p class="text-lg text-blue-100 mt-1">Find local businesses by ZIP code</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SEARCH TOOL CARD (Collapsible) -->
            <div id="prospectRadarSection" class="mb-6">
                <!-- Collapsed State -->
                <div id="prospectRadarCollapsed" class="hidden bg-white rounded-xl border border-gray-200 p-4 cursor-pointer hover:shadow-md transition-all" onclick="toggleProspectRadar()">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                                <span class="text-xl">üîç</span>
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-900">Search for Prospects</h3>
                                <p class="text-sm text-gray-500">Click to expand search options</p>
                            </div>
                        </div>
                        <span class="text-gray-400 text-xl">‚ñº</span>
                    </div>
                </div>

                <!-- Expanded State (Search Interface) -->
                <div id="prospectRadarExpanded" class="bg-gradient-to-br from-purple-600 via-indigo-600 to-blue-500 rounded-xl p-6 text-white">
                    <!-- Header with Collapse Button -->
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center">
                                <span class="text-xl">üîç</span>
                            </div>
                            <h3 class="text-lg font-bold">Search for Prospects</h3>
                        </div>
                        <button onclick="toggleProspectRadar()" class="px-3 py-1.5 bg-white/20 hover:bg-white/30 text-white rounded-lg font-semibold text-sm flex items-center gap-2 transition-all" title="Collapse search">
                            <span>‚ñ≤</span>
                        </button>
                    </div>

                    <!-- Compact Search Layout -->
                    <div class="grid md:grid-cols-2 gap-4">
                        <!-- ZIP Code Input -->
                        <div class="bg-white/10 backdrop-blur-md rounded-xl px-4 py-3 border border-white/20">
                            <!-- Search Mode Tabs -->
                            <div class="flex gap-2 mb-3">
                                <button id="zipModeTab" onclick="setZipSearchMode('zips')" class="px-3 py-1 text-sm font-bold rounded-lg bg-white text-purple-600">
                                    Multiple ZIPs
                                </button>
                                <button id="radiusModeTab" onclick="setZipSearchMode('radius')" class="px-3 py-1 text-sm font-bold rounded-lg bg-white/20 text-white hover:bg-white/30">
                                    Radius Search
                                </button>
                            </div>

                            <!-- Multiple ZIPs Mode -->
                            <div id="multipleZipsMode">
                                <div class="text-sm text-purple-100 mb-2 font-semibold">üìç ZIP Codes (max 3)</div>
                                <div class="flex gap-2 items-center">
                                    <input id="bulkPopZip1" name="search_zip_primary" type="text" placeholder="ZIP 1" maxlength="5" autocomplete="new-password"
                                        class="w-20 px-3 py-2 bg-white border-2 border-purple-300 rounded-lg text-gray-800 text-center font-bold placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-purple-400" />
                                    <input id="bulkPopZip2" name="search_zip_secondary" type="text" placeholder="ZIP 2" maxlength="5" autocomplete="new-password"
                                        class="w-20 px-3 py-2 bg-white border-2 border-purple-300 rounded-lg text-gray-800 text-center font-bold placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-purple-400" />
                                    <input id="bulkPopZip3" name="search_zip_tertiary" type="text" placeholder="ZIP 3" maxlength="5" autocomplete="new-password"
                                        class="w-20 px-3 py-2 bg-white border-2 border-purple-300 rounded-lg text-gray-800 text-center font-bold placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-purple-400" />
                                </div>
                            </div>

                            <!-- Radius Search Mode -->
                            <div id="radiusSearchMode" class="hidden">
                                <div class="text-sm text-purple-100 mb-2 font-semibold">üìç Search within radius of ZIP</div>
                                <div class="flex gap-2 items-center">
                                    <input id="radiusCenterZip" type="text" placeholder="ZIP" maxlength="5"
                                        class="w-24 px-3 py-2 bg-white border-2 border-purple-300 rounded-lg text-gray-800 text-center font-bold placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-purple-400" />
                                    <span class="text-white font-bold">+</span>
                                    <input id="radiusMiles" type="number" placeholder="5" min="1" max="50" value="5"
                                        class="w-16 px-3 py-2 bg-white border-2 border-purple-300 rounded-lg text-gray-800 text-center font-bold placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-purple-400" />
                                    <span class="text-white font-semibold">miles</span>
                                </div>
                            </div>
                        </div>
                        <!-- Search Button -->
                        <div class="flex items-center">
                            <button id="btnRunBulkPopulate" onclick="runBulkAutoPopulate()"
                                class="w-full px-6 py-3 bg-white text-purple-600 text-lg font-black rounded-xl hover:bg-purple-50 transition-all shadow-lg hover:shadow-xl">
                                üîç Search Now
                            </button>
                        </div>
                    </div>

                    <!-- Business Categories -->
                    <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4 border border-white/20 mt-4">
                        <div class="flex items-center justify-between mb-3">
                            <h4 class="font-semibold flex items-center gap-2">
                                <span class="text-xl">üè¢</span> Business Categories (Select Multiple)
                            </h4>
                            <div class="flex gap-2">
                                <button onclick="openCategoryInsightsModal()" class="text-xs px-2 py-1 bg-green-500 hover:bg-green-600 rounded transition font-semibold">
                                    üí° Insights
                                </button>
                                <button onclick="openManageCategoriesModal()" class="text-xs px-2 py-1 bg-blue-500 hover:bg-blue-600 rounded transition font-semibold">
                                    ‚öôÔ∏è Manage
                                </button>
                                <label class="flex items-center gap-2 text-sm cursor-pointer hover:bg-white/20 px-3 py-1.5 rounded transition font-semibold">
                                    <input type="checkbox" id="selectAllCategories" class="rounded text-purple-600 focus:ring-purple-500" onclick="selectAllCategoriesHandler()" />
                                    <span>Select All</span>
                                </label>
                            </div>
                        </div>
                        <div id="categoryCheckboxContainer" class="max-h-96 overflow-y-auto pr-2" style="scrollbar-width: thin;">
                            <!-- Categories will be dynamically rendered here -->
                        </div>

                        <!-- Custom Category Input -->
                        <div class="mt-3 pt-3 border-t border-white/20">
                            <label class="flex items-center gap-2 text-sm mb-2">
                                <input type="checkbox" id="enableCustomCategory" class="category-checkbox rounded text-purple-600" onchange="toggleBulkCustomCategory()" />
                                <span class="font-medium">Add custom category</span>
                            </label>
                            <input
                                id="bulkCustomCategory"
                                type="text"
                                placeholder="e.g., bookstore, bakery, snowplowing, etc."
                                disabled
                                class="w-full px-3 py-2 bg-white/20 border border-white/30 rounded-lg text-white placeholder-purple-200 focus:outline-none focus:ring-2 focus:ring-white/50 disabled:opacity-50 disabled:cursor-not-allowed"
                            />
                        </div>
                    </div>

                </div><!-- End prospectRadarExpanded -->
            </div><!-- End prospectRadarSection -->

            <!-- Tip: Search results appear in the Businesses tab -->
            <div class="mt-6 bg-blue-50 border border-blue-200 rounded-xl p-4 text-center">
                <p class="text-blue-700 font-medium">üîç Search results will appear in the <strong>Businesses</strong> tab</p>
                <button onclick="switchTab('clients')" class="mt-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium text-sm">
                    Go to Businesses ‚Üí
                </button>
            </div>
        </div>

        <div data-content="manager" class="tab-pane hidden">
            <!-- HERO SECTION -->
            <div class="hero-section mb-6" style="background: linear-gradient(135deg, #7c3aed 0%, #8b5cf6 50%, #0ea5e9 100%);">
                <div class="relative z-10">
                    <div class="flex items-center gap-4">
                        <div class="w-16 h-16 bg-white/20 rounded-2xl flex items-center justify-center">
                            <span class="text-4xl">üìÆ</span>
                        </div>
                        <div>
                            <h2 class="text-3xl md:text-4xl font-bold tracking-tight">Postcard Campaigns</h2>
                            <p class="text-lg text-purple-100 mt-1">Design & track your postcards</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MODERN CAMPAIGN STATS -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-2xl shadow-xl border-2 border-indigo-100 p-6 hover:shadow-2xl transition-all">
                    <div class="flex items-center gap-2 mb-3">
                        <span class="text-3xl">üéØ</span>
                        <div class="text-base font-bold text-gray-600">Slots Sold</div>
                    </div>
                    <div class="flex items-baseline gap-2">
                        <div class="text-4xl font-black text-indigo-600" id="slotsSoldMetric">0/18</div>
                        <span class="text-lg text-gray-500 font-semibold" id="slotsSoldPercent"></span>
                    </div>
                    <div class="w-full h-3 bg-gray-200 rounded-full mt-3">
                        <div id="slotsSoldBar" class="h-3 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full transition-all duration-300 shadow-lg" style="width: 0%;"></div>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow-xl border-2 border-green-100 p-6 hover:shadow-2xl transition-all cursor-pointer" onclick="openPricingModal()">
                    <div class="flex items-center justify-between gap-2 mb-3">
                        <div class="flex items-center gap-2">
                            <span class="text-3xl">üí∞</span>
                            <div class="text-base font-bold text-gray-600">Revenue Progress</div>
                        </div>
                        <span class="text-sm text-green-600 font-bold bg-green-50 px-3 py-1 rounded-full">‚úé Pricing</span>
                    </div>
                    <div class="text-4xl font-black text-green-600" id="currentRevenue">$0</div>
                    <p class="text-sm text-gray-500 mt-2 font-medium" id="revenueProgressText">of $9,000 goal</p>
                    <div class="w-full h-3 bg-gray-200 rounded-full mt-3">
                        <div id="revenueProgressBar" class="h-3 bg-gradient-to-r from-green-500 to-emerald-500 rounded-full transition-all duration-300 shadow-lg" style="width: 0%;"></div>
                    </div>
                    <p class="text-xs text-gray-400 mt-2">Click to set ad rates</p>
                </div>

                <div class="bg-white rounded-2xl shadow-xl border-2 border-blue-100 p-6 hover:shadow-2xl transition-all">
                    <div class="flex items-center gap-2 mb-3">
                        <span class="text-3xl">üìä</span>
                        <div class="text-base font-bold text-gray-600">Profit/Loss</div>
                    </div>
                    <div id="profitStatus" class="text-4xl font-black text-gray-400">$0</div>
                    <p class="text-sm text-gray-500 mt-2 font-medium" id="spotsToBreakeven">Select a postcard</p>
                </div>

                <div class="bg-white rounded-2xl shadow-xl border-2 border-orange-100 p-6 hover:shadow-2xl transition-all cursor-pointer" onclick="openExpenseModal()">
                    <div class="flex items-center justify-between gap-2 mb-3">
                        <div class="flex items-center gap-2">
                            <span class="text-3xl">üí≥</span>
                            <div class="text-base font-bold text-gray-600">Total Expenses</div>
                        </div>
                        <span class="text-sm text-orange-600 font-bold bg-orange-50 px-3 py-1 rounded-full">‚úé Edit</span>
                    </div>
                    <div class="text-4xl font-black text-orange-600" id="oldTotalExpenses">$0</div>
                    <p class="text-sm text-gray-500 mt-2 font-medium">Click to manage expenses</p>
                </div>
            </div>

            <!-- MODERN CAMPAIGN CONTROLS -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                <!-- LEFT: New Campaign -->
                <div class="bg-white rounded-2xl shadow-xl border-2 border-green-200 p-6 hover:shadow-2xl transition-all">
                    <div class="flex items-center gap-2 mb-4">
                        <span class="text-3xl">‚ú®</span>
                        <div class="text-xl font-black text-gray-900">New Postcard Campaign</div>
                    </div>
                    <div class="space-y-3">
                        <button onclick="openNewPostcardModal()" class="w-full px-6 py-3 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-xl hover:from-green-700 hover:to-emerald-700 font-bold shadow-lg transform hover:scale-105 transition-all">
                            + Create Postcard
                        </button>
                        <!-- Duplicate feature disabled - had database sync issues
                        <button onclick="openDuplicatePostcardModal()" class="w-full px-6 py-3 bg-gradient-to-r from-teal-600 to-cyan-600 text-white rounded-xl hover:from-teal-700 hover:to-cyan-700 font-bold shadow-lg transform hover:scale-105 transition-all">
                            üìã Duplicate Card
                        </button>
                        -->
                    </div>
                    <p class="text-sm text-gray-600 mt-3 font-medium">Start or copy a campaign</p>
                </div>

                <!-- MIDDLE: Postcard Actions -->
                <div class="bg-white rounded-2xl shadow-xl border-2 border-blue-200 p-6 hover:shadow-2xl transition-all">
                    <div class="flex items-center gap-2 mb-4">
                        <span class="text-3xl">‚ö°</span>
                        <div class="text-xl font-black text-gray-900">Quick Actions</div>
                    </div>
                    <div class="flex flex-wrap gap-2">
                        <button id="btnEditStatusModal" onclick="openEditStatusModal()" class="flex-1 min-w-[100px] px-3 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700 text-xs font-bold transition-all transform hover:scale-105">
                            üìù Status
                        </button>
                        <button onclick="openEditDetailsModal()" class="flex-1 min-w-[100px] px-3 py-2 rounded-lg bg-teal-600 text-white hover:bg-teal-700 text-xs font-bold transition-all transform hover:scale-105">
                            üìÖ Details
                        </button>
                        <button id="btnAdjustPostcard" class="flex-1 min-w-[100px] px-3 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 text-xs font-bold transition-all transform hover:scale-105">
                            üé® Colors
                        </button>
                        <button onclick="deleteCurrentPostcard()" class="flex-1 min-w-[100px] px-3 py-2 rounded-lg bg-red-600 text-white hover:bg-red-700 text-xs font-bold transition-all transform hover:scale-105">
                            üóëÔ∏è Delete
                        </button>
                    </div>
                </div>

                <!-- RIGHT: Auto-Save Status -->
                <div class="bg-gradient-to-br from-green-500 to-emerald-600 rounded-2xl shadow-2xl border-2 border-green-300 p-6 text-white">
                    <div class="flex items-center gap-2 mb-4">
                        <span class="text-3xl">‚òÅÔ∏è</span>
                        <div class="text-xl font-black">Auto-Save Active</div>
                    </div>
                    <div class="bg-white/20 backdrop-blur rounded-xl p-4">
                        <p class="text-sm font-medium text-center">‚ú® All changes save automatically</p>
                        <p class="text-xs text-white/90 text-center mt-2">No manual saving required!</p>
                    </div>
                </div>
            </div>
            <div class="side-wrap mb-12" id="frontWrap">
                <h2 class="font-semibold mb-2 text-lg text-gray-900">Front Side</h2>
                <div class="postcard" id="frontPostcard">
                    <div id="frontGrid" class="grid-front"></div>
                </div>
            </div>
            <div class="side-wrap mb-16" id="backWrap">
                <h2 class="font-semibold mb-2 text-lg text-gray-900">Back Side</h2>
                <div class="postcard" id="backPostcard">
                    <div id="backGrid" class="grid-back"></div>
                </div>
            </div>
        </div>
        
        <!-- BUSINESSES TAB (Combined Prospects + Clients) -->
        <div data-content="clients" class="tab-pane hidden">
            <!-- HERO SECTION -->
            <div class="hero-section mb-6" style="background: linear-gradient(135deg, #1d4ed8 0%, #3b82f6 50%, #0ea5e9 100%);">
                <div class="relative z-10">
                    <div class="flex items-center gap-4">
                        <div class="w-16 h-16 bg-white/20 rounded-2xl flex items-center justify-center">
                            <span class="text-4xl">üë•</span>
                        </div>
                        <div>
                            <h2 class="text-3xl md:text-4xl font-bold tracking-tight">Businesses</h2>
                            <p class="text-lg text-blue-100 mt-1">All prospects and clients in one place</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- DISCOVERED PROSPECTS SECTION (from Prospect Radar searches) -->
            <div id="inlineProspectPool" class="mb-6">
                <!-- Header -->
                <div class="bg-white rounded-xl border border-gray-200 p-5 md:p-6 mb-4" style="box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
                    <!-- Header Row -->
                    <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-3 mb-4">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-lg bg-purple-50 flex items-center justify-center">
                                <span class="text-xl">üéØ</span>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900">Discovered Prospects</h3>
                                <p class="text-sm text-gray-500">From Prospect Radar searches ‚Ä¢ Select to add to Pipeline</p>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="openAddManualBusinessModal()" class="px-3 py-1.5 bg-purple-600 text-white rounded-lg text-sm font-medium hover:bg-purple-700 transition-colors">
                                + Add Manually
                            </button>
                            <button onclick="exportProspectPoolCSV()" class="px-3 py-1.5 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-200 transition-colors">
                                Export
                            </button>
                        </div>
                    </div>

                    <!-- Stats Row -->
                    <div id="inlineProspectPoolStats" class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4">
                        <!-- Stats populated by JavaScript -->
                    </div>

                    <!-- Filter Buttons - Large Centered Colored -->
                    <div class="grid grid-cols-3 gap-3">
                        <!-- ZIP Filter -->
                        <div class="relative">
                            <button onclick="toggleFilterDropdown('zip')" class="w-full flex items-center justify-center gap-2 px-4 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl font-semibold transition-all shadow-md">
                                <span class="text-lg">üìç</span>
                                <span>ZIP: <span id="zipFilterSummary" class="font-bold">All</span></span>
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                            </button>
                            <div id="zipFilterDropdown" class="hidden absolute top-full left-0 right-0 mt-2 bg-white border-2 border-indigo-200 rounded-xl shadow-2xl z-50 p-4 max-h-[300px] overflow-y-auto">
                                <div id="inlineProspectPoolZipCheckboxes" class="flex flex-wrap gap-2">
                                    <!-- ZIP checkboxes populated by JavaScript -->
                                </div>
                            </div>
                        </div>

                        <!-- Category Filter -->
                        <div class="relative">
                            <button onclick="toggleFilterDropdown('category')" class="w-full flex items-center justify-center gap-2 px-4 py-3 bg-emerald-600 hover:bg-emerald-700 text-white rounded-xl font-semibold transition-all shadow-md">
                                <span class="text-lg">üè¢</span>
                                <span>Category: <span id="categoryFilterSummary" class="font-bold">All</span></span>
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                            </button>
                            <div id="categoryFilterDropdown" class="hidden absolute top-full left-0 right-0 mt-2 bg-white border-2 border-emerald-200 rounded-xl shadow-2xl z-50 p-4 max-h-[300px] overflow-y-auto">
                                <div id="prospectPoolCategoryCheckboxes" class="flex flex-wrap gap-2">
                                    <!-- Category checkboxes populated by JavaScript -->
                                </div>
                            </div>
                        </div>

                        <!-- Status Filter -->
                        <div class="relative">
                            <button onclick="toggleFilterDropdown('status')" id="statusFilterBtn" class="w-full flex items-center justify-center gap-2 px-4 py-3 bg-amber-500 hover:bg-amber-600 text-white rounded-xl font-semibold transition-all shadow-md">
                                <span class="text-lg">üë•</span>
                                <span id="statusFilterSummary">All Prospects</span>
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                            </button>
                            <div id="statusFilterDropdown" class="hidden absolute top-full left-0 right-0 mt-2 bg-white border-2 border-amber-200 rounded-xl shadow-2xl z-50 p-2">
                                <button onclick="setProspectStatusFilter('all')" class="w-full text-left px-4 py-2 hover:bg-amber-50 rounded-lg font-medium">üë• All Prospects</button>
                                <button onclick="setProspectStatusFilter('new')" class="w-full text-left px-4 py-2 hover:bg-amber-50 rounded-lg font-medium">üÜï New Only</button>
                                <button onclick="setProspectStatusFilter('existing')" class="w-full text-left px-4 py-2 hover:bg-amber-50 rounded-lg font-medium">‚≠ê Existing Clients</button>
                            </div>
                            <select id="prospectPoolClientFilter" onchange="filterProspectPoolByClientStatus()" class="hidden">
                                <option value="all">All Prospects</option>
                                <option value="new">New Only</option>
                                <option value="existing">Existing Clients</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div id="inlineProspectPoolContainer">
                    <div class="text-center py-12 text-gray-500 bg-white rounded-xl border border-gray-200">
                        <span class="text-4xl mb-4 block">üîç</span>
                        <p class="text-lg font-medium">No prospects discovered yet</p>
                        <p class="text-sm mb-4">Use Prospect Radar to search for local businesses</p>
                        <button onclick="switchTab('lead-generation')" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 font-medium text-sm">
                            Go to Prospect Radar ‚Üí
                        </button>
                    </div>
                </div>

                <!-- ACTION BAR for inline pool -->
                <div id="inlineProspectPoolActionBar" class="fixed bottom-6 left-1/2 transform -translate-x-1/2 z-40 transition-all duration-300" style="display: none;">
                    <div class="bg-gradient-to-r from-emerald-600 to-teal-600 rounded-full shadow-2xl border-2 border-emerald-300 px-6 py-3 flex items-center gap-4">
                        <div class="flex items-center gap-2 text-white">
                            <span id="inlineProspectPoolSelectedCount" class="text-2xl font-black">0</span>
                            <span class="text-sm font-medium">selected</span>
                        </div>
                        <button id="btnAddFromPool" onclick="addFromProspectPool()" class="px-6 py-2 bg-white text-emerald-600 rounded-full font-bold text-sm hover:bg-emerald-50 shadow-lg transform hover:scale-105 transition-all">
                            üìä Add to Pipeline
                        </button>
                        <button onclick="clearProspectPoolSelection()" class="text-white hover:text-emerald-100 transition-colors" title="Clear selection">
                            ‚úï
                        </button>
                    </div>
                </div>
            </div>

            <!-- BUSINESSES SECTION (CRM Clients) -->
            <div class="bg-white rounded-xl border border-gray-200 p-5 md:p-6" style="box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
                <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-4 mb-5">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-lg bg-blue-50 flex items-center justify-center">
                            <span class="text-xl">üíº</span>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-900">Business Directory</h3>
                    </div>
                    <div class="flex gap-2 flex-wrap">
                        <button onclick="document.getElementById('csvFileInput').click()" class="px-3 py-1.5 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-200 transition-colors">
                            Import
                        </button>
                        <input type="file" id="csvFileInput" accept=".csv" onchange="importClientsCSV(event)" style="display: none;" />
                        <button onclick="exportClientsCSV()" class="px-3 py-1.5 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-200 transition-colors">
                            Export
                        </button>
                        <button onclick="openClientModal()" class="px-3 py-1.5 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors">
                            + Add Business
                        </button>
                    </div>
                </div>

                <!-- TYPE FILTER BUTTONS -->
                <div class="flex gap-2 mb-4">
                    <button onclick="setBusinessTypeFilter('all')" id="filterAll" class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium transition-colors">
                        All
                    </button>
                    <button onclick="setBusinessTypeFilter('prospects')" id="filterProspects" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-200 transition-colors">
                        Prospects
                    </button>
                    <button onclick="setBusinessTypeFilter('clients')" id="filterClients" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-200 transition-colors">
                        Clients
                    </button>
                </div>

                <!-- SEARCH & FILTERS -->
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 mb-5">
                    <input id="clientSearch" type="text" placeholder="Search by business name, category, or contact..."
                           class="w-full p-3 border border-gray-200 rounded-lg font-medium focus:border-blue-400 focus:ring focus:ring-blue-100 transition-all" onkeyup="filterClients()" />

                    <div class="flex gap-3 flex-wrap">
                        <select id="categoryFilter" class="border-2 border-indigo-200 rounded-lg p-2.5 text-sm font-bold bg-white flex-1 min-w-[150px]" onchange="filterClients()">
                            <option value="">All Categories</option>
                            <!-- Categories populated dynamically from businessCategories -->
                        </select>

                        <select id="statusFilter" class="border-2 border-indigo-200 rounded-lg p-2.5 text-sm font-bold bg-white flex-1 min-w-[150px]" onchange="filterClients()">
                            <option value="">All Clients</option>
                            <option value="active">Active (Paid Card)</option>
                            <option value="pending">Pending Payment</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>
                </div>

                <div id="clientList" class="space-y-3">
                    <p class="text-base text-gray-500 text-center py-12 font-medium">No clients yet. Add your first client above!</p>
                </div>

                <!-- QUICK SEND SECTION (appears when clients are selected) -->
                <div id="clientBulkSendSection" class="hidden mt-6 bg-gradient-to-r from-indigo-50 to-purple-50 border-2 border-indigo-300 rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h4 class="text-lg font-bold text-gray-900">üìß Quick Send to Selected Clients</h4>
                            <p class="text-sm text-gray-600"><span id="clientSelectedCount">0</span> client(s) selected</p>
                        </div>
                        <div class="flex gap-2 flex-wrap">
                            <button onclick="selectAllClients()" class="px-3 py-1.5 text-sm bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-medium">
                                Select All Visible
                            </button>
                            <button onclick="clearClientSelection()" class="px-3 py-1.5 text-sm bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-medium">
                                Clear Selection
                            </button>
                            <div class="w-full border-t border-gray-300 my-1"></div>
                            <button onclick="selectActiveClientsForRenewal()" class="px-3 py-1.5 text-sm bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium">
                                üìß Select Active (Renewal)
                            </button>
                            <button onclick="selectInactiveClientsForReactivation()" class="px-3 py-1.5 text-sm bg-orange-600 text-white rounded-lg hover:bg-orange-700 font-medium">
                                üîÑ Select Paused/Inactive (Reactivation)
                            </button>
                        </div>
                    </div>

                    <div class="space-y-3">
                        <div>
                            <label class="text-sm font-medium text-gray-700 block mb-2">Choose Template:</label>
                            <select id="clientBulkSendTemplateSelector" class="border-2 border-indigo-200 rounded-lg p-3 w-full bg-white font-medium">
                                <option value="">‚Äî Choose a template ‚Äî</option>
                            </select>
                        </div>

                        <div id="clientBulkSendPreview" class="hidden bg-white border-2 border-gray-200 rounded-lg p-3">
                            <div class="text-xs font-semibold text-gray-600 mb-1">Preview:</div>
                            <pre id="clientBulkSendPreviewText" class="text-sm text-gray-700 whitespace-pre-wrap font-sans"></pre>
                        </div>

                        <div class="flex gap-3">
                            <button onclick="clientBulkSendSMS()" class="flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-bold shadow-md">
                                üì± Send SMS
                            </button>
                            <button onclick="clientBulkSendEmail()" class="flex-1 px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 font-bold shadow-md">
                                ‚úâÔ∏è Send Email
                            </button>
                            <button onclick="clientBulkSendGoogleVoice()" class="flex-1 px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 font-bold shadow-md">
                                üìû Google Voice
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- OUTREACH WORKSHEET TAB -->
        <div data-content="outreach" class="tab-pane hidden">
            <!-- HERO SECTION -->
            <div class="hero-section mb-6" style="background: linear-gradient(135deg, #059669 0%, #10b981 50%, #34d399 100%);">
                <div class="relative z-10">
                    <div class="flex items-center gap-4">
                        <div class="w-16 h-16 bg-white/20 rounded-2xl flex items-center justify-center">
                            <span class="text-4xl">üìû</span>
                        </div>
                        <div>
                            <h2 class="text-3xl md:text-4xl font-bold tracking-tight">Outreach Worksheet</h2>
                            <p class="text-lg text-green-100 mt-1">Work through your prospects efficiently</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CAMPAIGN SELECTOR BAR -->
            <div class="mb-4 bg-white rounded-xl shadow-md border border-gray-200 p-3">
                <div class="flex flex-col sm:flex-row items-start sm:items-center gap-3">
                    <div class="flex items-center gap-2">
                        <span class="text-xl">üìã</span>
                        <span class="text-sm font-semibold text-gray-700">Campaign:</span>
                    </div>
                    <div class="flex flex-wrap items-center gap-2">
                        <select id="outreachTownSelect" onchange="onOutreachTownChanged()" class="border border-gray-300 rounded-lg px-3 py-1.5 text-sm bg-white font-medium focus:ring-2 focus:ring-green-500 focus:border-green-500" style="min-width: 140px;">
                            <option value="">‚Äî Select Town ‚Äî</option>
                        </select>
                        <select id="outreachMonthSelect" onchange="onOutreachMonthChanged()" class="border border-gray-300 rounded-lg px-3 py-1.5 text-sm bg-white font-medium focus:ring-2 focus:ring-green-500 focus:border-green-500" style="min-width: 160px;">
                            <option value="">‚Äî Select Month ‚Äî</option>
                        </select>
                        <span id="outreachCampaignLabel" class="text-sm text-gray-500 ml-2"></span>
                    </div>
                </div>
            </div>

            <!-- SPLIT LAYOUT: List + Detail Panel -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- LEFT: Prospect List -->
                <div class="lg:col-span-2 bg-white rounded-2xl shadow-xl border-2 border-green-100 overflow-hidden">
                    <!-- Header with filters -->
                    <div class="p-4 border-b border-gray-100 bg-gray-50">
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3">
                            <div class="flex items-center gap-2">
                                <span class="text-2xl">üéØ</span>
                                <div>
                                    <h4 class="text-lg font-bold text-gray-900">Prospects</h4>
                                    <p id="outreachStats" class="text-xs text-gray-500">0 to contact</p>
                                </div>
                            </div>
                            <div class="flex gap-2">
                                <select id="outreachCategoryFilter" onchange="filterOutreachTable()" class="border border-gray-300 rounded-lg px-2 py-1.5 text-sm bg-white">
                                    <option value="">All Categories</option>
                                </select>
                                <select id="outreachColumnFilter" onchange="filterOutreachTable()" class="border border-gray-300 rounded-lg px-2 py-1.5 text-sm bg-white">
                                    <option value="all" selected>All Pipeline</option>
                                    <option value="queued">Prospect List</option>
                                    <option value="attempting">Attempting</option>
                                    <option value="negotiating">Negotiating</option>
                                    <option value="invoice-sent">Invoice Sent</option>
                                    <option value="proof-approved">Proof Approved</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Sortable Table -->
                    <div class="overflow-x-auto max-h-[600px] overflow-y-auto">
                        <table class="w-full text-sm">
                            <thead class="bg-gray-50 sticky top-0">
                                <tr>
                                    <th onclick="sortOutreach('businessName')" class="px-3 py-2 text-left font-bold text-gray-700 cursor-pointer hover:bg-gray-100">
                                        <span class="flex items-center gap-1">Business <span id="sortIcon_businessName" class="text-xs">‚ñ≤</span></span>
                                    </th>
                                    <th onclick="sortOutreach('category')" class="px-3 py-2 text-left font-bold text-gray-700 cursor-pointer hover:bg-gray-100">
                                        <span class="flex items-center gap-1">Category <span id="sortIcon_category" class="text-xs text-gray-400">‚Üï</span></span>
                                    </th>
                                    <th onclick="sortOutreach('phone')" class="px-3 py-2 text-center font-bold text-gray-700 cursor-pointer hover:bg-gray-100">
                                        <span class="flex items-center justify-center gap-1">üìû <span id="sortIcon_phone" class="text-xs text-gray-400">‚Üï</span></span>
                                    </th>
                                    <th onclick="sortOutreach('email')" class="px-3 py-2 text-center font-bold text-gray-700 cursor-pointer hover:bg-gray-100">
                                        <span class="flex items-center justify-center gap-1">üìß <span id="sortIcon_email" class="text-xs text-gray-400">‚Üï</span></span>
                                    </th>
                                    <th onclick="sortOutreach('facebook')" class="px-3 py-2 text-center font-bold text-gray-700 cursor-pointer hover:bg-gray-100">
                                        <span class="flex items-center justify-center gap-1">FB <span id="sortIcon_facebook" class="text-xs text-gray-400">‚Üï</span></span>
                                    </th>
                                    <th onclick="sortOutreach('instagram')" class="px-3 py-2 text-center font-bold text-gray-700 cursor-pointer hover:bg-gray-100">
                                        <span class="flex items-center justify-center gap-1">IG <span id="sortIcon_instagram" class="text-xs text-gray-400">‚Üï</span></span>
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="outreachTableBody" class="divide-y divide-gray-100">
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Empty state -->
                    <div id="outreachEmptyState" class="hidden py-12 text-center">
                        <span class="text-5xl mb-4 block">üéØ</span>
                        <p class="text-lg font-semibold text-gray-600">No prospects in this column</p>
                        <p class="text-sm text-gray-500 mt-1">Add prospects from Prospect Radar or the Pipeline tab</p>
                    </div>
                </div>

                <!-- RIGHT: Selected Prospect Panel -->
                <div class="bg-white rounded-2xl shadow-xl border-2 border-green-100 overflow-hidden">
                    <!-- No prospect selected -->
                    <div id="outreachNoSelection" class="p-8 text-center">
                        <span class="text-5xl mb-4 block">üëÜ</span>
                        <p class="text-lg font-semibold text-gray-600">Select a Prospect</p>
                        <p class="text-sm text-gray-500 mt-1">Click a row to see details and outreach options</p>
                    </div>

                    <!-- Selected prospect details -->
                    <div id="outreachSelectedPanel" class="hidden">
                        <!-- Prospect Header -->
                        <div class="p-4 bg-gradient-to-r from-green-500 to-emerald-500 text-white">
                            <div class="flex items-center gap-3">
                                <div id="outreachSelectedIcon" class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center text-2xl">üè¢</div>
                                <div class="flex-1 min-w-0">
                                    <h3 id="outreachSelectedName" class="font-bold text-lg truncate">Business Name</h3>
                                    <p id="outreachSelectedCategory" class="text-sm text-green-100">Category</p>
                                </div>
                                <button onclick="openOutreachProspectCRM()" class="px-3 py-1.5 bg-white/20 hover:bg-white/30 rounded-lg text-sm font-medium" title="Open full CRM card">
                                    Open CRM
                                </button>
                            </div>
                        </div>

                        <!-- Contact Info -->
                        <div class="p-4 border-b border-gray-100">
                            <div class="grid grid-cols-2 gap-3 text-sm">
                                <div>
                                    <span class="text-gray-500 text-xs block">Phone</span>
                                    <a id="outreachSelectedPhone" href="#" class="text-green-600 font-medium hover:underline">‚Äî</a>
                                </div>
                                <div>
                                    <span class="text-gray-500 text-xs block">Email</span>
                                    <a id="outreachSelectedEmail" href="#" class="text-blue-600 font-medium hover:underline truncate block">‚Äî</a>
                                </div>
                                <div>
                                    <span class="text-gray-500 text-xs block">Facebook</span>
                                    <a id="outreachSelectedFB" href="#" target="_blank" class="text-blue-600 font-medium hover:underline">‚Äî</a>
                                </div>
                                <div>
                                    <span class="text-gray-500 text-xs block">Instagram</span>
                                    <a id="outreachSelectedIG" href="#" target="_blank" class="text-pink-600 font-medium hover:underline">‚Äî</a>
                                </div>
                            </div>
                        </div>

                        <!-- Notes -->
                        <div class="p-4 border-b border-gray-100">
                            <p class="text-xs font-bold text-gray-500 uppercase mb-2">Notes</p>
                            <textarea id="outreachNotes" class="w-full bg-gray-50 rounded-lg p-2 text-sm text-gray-700 border border-gray-200 focus:border-indigo-400 focus:ring-1 focus:ring-indigo-400 resize-y min-h-[50px]" placeholder="Add notes about this prospect..." onblur="saveOutreachNotes()"></textarea>
                        </div>

                        <!-- Quick Actions -->
                        <div class="p-4 border-b border-gray-100">
                            <p class="text-xs font-bold text-gray-500 uppercase mb-3">Quick Actions</p>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="outreachQuickCall()" class="px-3 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg text-sm font-bold flex items-center justify-center gap-1">
                                    üìû Call
                                </button>
                                <button onclick="outreachQuickEmail()" class="px-3 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg text-sm font-bold flex items-center justify-center gap-1">
                                    üìß Email
                                </button>
                                <button onclick="outreachMarkContacted()" class="px-3 py-2 bg-amber-500 hover:bg-amber-600 text-white rounded-lg text-sm font-bold flex items-center justify-center gap-1 col-span-2">
                                    ‚úì Mark Contacted
                                </button>
                            </div>
                        </div>

                        <!-- Templates Section -->
                        <div class="p-4">
                            <div class="flex justify-between items-center mb-3">
                                <p class="text-xs font-bold text-gray-500 uppercase">Message Templates</p>
                                <button onclick="saveOutreachTemplates()" class="text-xs text-green-600 hover:text-green-800 font-medium">Save as Default</button>
                            </div>
                            <!-- Template Tabs -->
                            <div class="flex gap-1 mb-2">
                                <button onclick="switchOutreachTemplate('text')" data-outreach-template="text" class="outreach-template-btn flex-1 px-2 py-1.5 text-xs font-bold rounded-lg bg-green-100 text-green-700">üí¨ Text</button>
                                <button onclick="switchOutreachTemplate('email')" data-outreach-template="email" class="outreach-template-btn flex-1 px-2 py-1.5 text-xs font-bold rounded-lg bg-gray-100 text-gray-600 hover:bg-gray-200">üìß Email</button>
                                <button onclick="switchOutreachTemplate('phone')" data-outreach-template="phone" class="outreach-template-btn flex-1 px-2 py-1.5 text-xs font-bold rounded-lg bg-gray-100 text-gray-600 hover:bg-gray-200">üìû Script</button>
                            </div>
                            <!-- Variable Insert Buttons -->
                            <div id="outreachVariableButtons" class="flex flex-wrap gap-1 mb-2">
                                <span class="text-xs text-gray-400 mr-1 self-center">Insert:</span>
                                <button onclick="insertOutreachVariable('BUSINESS_NAME')" class="px-1.5 py-0.5 bg-indigo-50 hover:bg-indigo-100 text-indigo-600 rounded text-xs border border-indigo-200">Business</button>
                                <button onclick="insertOutreachVariable('CATEGORY')" class="px-1.5 py-0.5 bg-purple-50 hover:bg-purple-100 text-purple-600 rounded text-xs border border-purple-200">Category</button>
                                <button onclick="insertOutreachVariable('ZIP')" class="px-1.5 py-0.5 bg-blue-50 hover:bg-blue-100 text-blue-600 rounded text-xs border border-blue-200">ZIP</button>
                                <button onclick="insertOutreachVariable('SPOT_PRICE')" class="px-1.5 py-0.5 bg-green-50 hover:bg-green-100 text-green-600 rounded text-xs border border-green-200">Price</button>
                                <button onclick="insertOutreachVariable('YOUR_NAME')" class="px-1.5 py-0.5 bg-amber-50 hover:bg-amber-100 text-amber-600 rounded text-xs border border-amber-200">Name</button>
                            </div>

                            <!-- Text Template -->
                            <div id="outreachTemplateText" class="outreach-template-pane">
                                <!-- Phone number display for quick lookup in Google Voice -->
                                <div id="outreachTextPhoneDisplay" class="bg-blue-50 border border-blue-200 rounded-lg p-2 mb-2 flex items-center justify-between">
                                    <span class="text-sm font-bold text-blue-900" id="outreachTextPhoneNumber">No phone on file</span>
                                    <button onclick="copyOutreachPhone()" class="px-2 py-1 bg-blue-500 hover:bg-blue-600 text-white text-xs rounded font-bold">Copy #</button>
                                </div>
                                <textarea id="outreachTextPreview" class="w-full bg-gray-50 rounded-lg p-3 text-sm text-gray-700 mb-2 min-h-[100px] border border-gray-200 focus:border-green-400 focus:ring-1 focus:ring-green-400 resize-y" placeholder="Select a prospect to fill template...">Hey! I'm putting together a community postcard for [ZIP] and wanted to see if [BUSINESS_NAME] would be interested in being featured. You'd be the only [CATEGORY] on the card. Want me to send over the details?</textarea>
                                <div class="grid grid-cols-2 gap-2">
                                    <button onclick="copyOutreachTemplate('text')" class="px-3 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-bold">Copy Message</button>
                                    <button onclick="outreachOpenGoogleVoice()" class="px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-bold">Open GV</button>
                                </div>
                                <p class="text-xs text-gray-400 mt-2 text-center">Copy message first, then paste into Google Voice</p>
                            </div>

                            <!-- Email Template -->
                            <div id="outreachTemplateEmail" class="outreach-template-pane hidden">
                                <input id="outreachEmailSubject" type="text" class="w-full bg-gray-50 rounded-lg px-3 py-2 text-sm font-bold text-gray-900 mb-2 border border-gray-200 focus:border-purple-400 focus:ring-1 focus:ring-purple-400" value="Quick question about local advertising" />
                                <textarea id="outreachEmailPreview" class="w-full bg-gray-50 rounded-lg p-3 text-sm text-gray-700 mb-2 min-h-[120px] border border-gray-200 focus:border-purple-400 focus:ring-1 focus:ring-purple-400 resize-y">Hi,

I'm putting together a community postcard going to about 5,000 homes in [ZIP]. I think [BUSINESS_NAME] would be a great fit - you'd be the only [CATEGORY] on the card.

The cost is [SPOT_PRICE] for a premium spot. Interested in learning more?

[YOUR_NAME]</textarea>
                                <button onclick="copyOutreachTemplate('email')" class="w-full px-3 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg text-sm font-bold">Copy & Open Email</button>
                            </div>

                            <!-- Phone Script -->
                            <div id="outreachTemplatePhone" class="outreach-template-pane hidden">
                                <div class="space-y-2 text-xs">
                                    <div class="p-2 bg-green-50 rounded-lg">
                                        <span class="font-bold text-green-800">1. Intro:</span>
                                        <span class="text-gray-700"> "Hey, this is [YOUR_NAME]. I do local advertising in [ZIP]. Quick question - do you do any direct mail?"</span>
                                    </div>
                                    <div class="p-2 bg-emerald-50 rounded-lg">
                                        <span class="font-bold text-emerald-800">2. Pitch:</span>
                                        <span class="text-gray-700"> "I'm putting together a postcard for 5,000 homes. You'd be the ONLY [CATEGORY] on it."</span>
                                    </div>
                                    <div class="p-2 bg-teal-50 rounded-lg">
                                        <span class="font-bold text-teal-800">3. Price:</span>
                                        <span class="text-gray-700"> "It's [SPOT_PRICE]. If even ONE person calls from this, you've made it back."</span>
                                    </div>
                                    <div class="p-2 bg-cyan-50 rounded-lg">
                                        <span class="font-bold text-cyan-800">4. Close:</span>
                                        <span class="text-gray-700"> "Want me to save your spot?"</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Move to Stage -->
                        <div class="p-4 bg-gray-50 border-t border-gray-100">
                            <p class="text-xs font-bold text-gray-500 uppercase mb-2">Move to Stage</p>
                            <div class="flex gap-2">
                                <button onclick="outreachMoveToStage('negotiating')" class="flex-1 px-2 py-1.5 bg-amber-100 hover:bg-amber-200 text-amber-800 rounded-lg text-xs font-bold">Negotiating</button>
                                <button onclick="outreachMoveToStage('invoice-sent')" class="flex-1 px-2 py-1.5 bg-green-100 hover:bg-green-200 text-green-800 rounded-lg text-xs font-bold">Invoice Sent</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
  </main>

  <!-- Edit Spot Modal -->
  <div id="editModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" id="editDialog" aria-labelledby="modalTitle">
      <h3 id="modalTitle" class="text-lg font-bold mb-3">Edit Selected Spots</h3>
      <div class="mb-4">
        <label class="text-sm font-medium text-gray-700">Link to Client</label>
        <div class="flex gap-2">
          <select id="editClient" class="border rounded-md flex-1 p-2 bg-white">
            <option value="">‚Äî Select existing client ‚Äî</option>
          </select>
          <button type="button" onclick="quickAddClient()" class="px-3 py-2 bg-gray-100 border rounded-md hover:bg-gray-200 text-sm">
            + New
          </button>
        </div>
        <p class="text-xs text-gray-500 mt-1">Select a client to auto-fill business name below</p>
      </div>
      <div class="mb-4">
        <label class="text-sm font-medium text-gray-700">Enter Business Name</label>
        <input id="editName" class="border rounded-md w-full p-2 mt-1" placeholder="Example: Adam's Pizza" />
      </div>
      <div class="mb-4">
        <label class="text-sm font-medium text-gray-700">Status</label>
        <select id="editStatus" class="border rounded-md w-full p-2 mt-1 bg-white">
          <option value="AVAIL">Available</option>
          <option value="INVOICE">Invoice Sent</option>
          <option value="DEPOSIT">Deposit Paid</option>
          <option value="PROOF">Proof In Progress</option>
          <option value="APPROVED">Ad Approved</option>
          <option value="PAID">Paid In Full</option>
          <option value="RESERVED">Reserved</option>
        </select>
      </div>
      <div class="mb-4">
        <label class="text-sm font-medium text-gray-700">Spot Price</label>
        <div class="relative mt-1">
          <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">$</span>
          <input id="editPrice" type="number" step="50" class="border rounded-md w-full p-2" style="padding-left:2rem" placeholder="500" />
        </div>
        <p class="text-xs text-gray-500 mt-1">Price for this specific ad spot</p>
      </div>
      <div id="editImageSection" class="mb-4 p-4 bg-gray-50 rounded-lg border border-gray-200">
        <label class="text-sm font-medium text-gray-700 block mb-2">Ad Image</label>
        <div id="editImagePreview" class="hidden mb-3">
          <img id="editImageThumb" src="" alt="Ad preview" class="w-full h-32 object-cover rounded-md border border-gray-300" />
        </div>
        <div class="flex gap-2">
          <button type="button" id="btnUploadAdImage" onclick="uploadAdImageFromModal()" class="flex-1 px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm font-medium">
            üì∑ Upload Ad Image
          </button>
          <button type="button" id="btnRemoveAdImage" onclick="removeAdImageFromModal()" class="hidden px-3 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 text-sm font-medium">
            üóëÔ∏è Remove
          </button>
        </div>
        <p class="text-xs text-gray-500 mt-2">Upload your Canva design (PNG, JPG - max 5MB)</p>
      </div>
      <div class="flex justify-end gap-2">
        <button id="btnCancelEdit" class="px-3 py-1.5 border rounded-md bg-gray-100 hover:bg-gray-200">Cancel</button>
        <button id="btnApplyEdit" class="px-3 py-1.5 bg-blue-600 text-white rounded-md hover:bg-blue-700">Apply</button>
      </div>
    </div>
  </div>
  
  <!-- Postcard Color Modal -->
  <div id="postcardModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" id="postcardDialog">
      <h3>Adjust Postcard Colors</h3>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px">
        <div>
          <label style="display:block;font-weight:700;margin-bottom:6px">Postcard Background</label>
          <input id="pickerPostcard" type="color" value="#000000" />
        </div>
        <div>
          <label style="display:block;font-weight:700;margin-bottom:6px">Banner (front) Background</label>
          <input id="pickerBanner" type="color" value="#fed7aa" />
        </div>
      </div>
      <div style="margin-bottom:12px">
        <div style="font-size:.9rem;color:#374151;margin-bottom:6px">Preview</div>
        <div style="display:flex;gap:12px;align-items:center">
          <div id="previewPostcard" style="width:160px;height:100px;border-radius:8px;border:1px solid #e5e7eb;display:flex;align-items:center;justify-content:center;background:#000">
            <div id="previewBanner" style="background:#000000;padding:6px 8px;border-radius:6px"><span style="font-weight:800;color:#ffffff">TOWN ‚Äî MONTH</span></div>
          </div>
          <div style="font-size:.9rem;color:#6b7280">Postcard bg controls the simulated postcard container. Banner bg changes the front postcard banner visually and will be saved on Commit.</div>
        </div>
      </div>
      <div style="display:flex;justify-content:flex-end;gap:8px">
        <button id="btnCancelPostcard" class="px-3 py-1.5 border rounded-md bg-gray-100 hover:bg-gray-200">Cancel</button>
        <button id="btnApplyPostcard" class="px-3 py-1.5 bg-green-600 text-white rounded-md hover:bg-green-700">Apply & Close</button>
      </div>
    </div>
  </div>
  
  <!-- Duplicate Postcard Modal -->
  <div id="duplicatePostcardModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" style="max-width: 600px;">
      <h3 class="text-lg font-bold mb-4">Duplicate Postcard</h3>

      <div class="space-y-4">
        <!-- Select Source Postcard -->
        <div class="p-4 bg-blue-50 rounded-lg border border-blue-200">
          <h4 class="font-semibold text-blue-900 mb-2">Select Postcard to Duplicate</h4>
          <select id="duplicateSourcePostcard" class="border rounded-md p-2 w-full bg-white">
            <option value="">‚Äî Select postcard ‚Äî</option>
          </select>
        </div>

        <!-- New Details -->
        <div class="p-4 bg-orange-50 rounded-lg border border-orange-200">
          <h4 class="font-semibold text-orange-900 mb-3">New Details (must change at least one)</h4>
          <div class="space-y-3">
            <div>
              <label class="text-sm font-medium block mb-1">New Town (optional)</label>
              <input id="duplicateTown" type="text" class="border rounded-md p-2 w-full" placeholder="Leave empty to keep same town" />
            </div>
            <div class="grid grid-cols-2 gap-2">
              <div>
                <label class="text-sm font-medium block mb-1">New Month (optional)</label>
                <select id="duplicateMonth" class="border rounded-md p-2 w-full bg-white">
                  <option value="">Keep same</option>
                  <option value="01">January</option>
                  <option value="02">February</option>
                  <option value="03">March</option>
                  <option value="04">April</option>
                  <option value="05">May</option>
                  <option value="06">June</option>
                  <option value="07">July</option>
                  <option value="08">August</option>
                  <option value="09">September</option>
                  <option value="10">October</option>
                  <option value="11">November</option>
                  <option value="12">December</option>
                </select>
              </div>
              <div>
                <label class="text-sm font-medium block mb-1">New Year (optional)</label>
                <input id="duplicateYear" type="number" class="border rounded-md p-2 w-full" placeholder="Keep same" />
              </div>
            </div>
            <div>
              <label class="text-sm font-medium block mb-1">New Size (optional)</label>
              <select id="duplicateSize" class="border rounded-md p-2 w-full bg-white">
                <option value="">Keep same</option>
                <option value="9x12">9√ó12</option>
                <option value="6x12">6.5√ó12</option>
              </select>
            </div>
          </div>
        </div>

        <!-- What to Copy -->
        <div class="p-4 bg-purple-50 rounded-lg border border-purple-200">
          <h4 class="font-semibold text-purple-900 mb-2">What to Copy</h4>
          <div class="space-y-2">
            <label class="flex items-center gap-2">
              <input type="checkbox" id="duplicateCopyAdvertisers" checked />
              <span class="text-sm">Copy all advertisers (as "Reserved")</span>
            </label>
            <label class="flex items-center gap-2">
              <input type="checkbox" id="duplicateCopyExpenses" checked />
              <span class="text-sm">Copy expenses</span>
            </label>
            <label class="flex items-center gap-2">
              <input type="checkbox" id="duplicateCopyPricing" checked />
              <span class="text-sm">Copy pricing (single/double/banner costs)</span>
            </label>
            <label class="flex items-center gap-2">
              <input type="checkbox" id="duplicateCopyColors" checked />
              <span class="text-sm">Copy postcard & banner colors</span>
            </label>
          </div>
        </div>
      </div>

      <div class="flex justify-end gap-2 mt-6">
        <button id="btnCancelDuplicate" class="px-4 py-2 border rounded-md bg-gray-100 hover:bg-gray-200">Cancel</button>
        <button id="btnCreateDuplicate" class="px-6 py-2 bg-teal-600 text-white rounded-md hover:bg-teal-700 font-semibold">
          Create Duplicate
        </button>
      </div>
    </div>
  </div>

  <!-- Set Pricing Modal -->
  <div id="pricingModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" style="max-width: 500px;">
      <h3 class="text-lg font-bold mb-4">Set Ad Pricing</h3>

      <div class="space-y-4">
        <!-- Market Info Section -->
        <div class="bg-blue-50 rounded-lg p-4 border border-blue-200">
          <p class="text-sm font-semibold text-blue-900 mb-2">üìç Market Info</p>
          <div>
            <label class="text-sm font-medium block mb-1">Households Reached</label>
            <input id="pricingHomeCount" type="number" min="0" class="border rounded-md p-2 w-full" placeholder="e.g., 5000" />
            <p class="text-xs text-gray-500 mt-1">Number of homes this postcard reaches (shown on 10kpostcards.com)</p>
          </div>
        </div>

        <div class="bg-purple-50 rounded-lg p-4 border border-purple-200">
          <p class="text-sm text-gray-700 mb-3">Set the price you charge clients for each ad type. This will auto-calculate revenue in your profit/loss card.</p>

          <div class="space-y-3">
            <div>
              <label class="text-sm font-medium block mb-1">Single Ad Cost ($)</label>
              <input id="pricingSingleAd" type="number" step="0.01" class="border rounded-md p-2 w-full" placeholder="e.g., 199.00" />
            </div>
            <div>
              <label class="text-sm font-medium block mb-1">Double Ad Cost ($)</label>
              <input id="pricingDoubleAd" type="number" step="0.01" class="border rounded-md p-2 w-full" placeholder="e.g., 349.00" />
            </div>
            <div>
              <label class="text-sm font-medium block mb-1">Banner Ad Cost ($)</label>
              <input id="pricingBannerAd" type="number" step="0.01" class="border rounded-md p-2 w-full" placeholder="e.g., 699.00" />
            </div>
          </div>
        </div>

        <!-- Revenue Goal Calculator -->
        <div class="bg-green-50 rounded-lg p-4 border border-green-200">
          <div class="text-sm font-semibold text-green-900 mb-3">üìä Revenue Goal Calculator</div>
          <p class="text-xs text-gray-600 mb-3">Set your revenue goal based on how many of each ad size you plan to sell:</p>

          <div class="space-y-3">
            <div class="flex gap-3 items-center">
              <div class="flex-1">
                <label class="text-xs font-medium block mb-1">Singles (#)</label>
                <input id="goalSingleCount" type="number" min="0" class="border rounded-md p-2 w-full text-sm" placeholder="0" oninput="updateRevenueGoalCalculator()" />
              </div>
              <div class="flex-1">
                <label class="text-xs font-medium block mb-1">Price Each ($)</label>
                <input id="goalSinglePrice" type="number" step="0.01" min="0" class="border rounded-md p-2 w-full text-sm" placeholder="0.00" oninput="updateRevenueGoalCalculator()" />
              </div>
              <div class="flex-1 text-right">
                <label class="text-xs font-medium block mb-1">Subtotal</label>
                <div id="goalSingleTotal" class="text-sm font-semibold text-gray-700">$0.00</div>
              </div>
            </div>

            <div class="flex gap-3 items-center">
              <div class="flex-1">
                <label class="text-xs font-medium block mb-1">Doubles (#)</label>
                <input id="goalDoubleCount" type="number" min="0" class="border rounded-md p-2 w-full text-sm" placeholder="0" oninput="updateRevenueGoalCalculator()" />
              </div>
              <div class="flex-1">
                <label class="text-xs font-medium block mb-1">Price Each ($)</label>
                <input id="goalDoublePrice" type="number" step="0.01" min="0" class="border rounded-md p-2 w-full text-sm" placeholder="0.00" oninput="updateRevenueGoalCalculator()" />
              </div>
              <div class="flex-1 text-right">
                <label class="text-xs font-medium block mb-1">Subtotal</label>
                <div id="goalDoubleTotal" class="text-sm font-semibold text-gray-700">$0.00</div>
              </div>
            </div>

            <div class="flex gap-3 items-center">
              <div class="flex-1">
                <label class="text-xs font-medium block mb-1">Banners (#)</label>
                <input id="goalBannerCount" type="number" min="0" class="border rounded-md p-2 w-full text-sm" placeholder="0" oninput="updateRevenueGoalCalculator()" />
              </div>
              <div class="flex-1">
                <label class="text-xs font-medium block mb-1">Price Each ($)</label>
                <input id="goalBannerPrice" type="number" step="0.01" min="0" class="border rounded-md p-2 w-full text-sm" placeholder="0.00" oninput="updateRevenueGoalCalculator()" />
              </div>
              <div class="flex-1 text-right">
                <label class="text-xs font-medium block mb-1">Subtotal</label>
                <div id="goalBannerTotal" class="text-sm font-semibold text-gray-700">$0.00</div>
              </div>
            </div>

            <div class="border-t border-green-300 pt-3 mt-3">
              <div class="flex justify-between items-center">
                <span class="text-sm font-bold text-green-900">Total Revenue Goal:</span>
                <span id="goalTotalRevenue" class="text-lg font-bold text-green-700">$0.00</span>
              </div>
            </div>

            <div class="border-t border-gray-300 pt-3 mt-3">
              <div class="flex justify-between items-center">
                <span class="text-sm font-medium text-gray-700">Less: Total Expenses:</span>
                <span id="goalTotalExpenses" class="text-sm font-medium text-red-600">$0.00</span>
              </div>
            </div>

            <div class="border-t border-blue-300 pt-3 mt-3">
              <div class="flex justify-between items-center">
                <span class="text-sm font-bold text-blue-900">Profit:</span>
                <span id="goalProfit" class="text-lg font-bold text-blue-700">$0.00</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="flex justify-end gap-2 mt-6">
        <button id="btnCancelPricing" class="px-4 py-2 border rounded-md bg-gray-100 hover:bg-gray-200">Cancel</button>
        <button id="btnSavePricing" class="px-6 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 font-semibold">
          Save Pricing
        </button>
      </div>
    </div>
  </div>

  <!-- Edit Status Modal (Legend + Sort) -->
  <div id="editStatusModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" style="max-width: 700px;">
      <h3 class="text-lg font-bold mb-4">Edit Status Colors & Order</h3>

      <!-- Current Status Colors Legend -->
      <div class="bg-blue-50 rounded-lg p-4 mb-4 border border-blue-200">
        <div class="font-medium text-blue-900 text-sm mb-2">Current Status Colors:</div>
        <div id="editStatusLegendGrid" class="flex gap-3 flex-wrap text-xs">
          <!-- Populated dynamically -->
        </div>
      </div>

      <!-- Sort Interface -->
      <div class="mb-4">
        <div class="font-medium text-gray-700 text-sm mb-2">Drag to Reorder:</div>
        <div class="flex gap-3 items-start">
          <div class="flex-1">
            <div id="sortListContainer" style="background:#fafafa;border:1px solid #e6eef4;border-radius:8px;padding:8px;min-height:200px"></div>
          </div>
          <div style="width:240px">
            <div style="font-size:.9rem;color:#374151;margin-bottom:8px">Preview (left ‚Üí right)</div>
            <div id="sortPreview" style="height:48px;border-radius:6px;border:1px solid #e6eef4"></div>
          </div>
        </div>
      </div>

      <div class="flex justify-end gap-2">
        <button id="btnCancelEditStatus" class="px-4 py-2 border rounded-md bg-gray-100 hover:bg-gray-200">Cancel</button>
        <button id="btnSaveEditStatus" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Edit Postcard Details Modal -->
  <div id="editDetailsModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" style="max-width: 500px;">
      <h3 class="text-lg font-bold mb-4">Edit Postcard Details</h3>

      <div class="space-y-4">
        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Expected In Homes Date</label>
          <input id="editInHomesDate" type="date" class="border rounded-md p-2 w-full" />
          <p class="text-xs text-gray-500 mt-1">Date when the postcard is expected to arrive in mailboxes</p>
        </div>
        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Households Reached</label>
          <input id="editHouseholdsReached" type="number" min="0" step="100" class="border rounded-md p-2 w-full" placeholder="e.g., 5000" />
          <p class="text-xs text-gray-500 mt-1">Number of homes this postcard reaches (used in outreach templates)</p>
        </div>
        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">ZIP Code</label>
          <input id="editZipCode" type="text" maxlength="10" class="border rounded-md p-2 w-full" placeholder="e.g., 14217" />
          <p class="text-xs text-gray-500 mt-1">Primary ZIP code for this campaign (used in outreach templates as [ZIP])</p>
        </div>
      </div>

      <div class="flex justify-end gap-2 mt-6">
        <button onclick="closeEditDetailsModal()" class="px-4 py-2 border rounded-md bg-gray-100 hover:bg-gray-200">Cancel</button>
        <button onclick="saveEditDetailsModal()" class="px-4 py-2 bg-teal-600 text-white rounded-md hover:bg-teal-700">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Expense Management Modal -->
  <div id="expenseModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" id="expenseDialog" style="max-width: 640px;">
      <h3 class="text-lg font-bold mb-4">Manage Postcard Expenses</h3>
      
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="text-sm font-medium text-gray-700 block mb-1">Printing Cost</label>
            <div class="relative">
              <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">$</span>
              <input id="expensePrinting" type="number" step="10" class="border rounded-md w-full p-2" style="padding-left:2rem" placeholder="0" oninput="updateExpenseTotal()" />
            </div>
          </div>

          <div>
            <label class="text-sm font-medium text-gray-700 block mb-1">Address Count</label>
            <input id="expenseAddressCount" type="number" step="100" class="border rounded-md w-full p-2" placeholder="0" oninput="calculateEDDMPostage()" />
            <p class="text-xs text-gray-500 mt-1"># of addresses mailed</p>
          </div>

          <div>
            <label class="text-sm font-medium text-gray-700 block mb-1">Postage Cost (EDDM)</label>
            <div class="relative">
              <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">$</span>
              <input id="expensePostage" type="number" step="10" class="border rounded-md w-full p-2" style="padding-left:2rem" placeholder="0" oninput="updateExpenseTotal()" readonly />
            </div>
            <p class="text-xs text-gray-500 mt-1">$0.247 √ó address count</p>
          </div>

          <div>
            <label class="text-sm font-medium text-gray-700 block mb-1">Design/Labor Cost</label>
            <div class="relative">
              <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">$</span>
              <input id="expenseDesign" type="number" step="10" class="border rounded-md w-full p-2" style="padding-left:2rem" placeholder="0" oninput="updateExpenseTotal()" />
            </div>
          </div>

          <div>
            <label class="text-sm font-medium text-gray-700 block mb-1">Misc/Other Costs</label>
            <div class="relative">
              <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">$</span>
              <input id="expenseMisc" type="number" step="10" class="border rounded-md w-full p-2" style="padding-left:2rem" placeholder="0" oninput="updateExpenseTotal()" />
            </div>
          </div>
        </div>
        
        <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
          <div class="flex justify-between items-center">
            <span class="font-semibold text-gray-700">Total Expenses:</span>
            <span id="expenseTotal" class="text-2xl font-bold text-orange-600">$0</span>
          </div>
        </div>
        
      </div>
      
      <div class="flex justify-end gap-2 mt-6">
        <button id="btnCancelExpense" class="px-4 py-2 border rounded-md bg-gray-100 hover:bg-gray-200">Cancel</button>
        <button id="btnSaveExpense" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">Save Expenses</button>
      </div>
    </div>
  </div>

  <!-- Manage Business Categories Modal -->
  <div id="manageCategoriesModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" style="max-width: 600px; max-height: 90vh; overflow-y: auto;">
      <h3 class="text-lg font-bold mb-4">‚öôÔ∏è Manage Business Categories</h3>

      <div class="space-y-4">
        <!-- Add New Category Section -->
        <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
          <label class="text-sm font-medium text-gray-700 block mb-2">Add New Category</label>
          <div class="flex gap-2">
            <input
              id="newCategoryInput"
              type="text"
              class="border rounded-md flex-1 p-2"
              placeholder="e.g., Coffee Shop"
              onkeypress="if(event.key==='Enter') addNewCategory()"
            />
            <button onclick="addNewCategory()" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 font-semibold">
              ‚ûï Add
            </button>
          </div>
        </div>

        <!-- Current Categories List -->
        <div>
          <label class="text-sm font-medium text-gray-700 block mb-2">Current Categories</label>
          <div id="manageCategoriesList" class="space-y-2 max-h-96 overflow-y-auto pr-2" style="scrollbar-width: thin;">
            <!-- Categories will be rendered here -->
          </div>
        </div>
      </div>

      <div class="flex justify-end gap-2 mt-6">
        <button onclick="closeManageCategoriesModal()" class="px-4 py-2 border rounded-md bg-gray-100 hover:bg-gray-200">Close</button>
        <button onclick="saveManageCategories()" class="px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700">üíæ Save Categories</button>
      </div>
    </div>
  </div>

  <!-- Category Insights Modal -->
  <div id="categoryInsightsModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-xl font-bold flex items-center gap-2">üí° Category Insights: Advertiser ROI Guide</h3>
        <button onclick="closeCategoryInsightsModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
      </div>

      <p class="text-gray-600 mb-4">Use this guide to identify the best prospects for your postcard advertising. Categories are ranked by how likely they are to see positive ROI from a $200-600/month ad investment.</p>

      <!-- Tier Legend -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-6">
        <div class="bg-green-50 border-2 border-green-500 rounded-lg p-3">
          <div class="flex items-center gap-2 mb-1">
            <span class="w-3 h-3 bg-green-500 rounded-full"></span>
            <span class="font-bold text-green-800">Tier 1: Highest Value</span>
          </div>
          <p class="text-sm text-green-700">One job = 3-12+ months of ad cost. These businesses can afford the ad from a single new customer.</p>
        </div>
        <div class="bg-blue-50 border-2 border-blue-500 rounded-lg p-3">
          <div class="flex items-center gap-2 mb-1">
            <span class="w-3 h-3 bg-blue-500 rounded-full"></span>
            <span class="font-bold text-blue-800">Tier 2: Strong Value</span>
          </div>
          <p class="text-sm text-blue-700">Repeat customers build recurring revenue. Lifetime customer value easily covers ad cost.</p>
        </div>
        <div class="bg-yellow-50 border-2 border-yellow-500 rounded-lg p-3">
          <div class="flex items-center gap-2 mb-1">
            <span class="w-3 h-3 bg-yellow-500 rounded-full"></span>
            <span class="font-bold text-yellow-800">Tier 3: Moderate Value</span>
          </div>
          <p class="text-sm text-yellow-700">Good ROI with the right customer. May need multiple new customers to justify ad spend.</p>
        </div>
      </div>

      <!-- Category Details by Tier -->
      <div id="categoryInsightsContent" class="space-y-6">
        <!-- Will be populated by JavaScript -->
      </div>

      <div class="flex justify-between items-center mt-6 pt-4 border-t">
        <p class="text-sm text-gray-500">üí° Tip: Focus on Tier 1 & 2 categories for highest close rates</p>
        <button onclick="closeCategoryInsightsModal()" class="px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700">Close</button>
      </div>
    </div>
  </div>

  <!-- Daily Goal Settings Modal -->
  <div id="dailyGoalSettingsModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" style="max-width: 500px;">
      <h3 class="text-lg font-bold mb-4">‚öôÔ∏è Daily Outreach Goal Settings</h3>

      <div class="space-y-4">
        <!-- Set Daily Goal -->
        <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
          <label class="text-sm font-medium text-gray-700 block mb-2">Daily Outreach Goal</label>
          <div class="flex gap-2 items-center">
            <input
              id="dailyGoalInput"
              type="number"
              min="1"
              class="border rounded-md flex-1 p-2"
              placeholder="Enter number of contacts per day"
              onkeypress="if(event.key==='Enter') saveDailyGoalFromModal()"
            />
            <span class="text-sm text-gray-600">contacts/day</span>
          </div>
          <p class="text-xs text-gray-500 mt-2">Set how many prospects you want to contact each day.</p>
        </div>

        <!-- Reset Count Button -->
        <div class="bg-red-50 p-4 rounded-lg border border-red-200">
          <label class="text-sm font-medium text-gray-700 block mb-2">Reset Today's Count</label>
          <button onclick="resetDailyGoalFromModal()" class="w-full px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 font-medium">
            üîÑ Reset Count to 0
          </button>
          <p class="text-xs text-gray-500 mt-2">Reset today's outreach count back to zero.</p>
        </div>
      </div>

      <div class="flex justify-end gap-2 mt-6">
        <button onclick="closeDailyGoalSettings()" class="px-4 py-2 border rounded-md bg-gray-100 hover:bg-gray-200">Cancel</button>
        <button onclick="saveDailyGoalFromModal()" class="px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700">üíæ Save Goal</button>
      </div>
    </div>
  </div>

  <!-- Client Management Modal -->
  <div id="clientModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" style="max-width: 700px; max-height: 90vh; overflow-y: auto;">
      <h3 id="clientModalTitle" class="text-lg font-bold mb-4">Add New Client</h3>
      
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-4">
          <div class="col-span-2">
            <label class="text-sm font-medium text-gray-700 block mb-1">Business Name *</label>
            <input id="clientBusinessName" type="text" class="border rounded-md w-full p-2" placeholder="Adam's Pizza" required />
          </div>
          
          <div>
            <label class="text-sm font-medium text-gray-700 block mb-1">Category</label>
            <select id="clientCategory" class="border rounded-md w-full p-2 bg-white">
              <option value="">Select category...</option>
              <!-- Categories populated dynamically from businessCategories -->
            </select>
          </div>
          
          <div>
            <label class="text-sm font-medium text-gray-700 block mb-1">Contact Name</label>
            <input id="clientContactName" type="text" class="border rounded-md w-full p-2" placeholder="Adam Smith" />
          </div>

          <div>
            <label class="text-sm font-medium text-gray-700 block mb-1">First Name</label>
            <input id="clientFirstName" type="text" class="border rounded-md w-full p-2" placeholder="Adam" />
          </div>

          <div>
            <label class="text-sm font-medium text-gray-700 block mb-1">Phone</label>
            <input id="clientPhone" type="tel" class="border rounded-md w-full p-2" placeholder="(555) 123-4567" />
          </div>

          <div>
            <label class="text-sm font-medium text-gray-700 block mb-1">Email</label>
            <input id="clientEmail" type="email" class="border rounded-md w-full p-2" placeholder="adam@adamspizza.com" />
          </div>

          <div>
            <label class="text-sm font-medium text-gray-700 block mb-1">Monthly Price</label>
            <div class="relative">
              <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">$</span>
              <input id="clientMonthlyPrice" type="number" step="50" class="border rounded-md w-full p-2" style="padding-left:2rem" placeholder="500" />
            </div>
          </div>

          <div>
            <label class="text-sm font-medium text-gray-700 block mb-1">Client Status</label>
            <select id="clientStatus" class="border rounded-md w-full p-2 bg-white">
              <option value="active">‚úÖ Active - Currently advertising</option>
              <option value="paused">‚è∏Ô∏è Paused - Temporary break</option>
              <option value="inactive">‚ùå Inactive - Not advertising</option>
            </select>
          </div>
        </div>

        <!-- Active Months Calendar -->
        <div class="bg-blue-50 border-2 border-blue-200 rounded-lg p-4">
          <label class="text-sm font-semibold text-blue-900 block mb-2">üìÖ Active Months (for seasonal businesses)</label>
          <p class="text-xs text-gray-600 mb-3">Select which months this client wants to advertise (e.g., landscapers skip winter):</p>
          <div class="grid grid-cols-12 gap-2">
            <label class="flex flex-col items-center cursor-pointer">
              <input type="checkbox" id="activeMonth0" class="h-4 w-4 text-blue-600 rounded mb-1" checked />
              <span class="text-xs font-medium">J</span>
            </label>
            <label class="flex flex-col items-center cursor-pointer">
              <input type="checkbox" id="activeMonth1" class="h-4 w-4 text-blue-600 rounded mb-1" checked />
              <span class="text-xs font-medium">F</span>
            </label>
            <label class="flex flex-col items-center cursor-pointer">
              <input type="checkbox" id="activeMonth2" class="h-4 w-4 text-blue-600 rounded mb-1" checked />
              <span class="text-xs font-medium">M</span>
            </label>
            <label class="flex flex-col items-center cursor-pointer">
              <input type="checkbox" id="activeMonth3" class="h-4 w-4 text-blue-600 rounded mb-1" checked />
              <span class="text-xs font-medium">A</span>
            </label>
            <label class="flex flex-col items-center cursor-pointer">
              <input type="checkbox" id="activeMonth4" class="h-4 w-4 text-blue-600 rounded mb-1" checked />
              <span class="text-xs font-medium">M</span>
            </label>
            <label class="flex flex-col items-center cursor-pointer">
              <input type="checkbox" id="activeMonth5" class="h-4 w-4 text-blue-600 rounded mb-1" checked />
              <span class="text-xs font-medium">J</span>
            </label>
            <label class="flex flex-col items-center cursor-pointer">
              <input type="checkbox" id="activeMonth6" class="h-4 w-4 text-blue-600 rounded mb-1" checked />
              <span class="text-xs font-medium">J</span>
            </label>
            <label class="flex flex-col items-center cursor-pointer">
              <input type="checkbox" id="activeMonth7" class="h-4 w-4 text-blue-600 rounded mb-1" checked />
              <span class="text-xs font-medium">A</span>
            </label>
            <label class="flex flex-col items-center cursor-pointer">
              <input type="checkbox" id="activeMonth8" class="h-4 w-4 text-blue-600 rounded mb-1" checked />
              <span class="text-xs font-medium">S</span>
            </label>
            <label class="flex flex-col items-center cursor-pointer">
              <input type="checkbox" id="activeMonth9" class="h-4 w-4 text-blue-600 rounded mb-1" checked />
              <span class="text-xs font-medium">O</span>
            </label>
            <label class="flex flex-col items-center cursor-pointer">
              <input type="checkbox" id="activeMonth10" class="h-4 w-4 text-blue-600 rounded mb-1" checked />
              <span class="text-xs font-medium">N</span>
            </label>
            <label class="flex flex-col items-center cursor-pointer">
              <input type="checkbox" id="activeMonth11" class="h-4 w-4 text-blue-600 rounded mb-1" checked />
              <span class="text-xs font-medium">D</span>
            </label>
          </div>
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Notes</label>
          <textarea id="clientNotes" rows="3" class="border rounded-md w-full p-2" placeholder="Special requests, preferences, etc."></textarea>
        </div>

        <!-- Contract Section -->
        <div class="border-t pt-4">
          <div class="flex justify-between items-center mb-3">
            <h4 class="font-semibold text-gray-700">Multi-Month Contract (Optional)</h4>
            <label class="flex items-center gap-2">
              <input type="checkbox" id="hasContract" onchange="toggleContractFields()" />
              <span class="text-sm">Enable Contract</span>
            </label>
          </div>

          <div id="contractFields" class="hidden space-y-3">
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="text-sm font-medium text-gray-700 block mb-1">Contract Start Date</label>
                <input id="contractStartDate" type="date" class="border rounded-md w-full p-2" onchange="calculateContractEnd()" />
              </div>
              <div>
                <label class="text-sm font-medium text-gray-700 block mb-1">Contract Length</label>
                <select id="contractLength" class="border rounded-md w-full p-2 bg-white" onchange="calculateContractEnd()">
                  <option value="1">1 month</option>
                  <option value="3">3 months</option>
                  <option value="6" selected>6 months</option>
                  <option value="12">12 months</option>
                </select>
              </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="text-sm font-medium text-gray-700 block mb-1">Monthly Rate</label>
                <div class="relative">
                  <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">$</span>
                  <input id="contractMonthlyRate" type="number" step="50" class="border rounded-md w-full p-2" style="padding-left:2rem" placeholder="500" onchange="calculateContractTotal()" />
                </div>
              </div>
              <div>
                <label class="text-sm font-medium text-gray-700 block mb-1">Total Contract Value</label>
                <div id="contractTotalValue" class="text-2xl font-bold text-green-600 mt-1">$0</div>
              </div>
            </div>

            <div class="bg-gray-50 p-3 rounded-md">
              <div class="text-sm text-gray-700 mb-1">Contract End Date: <span id="contractEndDate" class="font-semibold">‚Äî</span></div>
              <label class="flex items-center gap-2 mt-2">
                <input type="checkbox" id="contractAutoRenew" />
                <span class="text-sm">Auto-renew contract</span>
              </label>
            </div>

            <div class="bg-blue-50 p-3 rounded-lg border border-blue-200">
              <p class="text-sm text-blue-900 font-medium mb-2">üí° Best Practice for SaaS Model:</p>
              <ul class="text-xs text-blue-800 space-y-1 ml-4 list-disc">
                <li>Offer 3, 6, or 12-month packages with discounts</li>
                <li>Automatically reserve spots for contract holders when creating new postcards</li>
                <li>Set renewal reminders 30 days before contract end</li>
              </ul>
            </div>
          </div>
        </div>

        <div id="clientHistorySection" class="hidden">
          <div class="border-t pt-4">
            <h4 class="font-semibold text-gray-700 mb-2">Purchase History</h4>
            <div id="clientHistory" class="space-y-2">
            </div>
          </div>
          
          <div class="grid grid-cols-3 gap-4 mt-4 p-3 bg-gray-50 rounded-lg">
            <div class="text-center">
              <div class="text-xs text-gray-600">Lifetime Spent</div>
              <div id="clientLifetimeSpent" class="text-lg font-bold text-green-600">$0</div>
            </div>
            <div class="text-center">
              <div class="text-xs text-gray-600">Cards Bought</div>
              <div id="clientCardsBought" class="text-lg font-bold text-indigo-600">0</div>
            </div>
            <div class="text-center">
              <div class="text-xs text-gray-600">Avg Price</div>
              <div id="clientAvgPrice" class="text-lg font-bold text-blue-600">$0</div>
            </div>
          </div>
        </div>
      </div>
      
      <input type="hidden" id="clientId" />
      
      <div class="flex justify-between items-center gap-2 mt-6 pt-4 border-t">
        <button id="btnDeleteClient" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 hidden">Delete Client</button>
        <div class="flex gap-2 ml-auto">
          <button id="btnCancelClient" class="px-4 py-2 border rounded-md bg-gray-100 hover:bg-gray-200">Cancel</button>
          <button id="btnSaveClient" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">Save Client</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Email Modal -->
  <div id="emailModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" style="max-width: 600px;">
      <h3 class="text-lg font-bold mb-4">Send Email</h3>
      
      <div class="space-y-4">
        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Template</label>
          <select id="emailTemplate" class="border rounded-md w-full p-2 bg-white" onchange="loadClientEmailTemplate()">
            <option value="">‚Äî Select Template ‚Äî</option>
            <option value="invoice">Invoice Reminder</option>
            <option value="proof">Proof Ready for Review</option>
            <option value="renewal">Renewal Offer</option>
            <option value="thankyou">Thank You</option>
          </select>
        </div>
        
        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">To</label>
          <input id="emailTo" type="email" class="border rounded-md w-full p-2" placeholder="client@example.com" />
        </div>
        
        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Subject</label>
          <input id="emailSubject" type="text" class="border rounded-md w-full p-2" placeholder="Subject line" />
        </div>
        
        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Message</label>
          <textarea id="emailBody" rows="8" class="border rounded-md w-full p-2" placeholder="Email body..."></textarea>
        </div>
      </div>
      
      <div class="flex justify-end gap-2 mt-6">
        <button id="btnCancelEmail" class="px-4 py-2 border rounded-md bg-gray-100 hover:bg-gray-200">Cancel</button>
        <button id="btnSendEmail" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Send Email</button>
      </div>
    </div>
  </div>
  
  <!-- Reports Modal -->
  <div id="reportsModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" style="max-width: 800px;">
      <h3 class="text-lg font-bold mb-4">Financial Reports & Analytics</h3>
      
      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-4">
          <button onclick="generateProfitLossReport()" class="p-4 border-2 border-gray-300 rounded-lg hover:border-indigo-500 hover:bg-indigo-50 transition-all text-left">
            <div class="font-semibold text-gray-900">üìä Profit & Loss Report</div>
            <div class="text-sm text-gray-600 mt-1">Monthly revenue vs expenses breakdown</div>
          </button>
          
          <button onclick="generateClientValueReport()" class="p-4 border-2 border-gray-300 rounded-lg hover:border-indigo-500 hover:bg-indigo-50 transition-all text-left">
            <div class="font-semibold text-gray-900">üí∞ Client Value Analysis</div>
            <div class="text-sm text-gray-600 mt-1">Lifetime value & renewal rates</div>
          </button>
          
          <button onclick="generateCampaignReport()" class="p-4 border-2 border-gray-300 rounded-lg hover:border-indigo-500 hover:bg-indigo-50 transition-all text-left">
            <div class="font-semibold text-gray-900">üìà Campaign Performance</div>
            <div class="text-sm text-gray-600 mt-1">Compare all campaigns side-by-side</div>
          </button>
          
          <button onclick="generateSalesFunnelReport()" class="p-4 border-2 border-gray-300 rounded-lg hover:border-indigo-500 hover:bg-indigo-50 transition-all text-left">
            <div class="font-semibold text-gray-900">üéØ Sales Funnel</div>
            <div class="text-sm text-gray-600 mt-1">Conversion rates by stage</div>
          </button>
        </div>

        <!-- Email Report Section -->
        <div class="border-t pt-4 mt-4">
          <h4 class="font-semibold text-gray-800 mb-3">Email Prospect Report</h4>
          <div class="flex flex-wrap gap-3">
            <button onclick="syncAllProspectsToCloud()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
              </svg>
              Sync Prospects to Cloud
            </button>
            <a href="email-report.html" target="_blank" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
              </svg>
              Open Email Report
            </a>
          </div>
          <p class="text-sm text-gray-500 mt-2">Click "Sync Prospects to Cloud" first to ensure all your prospects are available in the Email Report.</p>
        </div>

        <div id="reportOutput" class="border rounded-lg p-4 bg-gray-50 min-h-[200px] hidden">
          <div class="flex justify-between items-center mb-2">
            <h4 class="font-semibold">Report Output</h4>
            <button onclick="downloadReport()" class="text-sm px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700">Download CSV</button>
          </div>
          <div id="reportContent" class="text-sm"></div>
        </div>
      </div>
      
      <div class="flex justify-end gap-2 mt-6">
        <button id="btnCloseReports" class="px-4 py-2 border rounded-md bg-gray-100 hover:bg-gray-200">Close</button>
      </div>
    </div>
  </div>
  
  <!-- Task Management Modal -->
  <div id="taskModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" style="max-width: 500px;">
      <h3 id="taskModalTitle" class="text-lg font-bold mb-4">Add New Task</h3>

      <div class="space-y-4">
        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Task Description *</label>
          <input id="taskText" type="text" class="border rounded-md w-full p-2" placeholder="Follow up with client..." required />
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Due Date *</label>
          <input id="taskDueDate" type="date" class="border rounded-md w-full p-2" required />
        </div>
      </div>

      <input type="hidden" id="taskId" />

      <div class="flex justify-end gap-2 mt-6">
        <button id="btnCancelTask" class="px-4 py-2 border rounded-md bg-gray-100 hover:bg-gray-200">Cancel</button>
        <button id="btnSaveTask" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">Save Task</button>
      </div>
    </div>
  </div>

  <!-- Lead Management Modal -->
  <div id="leadModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" style="max-width: 550px;">
      <h3 id="leadModalTitle" class="text-lg font-bold mb-4">Add New Lead</h3>

      <div class="space-y-4">
        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Business Name *</label>
          <input id="leadBusinessName" type="text" class="border rounded-md w-full p-2" placeholder="Joe's Plumbing" required />
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="text-sm font-medium text-gray-700 block mb-1">Contact Name</label>
            <input id="leadContactName" type="text" class="border rounded-md w-full p-2" placeholder="Joe Smith" />
          </div>

          <div>
            <label class="text-sm font-medium text-gray-700 block mb-1">Phone</label>
            <input id="leadPhone" type="tel" class="border rounded-md w-full p-2" placeholder="(555) 123-4567" />
          </div>
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Email</label>
          <input id="leadEmail" type="email" class="border rounded-md w-full p-2" placeholder="joe@joesplumbing.com" />
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Website</label>
          <input id="leadWebsite" type="url" class="border rounded-md w-full p-2" placeholder="https://joesplumbing.com" />
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="text-sm font-medium text-gray-700 block mb-1">Facebook</label>
            <input id="leadFacebook" type="url" class="border rounded-md w-full p-2" placeholder="https://facebook.com/..." />
          </div>

          <div>
            <label class="text-sm font-medium text-gray-700 block mb-1">Instagram</label>
            <input id="leadInstagram" type="url" class="border rounded-md w-full p-2" placeholder="https://instagram.com/..." />
          </div>
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Estimated Value</label>
          <div class="relative">
            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">$</span>
            <input id="leadValue" type="number" step="50" class="border rounded-md w-full p-2" style="padding-left:2rem" placeholder="500" />
          </div>
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Notes</label>
          <textarea id="leadNotes" rows="2" class="border rounded-md w-full p-2" placeholder="Details about this business..."></textarea>
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">üìÖ Follow-Up Date</label>
          <input id="leadFollowUpDate" type="date" class="border rounded-md w-full p-2" />
          <p class="text-xs text-gray-500 mt-1">Set a reminder to contact this prospect later</p>
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700 block mb-2">Activity Log</label>
          <div id="leadActivityLog" class="border rounded-md p-3 bg-gray-50 max-h-32 overflow-y-auto text-xs space-y-1">
            <div class="text-gray-400 italic">No activity yet</div>
          </div>
          <div class="mt-2 flex gap-2">
            <input id="leadNewActivity" type="text" class="border rounded-md flex-1 p-2 text-sm" placeholder="Add a note (e.g., 'Called, left voicemail')" />
            <button onclick="addActivityNote()" class="px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm">Add</button>
          </div>
        </div>
      </div>

      <input type="hidden" id="leadColumn" />
      <input type="hidden" id="leadId" />

      <div class="flex justify-end gap-2 mt-6">
        <button id="btnCancelLead" class="px-4 py-2 border rounded-md bg-gray-100 hover:bg-gray-200">Cancel</button>
        <button id="btnSaveLead" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">Save Lead</button>
      </div>
    </div>
  </div>

  <!-- Contact Later Modal -->
  <div id="contactLaterModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" style="max-width: 400px;">
      <h3 class="text-lg font-bold mb-4">üìÖ Contact Later</h3>

      <p class="text-sm text-gray-600 mb-4">Set a follow-up date and move this prospect to your pool.</p>

      <div class="space-y-4">
        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Business Name</label>
          <div id="contactLaterBusinessName" class="text-sm font-semibold text-gray-900"></div>
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Follow-Up Date *</label>
          <input id="contactLaterDate" type="date" class="border rounded-md w-full p-2" required />
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Quick Note (Optional)</label>
          <input id="contactLaterNote" type="text" class="border rounded-md w-full p-2" placeholder="e.g., 'Call back in 2 weeks'" />
        </div>
      </div>

      <input type="hidden" id="contactLaterLeadId" />

      <div class="flex justify-end gap-2 mt-6">
        <button id="btnCancelContactLater" class="px-4 py-2 border rounded-md bg-gray-100 hover:bg-gray-200">Cancel</button>
        <button id="btnSaveContactLater" class="px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700">üìÖ Move to Pool</button>
      </div>
    </div>
  </div>

  <!-- Send SMS Modal -->
  <div id="sendSMSModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" style="max-width: 500px;">
      <h3 class="text-lg font-bold mb-4">üì± Send SMS via Google Voice</h3>

      <div class="space-y-4">
        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Business Name</label>
          <div id="smsBusinessName" class="text-sm font-semibold text-gray-900"></div>
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Phone Number</label>
          <div id="smsPhoneNumber" class="text-sm font-medium text-blue-600"></div>
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Template</label>
          <select id="smsTemplate" class="border rounded-md w-full p-2 bg-white" onchange="loadSMSTemplate()">
            <option value="">-- Select a template --</option>
            <option value="intro">Introduction</option>
            <option value="follow-up">Follow-up</option>
            <option value="custom">Custom Message</option>
          </select>
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Message *</label>
          <textarea id="smsMessage" rows="5" class="border rounded-md w-full p-2" placeholder="Type your message here..." required oninput="updateSMSCharCount()"></textarea>
          <div class="text-xs text-gray-500 mt-1"><span id="smsCharCount">0</span>/160 characters</div>
        </div>
      </div>

      <input type="hidden" id="smsLeadId" />

      <div class="flex justify-end gap-2 mt-6">
        <button onclick="closeSendSMSModal()" class="px-4 py-2 border rounded-md bg-gray-100 hover:bg-gray-200">Cancel</button>
        <button onclick="sendSMSMessage()" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">üì± Send via Google Voice</button>
      </div>
    </div>
  </div>

  <!-- Send Email Modal -->
  <div id="sendEmailModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" style="max-width: 600px;">
      <h3 class="text-lg font-bold mb-4">‚úâÔ∏è Send Email</h3>

      <div class="space-y-4">
        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Business Name</label>
          <div id="emailBusinessName" class="text-sm font-semibold text-gray-900"></div>
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Email Address</label>
          <div id="emailAddress" class="text-sm font-medium text-blue-600"></div>
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Template</label>
          <select id="emailTemplatePipeline" class="border rounded-md w-full p-2 bg-white" onchange="loadProspectEmailTemplate('pipeline')">
            <option value="">-- Select a template --</option>
            <option value="intro">Introduction & Value Proposition</option>
            <option value="follow-up">Follow-up</option>
            <option value="special-offer">Special Offer</option>
            <option value="custom">Custom Email</option>
          </select>
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Subject *</label>
          <input id="emailSubject" type="text" class="border rounded-md w-full p-2" placeholder="Email subject..." required />
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Message *</label>
          <textarea id="emailMessage" rows="8" class="border rounded-md w-full p-2" placeholder="Type your email message here..." required></textarea>
        </div>
      </div>

      <input type="hidden" id="emailLeadId" />

      <div class="flex justify-end gap-2 mt-6">
        <button onclick="closeSendEmailModal()" class="px-4 py-2 border rounded-md bg-gray-100 hover:bg-gray-200">Cancel</button>
        <button onclick="sendEmailMessage()" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">‚úâÔ∏è Send Email</button>
      </div>
    </div>
  </div>

  <!-- Add Manual Business Modal -->
  <div id="addManualBusinessModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" style="max-width: 600px;">
      <h3 class="text-lg font-bold mb-4">‚ûï Add Business Manually</h3>

      <!-- Quick Lookup -->
      <div class="bg-green-50 border-2 border-green-200 rounded-lg p-4 mb-4">
        <label class="text-sm font-semibold text-green-900 block mb-2">‚úÖ Quick Lookup (FREE)</label>
        <p class="text-xs text-green-700 mb-2">Auto-fill business details with one click - completely free!</p>
        <p class="text-xs text-gray-600">Or enter business details manually below.</p>
      </div>

      <form id="addManualBusinessForm" class="space-y-4">
        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Business Name *</label>
          <input id="manualBusinessName" type="text" class="border rounded-md w-full p-2" placeholder="e.g., Joe's Pizza" required />
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Category *</label>
          <select id="manualBusinessCategory" class="border rounded-md w-full p-2 bg-white" required>
            <option value="">Select category...</option>
            <!-- Categories populated dynamically from businessCategories -->
          </select>
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Address</label>
          <input id="manualBusinessAddress" type="text" class="border rounded-md w-full p-2" placeholder="123 Main St" />
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="text-sm font-medium text-gray-700 block mb-1">City/Town *</label>
            <input id="manualBusinessTown" type="text" class="border rounded-md w-full p-2" placeholder="Grand Island" required />
          </div>
          <div>
            <label class="text-sm font-medium text-gray-700 block mb-1">ZIP Code</label>
            <input id="manualBusinessZip" type="text" class="border rounded-md w-full p-2" placeholder="14072" />
          </div>
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Phone</label>
          <input id="manualBusinessPhone" type="tel" class="border rounded-md w-full p-2" placeholder="(716) 555-1234" />
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Email</label>
          <input id="manualBusinessEmail" type="email" class="border rounded-md w-full p-2" placeholder="contact@business.com" />
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Website</label>
          <input id="manualBusinessWebsite" type="url" class="border rounded-md w-full p-2" placeholder="https://www.business.com" />
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Notes (Optional)</label>
          <textarea id="manualBusinessNotes" rows="3" class="border rounded-md w-full p-2" placeholder="Any additional information..."></textarea>
        </div>

        <div class="flex justify-end gap-2 mt-6 pt-4 border-t">
          <button type="button" onclick="closeAddManualBusinessModal()" class="px-4 py-2 border rounded-md bg-gray-100 hover:bg-gray-200">Cancel</button>
          <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">‚ûï Add to Prospect Pool</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Create/Edit Template Modal -->
  <div id="templateModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" style="max-width: 700px; max-height: 90vh; overflow-y: auto;">
      <h3 id="templateModalTitle" class="text-lg font-bold mb-4">Create Template</h3>

      <form id="templateForm" class="space-y-4">
        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Template Name *</label>
          <input id="templateName" type="text" class="border rounded-md w-full p-2" placeholder="e.g., Holiday Greeting" required />
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="text-sm font-medium text-gray-700 block mb-1">Category *</label>
            <select id="templateCategory" class="border rounded-md w-full p-2 bg-white" required>
              <option value="">-- Select Category --</option>
              <option value="prospect">Prospect (New Leads)</option>
              <option value="client">Client (Existing Customers)</option>
              <option value="followup">Follow-up</option>
            </select>
          </div>
          <div>
            <label class="text-sm font-medium text-gray-700 block mb-1">Type *</label>
            <select id="templateType" class="border rounded-md w-full p-2 bg-white" required>
              <option value="">-- Select Type --</option>
              <option value="email">üìß Email</option>
              <option value="sms">üì± SMS</option>
              <option value="messenger">üìò Facebook Messenger</option>
              <option value="instagram">üì∑ Instagram DM</option>
            </select>
          </div>
        </div>

        <div id="templateSubjectField">
          <label class="text-sm font-medium text-gray-700 block mb-1">Subject (Email Only)</label>
          <input id="templateSubject" type="text" class="border rounded-md w-full p-2" placeholder="e.g., Invoice Reminder - {businessName}" />
          <p class="text-xs text-gray-500 mt-1">Leave blank for SMS/Messenger/Instagram</p>
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Message Body *</label>
          <textarea id="templateBody" rows="8" class="border rounded-md w-full p-2 font-mono text-sm" placeholder="Hi {contactName},&#10;&#10;Just wanted to reach out..." required></textarea>
          <div class="flex items-center justify-between mt-1">
            <p class="text-xs text-gray-500">üí° Use {variableName} for placeholders</p>
            <button type="button" onclick="showVariableMenu(event)" class="text-xs px-3 py-1 bg-indigo-100 text-indigo-700 rounded hover:bg-indigo-200 font-medium">
              ‚ûï Insert Variable
            </button>
          </div>
        </div>

        <!-- Variable Helper -->
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
          <div class="text-xs font-semibold text-blue-900 mb-2">üìù Available Variables (click to insert):</div>
          <div class="grid grid-cols-2 gap-2 text-xs">
            <button type="button" onclick="insertVariable('businessName')" class="text-left bg-blue-100 text-blue-800 px-2 py-1 rounded hover:bg-blue-200 transition">{businessName} - Business name</button>
            <button type="button" onclick="insertVariable('contactName')" class="text-left bg-blue-100 text-blue-800 px-2 py-1 rounded hover:bg-blue-200 transition">{contactName} - Contact person</button>
            <button type="button" onclick="insertVariable('firstName')" class="text-left bg-blue-100 text-blue-800 px-2 py-1 rounded hover:bg-blue-200 transition">{firstName} - First name</button>
            <button type="button" onclick="insertVariable('phone')" class="text-left bg-blue-100 text-blue-800 px-2 py-1 rounded hover:bg-blue-200 transition">{phone} - Phone number</button>
            <button type="button" onclick="insertVariable('email')" class="text-left bg-blue-100 text-blue-800 px-2 py-1 rounded hover:bg-blue-200 transition">{email} - Email address</button>
            <button type="button" onclick="insertVariable('town')" class="text-left bg-blue-100 text-blue-800 px-2 py-1 rounded hover:bg-blue-200 transition">{town} - City/Town</button>
            <button type="button" onclick="insertVariable('zipCode')" class="text-left bg-blue-100 text-blue-800 px-2 py-1 rounded hover:bg-blue-200 transition">{zipCode} - ZIP code</button>
            <button type="button" onclick="insertVariable('monthlyPrice')" class="text-left bg-blue-100 text-blue-800 px-2 py-1 rounded hover:bg-blue-200 transition">{monthlyPrice} - Monthly price</button>
            <button type="button" onclick="insertVariable('campaign')" class="text-left bg-blue-100 text-blue-800 px-2 py-1 rounded hover:bg-blue-200 transition">{campaign} - Campaign name</button>
            <button type="button" onclick="insertVariable('amount')" class="text-left bg-blue-100 text-blue-800 px-2 py-1 rounded hover:bg-blue-200 transition">{amount} - Dollar amount</button>
          </div>
        </div>

        <!-- Preview -->
        <div id="templatePreviewSection" class="hidden">
          <div class="border-t pt-4">
            <div class="text-sm font-semibold text-gray-700 mb-2">Preview (with sample data):</div>
            <div class="bg-gray-50 border rounded-lg p-3">
              <div id="templatePreviewSubject" class="text-sm font-semibold mb-2"></div>
              <pre id="templatePreviewBody" class="text-sm text-gray-700 whitespace-pre-wrap font-sans"></pre>
            </div>
            <button type="button" onclick="updateTemplatePreview()" class="mt-2 text-xs text-blue-600 hover:text-blue-700">
              üîÑ Refresh Preview
            </button>
          </div>
        </div>

        <div class="flex justify-end gap-2 mt-6 pt-4 border-t">
          <button type="button" onclick="closeTemplateModal()" class="px-4 py-2 border rounded-md bg-gray-100 hover:bg-gray-200">Cancel</button>
          <button type="button" onclick="updateTemplatePreview()" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Preview</button>
          <button type="submit" id="saveTemplateBtn" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">Save Template</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Add Transaction Modal -->
  <div id="addTransactionModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" style="max-width: 600px;">
      <h3 class="text-lg font-bold mb-4">üíµ Add Transaction</h3>

      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="text-sm font-medium text-gray-700 block mb-1">Date *</label>
            <input id="txnDate" type="date" class="border rounded-md w-full p-2" required />
          </div>

          <div>
            <label class="text-sm font-medium text-gray-700 block mb-1">Type *</label>
            <select id="txnType" class="border rounded-md w-full p-2 bg-white" required>
              <option value="">Select type...</option>
              <option value="revenue">Revenue (Income)</option>
              <option value="cogs">Cost of Goods Sold</option>
              <option value="operating">Operating Expense</option>
              <option value="owner_draw">Owner Draw</option>
            </select>
          </div>
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Description *</label>
          <input id="txnDescription" type="text" class="border rounded-md w-full p-2" placeholder="e.g., Client payment, Office supplies, etc." required />
          <p class="text-xs text-gray-500 mt-1">A clear description helps your accountant categorize expenses</p>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="text-sm font-medium text-gray-700 block mb-1">Amount *</label>
            <div class="relative">
              <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">$</span>
              <input id="txnAmount" type="number" step="0.01" class="border rounded-md w-full p-2" style="padding-left:2rem" placeholder="0.00" required />
            </div>
            <p class="text-xs text-gray-500 mt-1">Enter positive amount (we'll auto-adjust for expenses)</p>
          </div>

          <div>
            <label class="text-sm font-medium text-gray-700 block mb-1">Category</label>
            <input id="txnCategory" type="text" class="border rounded-md w-full p-2" placeholder="Auto-assigned" readonly />
          </div>
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Notes (Optional)</label>
          <textarea id="txnNotes" rows="2" class="border rounded-md w-full p-2" placeholder="Additional details for your accountant..."></textarea>
        </div>

        <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
          <p class="text-sm text-blue-900"><strong>üí° Tip:</strong> Add detailed descriptions to make tax preparation easier. Your accountant will thank you!</p>
        </div>
      </div>

      <div class="flex justify-end gap-2 mt-6 pt-4 border-t">
        <button id="btnCancelAddTransaction" class="px-4 py-2 border rounded-md bg-gray-100 hover:bg-gray-200">Cancel</button>
        <button id="btnSaveAddTransaction" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">Save Transaction</button>
      </div>
    </div>
  </div>

  <!-- Edit Transaction Modal -->
  <div id="editTransactionModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" style="max-width: 600px;">
      <h3 class="text-lg font-bold mb-4">‚úèÔ∏è Edit Transaction</h3>

      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="text-sm font-medium text-gray-700 block mb-1">Date *</label>
            <input id="editTxnDate" type="date" class="border rounded-md w-full p-2" required />
          </div>

          <div>
            <label class="text-sm font-medium text-gray-700 block mb-1">Type *</label>
            <select id="editTxnType" class="border rounded-md w-full p-2 bg-white" required>
              <option value="revenue">Revenue (Income)</option>
              <option value="cogs">Cost of Goods Sold</option>
              <option value="operating">Operating Expense</option>
              <option value="owner_draw">Owner Draw</option>
            </select>
          </div>
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Description *</label>
          <input id="editTxnDescription" type="text" class="border rounded-md w-full p-2" placeholder="e.g., Client payment, Office supplies, etc." required />
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="text-sm font-medium text-gray-700 block mb-1">Amount *</label>
            <div class="relative">
              <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">$</span>
              <input id="editTxnAmount" type="number" step="0.01" class="border rounded-md w-full p-2" style="padding-left:2rem" required />
            </div>
          </div>

          <div>
            <label class="text-sm font-medium text-gray-700 block mb-1">Category</label>
            <input id="editTxnCategory" type="text" class="border rounded-md w-full p-2" readonly />
          </div>
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Notes (Optional)</label>
          <textarea id="editTxnNotes" rows="2" class="border rounded-md w-full p-2" placeholder="Additional details..."></textarea>
        </div>
      </div>

      <input type="hidden" id="editTxnId" />

      <div class="flex justify-end gap-2 mt-6 pt-4 border-t">
        <button id="btnCancelEditTransaction" class="px-4 py-2 border rounded-md bg-gray-100 hover:bg-gray-200">Cancel</button>
        <button id="btnSaveEditTransaction" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- P&L Report Modal -->
  <div id="plReportModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
      <div class="flex justify-between items-start mb-4">
        <div>
          <h3 class="text-xl font-bold">üìä Profit & Loss Statement</h3>
          <p class="text-sm text-gray-600 mt-1">Professional financial report for your accountant</p>
        </div>
        <button onclick="closePLReportModal()" class="text-gray-400 hover:text-gray-600 text-2xl leading-none">&times;</button>
      </div>

      <div class="mb-4">
        <label class="text-sm font-medium text-gray-700 block mb-1">Report Period</label>
        <select id="plReportPeriod" class="border rounded-md p-2 bg-white" onchange="generatePLReport()">
          <option value="current-year">Current Year (2025)</option>
          <option value="q1">Q1 2025 (Jan-Mar)</option>
          <option value="q2">Q2 2025 (Apr-Jun)</option>
          <option value="q3">Q3 2025 (Jul-Sep)</option>
          <option value="q4">Q4 2025 (Oct-Dec)</option>
          <option value="current-month">Current Month</option>
          <option value="last-month">Last Month</option>
          <option value="all">All Time</option>
        </select>
      </div>

      <div id="plReportContent" class="bg-white border rounded-lg">
        <!-- Report content will be generated here -->
      </div>

      <div class="flex justify-end gap-2 mt-4">
        <button onclick="exportPLReportPDF()" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">üìÑ Export PDF</button>
        <button onclick="closePLReportModal()" class="px-4 py-2 border rounded-md bg-gray-100 hover:bg-gray-200">Close</button>
      </div>
    </div>
  </div>

  <!-- Auto-Populate Prospects Modal -->
  <div id="autoPopulateModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" style="max-width: 600px;">
      <h3 class="text-lg font-bold mb-4">üîç Auto-Populate Prospects</h3>

      <div class="bg-green-50 border-2 border-green-200 rounded-lg p-4 mb-4">
        <p class="text-sm font-bold text-green-900 mb-2">‚úÖ ProspectRadar‚Ñ¢ - Unlimited Searches!</p>
        <p class="text-sm text-green-800 mb-2">
          Find local businesses automatically with contact info, ratings, and reviews - all at no extra cost!
        </p>
        <p class="text-sm text-gray-700">
          <strong>Includes:</strong> Phone numbers, addresses, ratings, reviews, and auto-enriched emails & social media.
        </p>
      </div>

      <!-- API Usage Stats -->
      <div id="apiUsageDisplay" class="mb-4 p-3 rounded-lg border">
        <!-- Populated by JavaScript -->
      </div>

      <div class="space-y-4">
        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Zip Code *</label>
          <input id="autoPopZipCode" type="text" class="border rounded-md w-full p-2" placeholder="02101" maxlength="10" required />
          <p class="text-xs text-gray-500 mt-1">5-digit US zip code</p>
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Business Category *</label>
          <select id="autoPopCategory" class="border rounded-md w-full p-2 bg-white" required>
            <option value="">Select category...</option>
            <option value="restaurant">Restaurant</option>
            <option value="cafe">Cafe / Coffee Shop</option>
            <option value="bar">Bar / Pub</option>
            <option value="retail">Retail Store</option>
            <option value="grocery_or_supermarket">Grocery Store</option>
            <option value="pharmacy">Pharmacy</option>
            <option value="gym">Gym / Fitness</option>
            <option value="hair_care">Hair Salon / Barber</option>
            <option value="beauty_salon">Beauty Salon / Spa</option>
            <option value="dentist">Dentist</option>
            <option value="doctor">Doctor / Medical</option>
            <option value="lawyer">Law Firm</option>
            <option value="real_estate_agency">Real Estate Agency</option>
            <option value="car_dealer">Car Dealer</option>
            <option value="car_repair">Auto Repair</option>
            <option value="plumber">Plumber</option>
            <option value="electrician">Electrician</option>
            <option value="roofing_contractor">Roofing Contractor</option>
            <option value="general_contractor">General Contractor</option>
            <option value="painter">Painter</option>
            <option value="locksmith">Locksmith</option>
            <option value="florist">Florist</option>
            <option value="pet_store">Pet Store</option>
            <option value="veterinary_care">Veterinarian</option>
            <option value="accounting">Accountant</option>
            <option value="insurance_agency">Insurance Agency</option>
            <option value="bank">Bank</option>
            <option value="hotel">Hotel / Lodging</option>
            <option value="moving_company">Moving Company</option>
            <option value="storage">Storage Facility</option>
            <option value="laundry">Laundromat</option>
            <option value="dry_cleaning">Dry Cleaning</option>
          </select>
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700 block mb-1">Search Radius</label>
          <select id="autoPopRadius" class="border rounded-md w-full p-2 bg-white">
            <option value="3000" selected>~2 miles (recommended for single ZIP)</option>
            <option value="5000">~3 miles</option>
            <option value="8000">~5 miles (may include neighboring areas)</option>
            <option value="16000">~10 miles</option>
          </select>
        </div>

        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
          <p class="text-xs text-yellow-900">
            ‚ö° <strong>Note:</strong> Results are cached for 30 days to minimize API costs. Re-running the same search is free!
          </p>
        </div>
      </div>

      <div class="flex justify-end gap-2 mt-6">
        <button id="btnCancelAutoPopulate" class="px-4 py-2 border rounded-md bg-gray-100 hover:bg-gray-200">Cancel</button>
        <button id="btnRunAutoPopulate" class="px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700">
          üîç Search & Add Prospects
        </button>
      </div>
    </div>
  </div>

  <!-- Prospects Results Preview Modal -->
  <div id="prospectsResultsModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
      <div class="flex justify-between items-start mb-4">
        <div>
          <h3 class="text-xl font-bold">Search Results</h3>
          <p class="text-sm text-gray-600 mt-1">Select businesses to add to Close Deals</p>
        </div>
        <button onclick="closeProspectsResultsModal()" class="text-gray-400 hover:text-gray-600 text-2xl leading-none">&times;</button>
      </div>

      <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4">
        <div class="flex items-start gap-2">
          <span class="text-blue-600 text-lg">üí°</span>
          <div class="text-sm text-blue-900">
            <strong>Select which businesses to add.</strong> Unchecked businesses won't be added. Click "Not Interested" to permanently hide a business from future searches.
          </div>
        </div>
      </div>

      <div id="prospectsResultsStats" class="grid grid-cols-3 gap-4 mb-4">
        <!-- Stats populated by JavaScript -->
      </div>

      <div id="prospectsResultsContainer" class="space-y-2 max-h-96 overflow-y-auto pr-2" style="scrollbar-width: thin;">
        <!-- Results populated by JavaScript -->
      </div>

      <div class="flex justify-end gap-3 mt-6 pt-4 border-t">
        <button onclick="closeProspectsResultsModal()" class="px-6 py-2 border rounded-md bg-gray-100 hover:bg-gray-200 font-medium">
          Cancel
        </button>
        <button id="btnAddSelectedProspects" onclick="addSelectedProspects()" class="px-6 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 font-semibold">
          Add & Start Outreach
        </button>
      </div>
    </div>
  </div>

  <!-- New Postcard Creation Modal -->
  <div id="newPostcardModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" style="max-width: 700px; max-height: 90vh; overflow-y: auto;">
      <h3 class="text-lg font-bold mb-4">Create New Postcard Mailing</h3>

      <div class="space-y-6">
        <!-- Step 1: Town Selection -->
        <div class="p-4 bg-blue-50 rounded-lg border border-blue-200">
          <h4 class="font-semibold text-blue-900 mb-3">Step 1: Select Town/Territory</h4>
          <div class="space-y-2">
            <label class="flex items-center gap-2">
              <input type="radio" name="townOption" value="existing" checked onchange="toggleTownInput()" />
              <span class="text-sm font-medium">Use existing town</span>
            </label>
            <select id="newPostcardTownSelect" class="border rounded-md p-2 w-full bg-white ml-6">
              <option value="">‚Äî Select existing town ‚Äî</option>
            </select>

            <label class="flex items-center gap-2 mt-3">
              <input type="radio" name="townOption" value="new" onchange="toggleTownInput()" />
              <span class="text-sm font-medium">Add new town</span>
            </label>
            <input id="newPostcardTownInput" type="text" class="border rounded-md p-2 w-full ml-6" placeholder="Enter new town name (e.g., Buffalo, West Seneca)" disabled />
          </div>
        </div>

        <!-- Step 2: Mail Date -->
        <div class="p-4 bg-green-50 rounded-lg border border-green-200">
          <h4 class="font-semibold text-green-900 mb-3">Step 2: Select Mail Date</h4>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="text-sm font-medium block mb-1">Month</label>
              <select id="newPostcardMonth" class="border rounded-md p-2 w-full bg-white">
                <option value="01">January</option>
                <option value="02">February</option>
                <option value="03">March</option>
                <option value="04">April</option>
                <option value="05">May</option>
                <option value="06">June</option>
                <option value="07">July</option>
                <option value="08">August</option>
                <option value="09">September</option>
                <option value="10">October</option>
                <option value="11">November</option>
                <option value="12">December</option>
              </select>
            </div>
            <div>
              <label class="text-sm font-medium block mb-1">Year</label>
              <select id="newPostcardYear" class="border rounded-md p-2 w-full bg-white">
              </select>
            </div>
          </div>
          <div class="mt-3">
            <label class="text-sm font-medium block mb-1">In-Homes Date</label>
            <input id="newPostcardInHomesDate" type="date" class="border rounded-md p-2 w-full" />
          </div>
        </div>

        <!-- Step 2.5: Postcard Size -->
        <div class="p-4 bg-orange-50 rounded-lg border border-orange-200">
          <h4 class="font-semibold text-orange-900 mb-3">Postcard Size</h4>
          <div class="space-y-2">
            <label class="text-sm font-medium block mb-1">Format</label>
            <select id="newPostcardSize" class="border rounded-md p-2 w-full bg-white">
              <option value="9x12">9√ó12 (12" wide √ó 9" tall)</option>
              <option value="6.5x12">6.5√ó12 (12" wide √ó 6.5" tall)</option>
            </select>
            <p class="text-xs text-gray-500 mt-1">Set address count later in Campaign Manager ‚Üí Set Ad Price</p>
          </div>
        </div>

        <!-- Step 3: Copy from Previous -->
        <div class="p-4 bg-purple-50 rounded-lg border border-purple-200">
          <h4 class="font-semibold text-purple-900 mb-3">Step 3: Copy from Previous Postcard (Optional)</h4>
          <label class="flex items-center gap-2 mb-3">
            <input type="checkbox" id="copyFromPrevious" onchange="toggleCopyOptions()" />
            <span class="text-sm font-medium">Copy advertisers from a previous postcard</span>
          </label>
          <label class="flex items-center gap-2 mb-3">
            <input type="checkbox" id="copyExpensesFromPrevious" />
            <span class="text-sm font-medium">Copy expenses (printing, postage, design, misc) from selected postcard</span>
          </label>

          <div id="copyOptions" class="hidden space-y-3">
            <div>
              <label class="text-sm font-medium block mb-1">Select postcard to copy from:</label>
              <select id="copySourcePostcard" class="border rounded-md p-2 w-full bg-white" onchange="loadAdvertisersForCopy()">
                <option value="">‚Äî Select postcard ‚Äî</option>
              </select>
            </div>

            <div id="advertiserChecklistContainer" class="hidden">
              <p class="text-sm font-medium mb-2">Select advertisers to carry forward:</p>
              <div id="advertiserChecklist" class="max-h-60 overflow-y-auto border rounded-md p-3 bg-white space-y-2">
                <!-- Populated dynamically -->
              </div>
              <p class="text-xs text-gray-600 mt-2">üí° Selected advertisers will have their spots auto-reserved in the new postcard with "Reserved" status.</p>
            </div>
          </div>
        </div>
      </div>

      <div class="flex justify-end gap-2 mt-6 pt-4 border-t">
        <button id="btnCancelNewPostcard" class="px-4 py-2 border rounded-md bg-gray-100 hover:bg-gray-200">Cancel</button>
        <button id="btnCreatePostcard" class="px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 font-semibold">
          Create Postcard
        </button>
      </div>
    </div>
  </div>

  <!-- CRM Contact Card Modal (Redesigned) -->
  <div id="prospectDetailModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal relative" style="max-width: 700px; max-height: 90vh; overflow: hidden; display: flex; flex-direction: column;">

      <!-- HEADER SECTION -->
      <div class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white p-5 rounded-t-2xl">
        <!-- Close Button -->
        <button onclick="closeProspectDetailModal()" class="absolute top-3 right-3 bg-white/20 hover:bg-white/40 text-white text-2xl font-bold leading-none w-10 h-10 flex items-center justify-center rounded-full transition shadow-lg">&times;</button>

        <!-- Business Name & Meta -->
        <div class="flex justify-between items-start mb-4 pr-8">
          <div>
            <h2 id="detailBusinessName" class="text-2xl font-bold">Business Name</h2>
            <div class="flex items-center gap-3 mt-1 text-white/80 text-sm">
              <span id="detailCategoryDisplay" class="flex items-center gap-1">
                <span>üìÅ</span> <span id="detailCategoryText">Category</span>
              </span>
              <span>‚Ä¢</span>
              <span id="detailZipDisplay" class="flex items-center gap-1">
                <span>üìç</span> <span id="detailZipCode">ZIP</span>
              </span>
            </div>
          </div>
          <div class="text-right">
            <div id="detailStageBadge" class="px-3 py-1 bg-white/20 rounded-full text-sm font-semibold">Stage</div>
            <div id="detailContactScore" class="text-xs text-white/70 mt-1">Score: 7/10</div>
          </div>
        </div>

        <!-- Quick Action Buttons -->
        <div class="flex gap-2 flex-wrap">
          <button id="btnHeaderCall" onclick="quickAction('call')" class="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg text-sm font-semibold flex items-center gap-2 transition disabled:opacity-50 disabled:cursor-not-allowed" disabled>
            <span>üìû</span> Call
          </button>
          <button id="btnHeaderSMS" onclick="quickAction('sms')" class="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg text-sm font-semibold flex items-center gap-2 transition disabled:opacity-50 disabled:cursor-not-allowed" disabled>
            <span>üí¨</span> Text
          </button>
          <button id="btnHeaderEmail" onclick="quickAction('email')" class="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg text-sm font-semibold flex items-center gap-2 transition disabled:opacity-50 disabled:cursor-not-allowed" disabled>
            <span>‚úâÔ∏è</span> Email
          </button>
          <button id="btnHeaderWebsite" onclick="quickAction('website')" class="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg text-sm font-semibold flex items-center gap-2 transition disabled:opacity-50 disabled:cursor-not-allowed" disabled>
            <span>üåê</span> Website
          </button>
          <button onclick="openEditContactModal()" class="px-4 py-2 bg-white/30 hover:bg-white/40 rounded-lg text-sm font-semibold flex items-center gap-2 transition">
            <span>‚úèÔ∏è</span> Edit
          </button>
        </div>
      </div>

      <!-- TAB BAR -->
      <div class="bg-gray-100 border-b flex">
        <button onclick="switchCrmTab('activity')" data-crm-tab="activity" class="crm-tab flex-1 px-4 py-3 text-sm font-semibold text-center border-b-2 border-indigo-600 text-indigo-600 bg-white">
          Activity
        </button>
        <button onclick="switchCrmTab('contact')" data-crm-tab="contact" class="crm-tab flex-1 px-4 py-3 text-sm font-semibold text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-50">
          Contact Info
        </button>
        <button onclick="switchCrmTab('deal')" data-crm-tab="deal" class="crm-tab flex-1 px-4 py-3 text-sm font-semibold text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-50">
          Deal Info
        </button>
        <button onclick="switchCrmTab('notes')" data-crm-tab="notes" class="crm-tab flex-1 px-4 py-3 text-sm font-semibold text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-50">
          Notes
        </button>
      </div>

      <!-- TAB CONTENT AREA -->
      <div class="flex-1 overflow-y-auto p-4 bg-gray-50">

        <!-- ACTIVITY TAB -->
        <div id="crmTabActivity" class="crm-tab-content">
          <!-- Activity Timeline -->
          <div id="crmActivityTimeline" class="space-y-3">
            <div class="text-center py-8 text-gray-400">
              <div class="text-4xl mb-2">üìã</div>
              <p class="font-medium">No activity yet</p>
              <p class="text-sm">Click "+ Add Activity" to log your first interaction</p>
            </div>
          </div>
        </div>

        <!-- CONTACT INFO TAB -->
        <div id="crmTabContact" class="crm-tab-content hidden">
          <div class="space-y-3">
            <!-- Phone -->
            <div class="bg-white rounded-xl p-4 border border-gray-200">
              <div class="flex justify-between items-center">
                <div>
                  <div class="text-xs text-gray-500 font-medium uppercase tracking-wide">Phone</div>
                  <div id="detailPhone" class="text-lg font-semibold text-gray-900 mt-1">‚Äî</div>
                </div>
                <div class="flex gap-2">
                  <button onclick="copyToClipboard(document.getElementById('detailPhone').textContent)" class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg" title="Copy">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                  </button>
                  <button id="btnContactCall" onclick="quickAction('call')" class="px-3 py-1.5 bg-green-600 text-white rounded-lg text-sm font-medium hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed" disabled>Call</button>
                  <button id="btnContactSMS" onclick="quickAction('sms')" class="px-3 py-1.5 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed" disabled>Text</button>
                </div>
              </div>
            </div>
            <!-- Email -->
            <div class="bg-white rounded-xl p-4 border border-gray-200">
              <div class="flex justify-between items-center">
                <div class="flex-1 min-w-0">
                  <div class="text-xs text-gray-500 font-medium uppercase tracking-wide">Email</div>
                  <div id="detailEmail" class="text-lg font-semibold text-gray-900 mt-1 truncate">‚Äî</div>
                </div>
                <div class="flex gap-2 ml-4">
                  <button onclick="copyToClipboard(document.getElementById('detailEmail').textContent)" class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg" title="Copy">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                  </button>
                  <button id="btnContactEmail" onclick="quickAction('email')" class="px-3 py-1.5 bg-indigo-600 text-white rounded-lg text-sm font-medium hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed" disabled>Send Email</button>
                </div>
              </div>
            </div>
            <!-- Website -->
            <div class="bg-white rounded-xl p-4 border border-gray-200">
              <div class="flex justify-between items-center">
                <div class="flex-1 min-w-0">
                  <div class="text-xs text-gray-500 font-medium uppercase tracking-wide">Website</div>
                  <div id="detailWebsite" class="text-lg font-semibold text-gray-900 mt-1 truncate">‚Äî</div>
                </div>
                <button id="btnContactWebsite" onclick="quickAction('website')" class="ml-4 px-3 py-1.5 bg-gray-600 text-white rounded-lg text-sm font-medium hover:bg-gray-700 disabled:bg-gray-300 disabled:cursor-not-allowed" disabled>Open Site</button>
              </div>
            </div>
            <!-- Address -->
            <div class="bg-white rounded-xl p-4 border border-gray-200">
              <div class="flex justify-between items-center">
                <div>
                  <div class="text-xs text-gray-500 font-medium uppercase tracking-wide">Address</div>
                  <div id="detailAddress" class="text-base text-gray-900 mt-1">‚Äî</div>
                </div>
                <button id="btnContactDirections" onclick="openDirections()" class="px-3 py-1.5 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-200">Directions</button>
              </div>
            </div>
            <!-- Social Media -->
            <div class="bg-white rounded-xl p-4 border border-gray-200">
              <div class="text-xs text-gray-500 font-medium uppercase tracking-wide mb-3">Social Media</div>
              <div class="flex flex-wrap gap-2" id="detailSocialLinks">
                <span class="text-sm text-gray-400">No social links</span>
              </div>
            </div>
          </div>
        </div>

        <!-- DEAL INFO TAB -->
        <div id="crmTabDeal" class="crm-tab-content hidden">
          <div class="space-y-4">
            <!-- Interested Campaign -->
            <div class="bg-white rounded-xl p-4 border border-gray-200">
              <label class="text-xs text-gray-500 font-medium uppercase tracking-wide block mb-2">Interested In Campaign</label>
              <select id="dealCampaign" class="w-full border border-gray-300 rounded-lg p-2.5 text-sm" onchange="updateDealInfo()">
                <option value="">‚Äî Select Campaign ‚Äî</option>
              </select>
            </div>
            <!-- Interested Spot -->
            <div class="bg-white rounded-xl p-4 border border-gray-200">
              <label class="text-xs text-gray-500 font-medium uppercase tracking-wide block mb-2">Interested Spot</label>
              <select id="dealSpot" class="w-full border border-gray-300 rounded-lg p-2.5 text-sm" onchange="updateDealInfo()">
                <option value="">‚Äî Select Spot ‚Äî</option>
              </select>
            </div>
            <!-- Pricing -->
            <div class="bg-white rounded-xl p-4 border border-gray-200">
              <label class="text-xs text-gray-500 font-medium uppercase tracking-wide block mb-2">Quoted Price</label>
              <div class="flex items-center gap-3">
                <span class="text-gray-500">$</span>
                <input id="dealQuotedPrice" type="number" class="flex-1 border border-gray-300 rounded-lg p-2.5 text-sm" placeholder="150" onchange="updateDealInfo()">
                <span id="dealStandardPrice" class="text-sm text-gray-500">(Standard: $175)</span>
              </div>
            </div>
            <!-- Expected Close Date -->
            <div class="bg-white rounded-xl p-4 border border-gray-200">
              <label class="text-xs text-gray-500 font-medium uppercase tracking-wide block mb-2">Expected Close Date</label>
              <input id="dealExpectedClose" type="date" class="w-full border border-gray-300 rounded-lg p-2.5 text-sm" onchange="updateDealInfo()">
            </div>
            <!-- Decision Maker -->
            <div class="bg-white rounded-xl p-4 border border-gray-200">
              <label class="text-xs text-gray-500 font-medium uppercase tracking-wide block mb-2">Decision Maker</label>
              <div class="grid grid-cols-2 gap-3">
                <input id="dealContactName" type="text" class="border border-gray-300 rounded-lg p-2.5 text-sm" placeholder="Name" onchange="updateDealInfo()">
                <input id="dealContactRole" type="text" class="border border-gray-300 rounded-lg p-2.5 text-sm" placeholder="Role (Owner, Manager)" onchange="updateDealInfo()">
              </div>
            </div>
            <!-- Deal Notes -->
            <div class="bg-white rounded-xl p-4 border border-gray-200">
              <label class="text-xs text-gray-500 font-medium uppercase tracking-wide block mb-2">Deal Notes</label>
              <textarea id="dealNotes" rows="3" class="w-full border border-gray-300 rounded-lg p-2.5 text-sm" placeholder="What are they interested in? Any special requests?" onchange="updateDealInfo()"></textarea>
            </div>
          </div>
        </div>

        <!-- NOTES TAB -->
        <div id="crmTabNotes" class="crm-tab-content hidden">
          <div class="space-y-4">
            <!-- Best Time to Contact -->
            <div class="bg-white rounded-xl p-4 border border-gray-200">
              <label class="text-xs text-gray-500 font-medium uppercase tracking-wide block mb-2">Best Time to Contact</label>
              <select id="notesBestTime" class="w-full border border-gray-300 rounded-lg p-2.5 text-sm" onchange="updateNotesInfo()">
                <option value="">‚Äî Any Time ‚Äî</option>
                <option value="morning">Morning (9am - 12pm)</option>
                <option value="afternoon">Afternoon (12pm - 5pm)</option>
                <option value="evening">Evening (5pm - 8pm)</option>
              </select>
            </div>
            <!-- Key Info / General Notes -->
            <div class="bg-white rounded-xl p-4 border border-gray-200">
              <label class="text-xs text-gray-500 font-medium uppercase tracking-wide block mb-2">Key Information</label>
              <textarea id="notesKeyInfo" rows="5" class="w-full border border-gray-300 rounded-lg p-2.5 text-sm" placeholder="Important notes about this business..." onchange="updateNotesInfo()"></textarea>
            </div>
            <!-- Tags -->
            <div class="bg-white rounded-xl p-4 border border-gray-200">
              <label class="text-xs text-gray-500 font-medium uppercase tracking-wide block mb-2">Tags</label>
              <div id="notesTags" class="flex flex-wrap gap-2 mb-3">
                <!-- Tags will be rendered here -->
              </div>
              <div class="flex gap-2">
                <input id="notesNewTag" type="text" class="flex-1 border border-gray-300 rounded-lg p-2 text-sm" placeholder="Add a tag..." onkeypress="if(event.key==='Enter'){addTag();event.preventDefault();}">
                <button onclick="addTag()" class="px-4 py-2 bg-indigo-600 text-white rounded-lg text-sm font-medium hover:bg-indigo-700">Add</button>
              </div>
            </div>
          </div>
        </div>

      </div>

      <!-- FLOATING ADD ACTIVITY BUTTON -->
      <button onclick="openAddActivityForm()" class="absolute bottom-20 right-6 w-14 h-14 bg-indigo-600 hover:bg-indigo-700 text-white rounded-full shadow-lg flex items-center justify-center text-2xl transition-all hover:scale-110" title="Add Activity">
        +
      </button>

      <!-- FOOTER -->
      <div class="bg-white border-t p-4 flex justify-between items-center rounded-b-2xl">
        <button id="btnCrmNotInterested" onclick="markProspectNotInterested()" class="px-4 py-2 bg-red-100 text-red-700 rounded-lg text-sm font-medium hover:bg-red-200 flex items-center gap-2">
          <span>üö´</span> Not Interested
        </button>
        <div class="flex gap-2">
          <button id="btnCrmConvertToClient" onclick="convertToClient()" class="px-4 py-2 bg-green-600 text-white rounded-lg text-sm font-medium hover:bg-green-700 flex items-center gap-2">
            <span>üë§</span> Convert to Client
          </button>
          <button id="btnCrmEditClient" onclick="openEditContactModal()" class="hidden px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 flex items-center gap-2">
            <span>‚úèÔ∏è</span> Edit Client
          </button>
          <button onclick="closeProspectDetailModal()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-300">
            Close
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Contact Modal -->
  <div id="editContactModal" class="modal-backdrop hidden" role="dialog" aria-modal="true">
    <div class="modal" style="max-width: 500px;">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-bold text-gray-900">Edit Contact Info</h3>
        <button onclick="closeEditContactModal()" class="text-gray-400 hover:text-gray-600 text-xl">&times;</button>
      </div>

      <div class="space-y-4">
        <!-- Business Name -->
        <div>
          <label class="text-xs text-gray-500 font-medium uppercase tracking-wide block mb-1">Business Name</label>
          <input id="editContactName" type="text" class="w-full border border-gray-300 rounded-lg p-2.5 text-sm" placeholder="Business name">
        </div>
        <!-- Phone -->
        <div>
          <label class="text-xs text-gray-500 font-medium uppercase tracking-wide block mb-1">Phone</label>
          <input id="editContactPhone" type="tel" class="w-full border border-gray-300 rounded-lg p-2.5 text-sm" placeholder="(555) 123-4567">
        </div>
        <!-- Email -->
        <div>
          <label class="text-xs text-gray-500 font-medium uppercase tracking-wide block mb-1">Email</label>
          <input id="editContactEmail" type="email" class="w-full border border-gray-300 rounded-lg p-2.5 text-sm" placeholder="email@business.com">
        </div>
        <!-- Website -->
        <div>
          <label class="text-xs text-gray-500 font-medium uppercase tracking-wide block mb-1">Website</label>
          <input id="editContactWebsite" type="url" class="w-full border border-gray-300 rounded-lg p-2.5 text-sm" placeholder="https://www.example.com">
        </div>
        <!-- Address -->
        <div>
          <label class="text-xs text-gray-500 font-medium uppercase tracking-wide block mb-1">Address</label>
          <input id="editContactAddress" type="text" class="w-full border border-gray-300 rounded-lg p-2.5 text-sm" placeholder="123 Main St, City, State">
        </div>
        <!-- Category -->
        <div>
          <label class="text-xs text-gray-500 font-medium uppercase tracking-wide block mb-1">Business Category</label>
          <select id="editContactCategory" class="w-full border border-gray-300 rounded-lg p-2.5 text-sm bg-white">
            <option value="">Select category...</option>
          </select>
        </div>
        <!-- Social Media -->
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="text-xs text-gray-500 font-medium uppercase tracking-wide block mb-1">Facebook</label>
            <input id="editContactFacebook" type="url" class="w-full border border-gray-300 rounded-lg p-2.5 text-sm" placeholder="facebook.com/...">
          </div>
          <div>
            <label class="text-xs text-gray-500 font-medium uppercase tracking-wide block mb-1">Instagram</label>
            <input id="editContactInstagram" type="url" class="w-full border border-gray-300 rounded-lg p-2.5 text-sm" placeholder="instagram.com/...">
          </div>
        </div>
      </div>

      <div class="flex justify-end gap-2 mt-6">
        <button onclick="closeEditContactModal()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-300">Cancel</button>
        <button onclick="saveEditedContact()" class="px-4 py-2 bg-indigo-600 text-white rounded-lg text-sm font-medium hover:bg-indigo-700">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Add Activity Modal (Floating Form) -->
  <div id="addActivityModal" class="modal-backdrop hidden" role="dialog" aria-modal="true">
    <div class="modal" style="max-width: 500px;">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-bold text-gray-900">Log Activity</h3>
        <button onclick="closeAddActivityModal()" class="text-gray-400 hover:text-gray-600 text-xl">&times;</button>
      </div>

      <div class="space-y-4">
        <!-- Activity Type -->
        <div class="grid grid-cols-4 gap-2">
          <button type="button" onclick="selectActivityType('call')" data-activity-type="call" class="activity-type-btn p-3 border-2 rounded-xl text-center hover:border-indigo-500 hover:bg-indigo-50 transition">
            <div class="text-2xl mb-1">üìû</div>
            <div class="text-xs font-medium">Call</div>
          </button>
          <button type="button" onclick="selectActivityType('sms')" data-activity-type="sms" class="activity-type-btn p-3 border-2 rounded-xl text-center hover:border-indigo-500 hover:bg-indigo-50 transition">
            <div class="text-2xl mb-1">üí¨</div>
            <div class="text-xs font-medium">Text</div>
          </button>
          <button type="button" onclick="selectActivityType('email')" data-activity-type="email" class="activity-type-btn p-3 border-2 rounded-xl text-center hover:border-indigo-500 hover:bg-indigo-50 transition">
            <div class="text-2xl mb-1">‚úâÔ∏è</div>
            <div class="text-xs font-medium">Email</div>
          </button>
          <button type="button" onclick="selectActivityType('facebook')" data-activity-type="facebook" class="activity-type-btn p-3 border-2 rounded-xl text-center hover:border-indigo-500 hover:bg-indigo-50 transition">
            <div class="text-2xl mb-1">üìò</div>
            <div class="text-xs font-medium">Facebook</div>
          </button>
          <button type="button" onclick="selectActivityType('instagram')" data-activity-type="instagram" class="activity-type-btn p-3 border-2 rounded-xl text-center hover:border-indigo-500 hover:bg-indigo-50 transition">
            <div class="text-2xl mb-1">üì∑</div>
            <div class="text-xs font-medium">Instagram</div>
          </button>
          <button type="button" onclick="selectActivityType('meeting')" data-activity-type="meeting" class="activity-type-btn p-3 border-2 rounded-xl text-center hover:border-indigo-500 hover:bg-indigo-50 transition">
            <div class="text-2xl mb-1">ü§ù</div>
            <div class="text-xs font-medium">Meeting</div>
          </button>
          <button type="button" onclick="selectActivityType('note')" data-activity-type="note" class="activity-type-btn p-3 border-2 rounded-xl text-center hover:border-indigo-500 hover:bg-indigo-50 transition">
            <div class="text-2xl mb-1">üìù</div>
            <div class="text-xs font-medium">Note</div>
          </button>
        </div>

        <!-- Direction (Inbound/Outbound) -->
        <div>
          <label class="text-xs text-gray-500 font-medium uppercase tracking-wide block mb-2">Direction</label>
          <div class="flex gap-2">
            <button type="button" onclick="selectActivityDirection('outbound')" data-direction="outbound" class="direction-btn flex-1 px-4 py-2 border-2 rounded-lg text-sm font-medium hover:border-indigo-500 hover:bg-indigo-50 transition border-indigo-500 bg-indigo-50 text-indigo-700">
              Outbound (I contacted them)
            </button>
            <button type="button" onclick="selectActivityDirection('inbound')" data-direction="inbound" class="direction-btn flex-1 px-4 py-2 border-2 rounded-lg text-sm font-medium hover:border-indigo-500 hover:bg-indigo-50 transition border-gray-200">
              Inbound (They contacted me)
            </button>
          </div>
        </div>

        <!-- Outcome -->
        <div>
          <label class="text-xs text-gray-500 font-medium uppercase tracking-wide block mb-2">Outcome</label>
          <select id="activityOutcome" class="w-full border border-gray-300 rounded-lg p-2.5 text-sm">
            <option value="">‚Äî Select Outcome ‚Äî</option>
            <option value="interested">Interested - Wants to proceed</option>
            <option value="callback">Callback - Schedule follow-up</option>
            <option value="no_answer">No Answer - Try again later</option>
            <option value="voicemail">Left Voicemail</option>
            <option value="not_interested">Not Interested</option>
          </select>
        </div>

        <!-- Notes -->
        <div>
          <label class="text-xs text-gray-500 font-medium uppercase tracking-wide block mb-2">Notes</label>
          <textarea id="activityNotes" rows="3" class="w-full border border-gray-300 rounded-lg p-2.5 text-sm" placeholder="What was discussed? Any key takeaways?"></textarea>
        </div>

        <!-- Follow-up Date -->
        <div>
          <label class="text-xs text-gray-500 font-medium uppercase tracking-wide block mb-2">Follow-up Date (Optional)</label>
          <input id="activityFollowUp" type="date" class="w-full border border-gray-300 rounded-lg p-2.5 text-sm">
        </div>
      </div>

      <div class="flex gap-3 mt-6">
        <button onclick="closeAddActivityModal()" class="flex-1 px-4 py-2.5 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300">Cancel</button>
        <button onclick="saveActivity()" class="flex-1 px-4 py-2.5 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700">Save Activity</button>
      </div>
    </div>
  </div>

  <!-- Enrichment Progress Modal -->
  <div id="enrichmentModal" class="modal-backdrop hidden" role="dialog" aria-modal="true" style="z-index: 9999;">
    <div class="modal" style="max-width: 480px; border-radius: 1.5rem; overflow: hidden;">
      <!-- Gradient Header -->
      <div class="bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-500 p-6 text-white text-center">
        <div id="enrichmentIcon" class="text-5xl mb-3 animate-bounce">üîç</div>
        <h3 id="enrichmentTitle" class="text-xl font-bold">Finding Contact Info</h3>
        <p id="enrichmentSubtitle" class="text-white/80 text-sm mt-1">We're doing the tedious work so you don't have to</p>
      </div>

      <!-- Progress Section -->
      <div class="p-6 bg-white">
        <!-- Progress Bar -->
        <div class="mb-4">
          <div class="flex justify-between text-sm text-gray-600 mb-2">
            <span id="enrichmentProgressText">Enriching 0 of 0...</span>
            <span id="enrichmentPercent">0%</span>
          </div>
          <div class="h-3 bg-gray-200 rounded-full overflow-hidden">
            <div id="enrichmentProgressBar" class="h-full bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 rounded-full transition-all duration-500 ease-out" style="width: 0%"></div>
          </div>
        </div>

        <!-- Fun Message -->
        <div id="enrichmentMessage" class="text-center py-4 px-3 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl mb-4">
          <span class="text-lg">üîé</span>
          <p class="text-gray-700 font-medium mt-1">Searching the web...</p>
        </div>

        <!-- ETA & Stats -->
        <div class="grid grid-cols-2 gap-3 mb-4">
          <div class="bg-gray-50 rounded-xl p-3 text-center">
            <div class="text-2xl font-bold text-indigo-600" id="enrichmentETA">--</div>
            <div class="text-xs text-gray-500 uppercase tracking-wide">Time Remaining</div>
          </div>
          <div class="bg-gray-50 rounded-xl p-3 text-center">
            <div class="text-2xl font-bold text-green-600" id="enrichmentFound">0</div>
            <div class="text-xs text-gray-500 uppercase tracking-wide">Contacts Found</div>
          </div>
        </div>

        <!-- Value Comparison -->
        <div id="enrichmentValue" class="bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-xl p-4 text-center">
          <p class="text-sm text-green-800">
            <span class="font-bold">‚è±Ô∏è Time saved:</span>
            <span id="enrichmentTimeSaved">This would take ~2 hours manually</span>
          </p>
        </div>

        <!-- Current Business Being Processed -->
        <div id="enrichmentCurrentBusiness" class="mt-4 text-center text-sm text-gray-500">
          <span class="inline-block animate-pulse">Processing...</span>
        </div>
      </div>

      <!-- Footer -->
      <div class="px-6 py-4 bg-gray-50 border-t flex justify-between items-center">
        <button id="enrichmentCancelBtn" onclick="cancelEnrichment()" class="px-4 py-2 text-gray-600 hover:text-gray-800 text-sm font-medium">
          Cancel
        </button>
        <div id="enrichmentStatus" class="text-sm text-gray-500">
          <span class="inline-block w-2 h-2 bg-green-500 rounded-full animate-pulse mr-2"></span>
          Working...
        </div>
      </div>
    </div>
  </div>

  <!-- Old toast element removed - using ToastManager now -->


  <!-- Performance Loader (Shows loading screen to prevent perceived freezing) -->
  <script src="performance-loader.js" defer></script>

  <!-- Main Application JavaScript (Refactored) -->
  <script>document.write('<script src="app-main.js?v=' + window._v + '" defer><\/script>');</script>

  <!-- Authentication -->
  <script>document.write('<script src="auth-root.js?v=' + window._v + '"><\/script>');</script>

  <!-- PWA Service Worker - DISABLED for better iPad performance -->
  <script>
    // Unregister any existing service workers to clean up
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then(registrations => {
        registrations.forEach(registration => {
          registration.unregister();
          console.log('üßπ Service Worker unregistered for better performance');
        });
      });
    }
  </script>

  <!-- ONBOARDING WIZARD MODAL -->
  <div id="onboardingModal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-hidden">
      <!-- Header -->
      <div class="bg-gradient-to-r from-indigo-600 to-purple-600 p-6 text-white">
        <h2 class="text-2xl font-black">Welcome to 9x12 Pro!</h2>
        <p class="text-indigo-100 mt-1">Let's get you started in 60 seconds</p>
      </div>

      <!-- Step Content -->
      <div id="onboardingContent" class="p-6">
        <!-- Step 1: Welcome -->
        <div data-onboarding-step="1" class="onboarding-step">
          <div class="text-center mb-6">
            <span class="text-6xl">üöÄ</span>
            <h3 class="text-xl font-bold text-gray-900 mt-4">Your Postcard Business, Streamlined</h3>
            <p class="text-gray-600 mt-2">9x12 Pro helps you find prospects, manage your pipeline, and close more deals.</p>
          </div>
          <div class="space-y-3">
            <div class="flex items-center gap-3 p-3 bg-indigo-50 rounded-lg">
              <span class="text-2xl">üîç</span>
              <div><strong>Search</strong> - Find local businesses by ZIP code</div>
            </div>
            <div class="flex items-center gap-3 p-3 bg-purple-50 rounded-lg">
              <span class="text-2xl">üìä</span>
              <div><strong>Pipeline</strong> - Track deals with drag & drop pipeline board</div>
            </div>
            <div class="flex items-center gap-3 p-3 bg-pink-50 rounded-lg">
              <span class="text-2xl">üìÆ</span>
              <div><strong>Campaigns</strong> - Design your postcard layout</div>
            </div>
          </div>
        </div>

        <!-- Step 2: Quick Start -->
        <div data-onboarding-step="2" class="onboarding-step hidden">
          <div class="text-center mb-6">
            <span class="text-6xl">‚ö°</span>
            <h3 class="text-xl font-bold text-gray-900 mt-4">Quick Start Guide</h3>
            <p class="text-gray-600 mt-2">Follow these steps to land your first client:</p>
          </div>
          <div class="space-y-4">
            <div class="flex items-start gap-3">
              <span class="w-8 h-8 bg-indigo-600 text-white rounded-full flex items-center justify-center font-bold flex-shrink-0">1</span>
              <div>
                <strong class="block">Search for businesses</strong>
                <span class="text-sm text-gray-600">Enter a ZIP code and category to find prospects</span>
              </div>
            </div>
            <div class="flex items-start gap-3">
              <span class="w-8 h-8 bg-indigo-600 text-white rounded-full flex items-center justify-center font-bold flex-shrink-0">2</span>
              <div>
                <strong class="block">Add to Pipeline</strong>
                <span class="text-sm text-gray-600">Select businesses and start your outreach</span>
              </div>
            </div>
            <div class="flex items-start gap-3">
              <span class="w-8 h-8 bg-indigo-600 text-white rounded-full flex items-center justify-center font-bold flex-shrink-0">3</span>
              <div>
                <strong class="block">Close the deal</strong>
                <span class="text-sm text-gray-600">Use AI templates to pitch & convert to clients</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Step 3: Pro Tips -->
        <div data-onboarding-step="3" class="onboarding-step hidden">
          <div class="text-center mb-6">
            <span class="text-6xl">üí°</span>
            <h3 class="text-xl font-bold text-gray-900 mt-4">Pro Tips</h3>
            <p class="text-gray-600 mt-2">Get the most out of 9x12 Pro:</p>
          </div>
          <div class="space-y-3">
            <div class="p-3 bg-green-50 rounded-lg border border-green-200">
              <strong class="text-green-800">AI-Powered Pitches</strong>
              <p class="text-sm text-green-700">Generate personalized pitch emails tailored to each prospect's business</p>
            </div>
            <div class="p-3 bg-blue-50 rounded-lg border border-blue-200">
              <strong class="text-blue-800">Daily Goal Tracking</strong>
              <p class="text-sm text-blue-700">Set a daily outreach goal in Pipeline to stay consistent</p>
            </div>
            <div class="p-3 bg-purple-50 rounded-lg border border-purple-200">
              <strong class="text-purple-800">Facing Slip Generator</strong>
              <p class="text-sm text-purple-700">Create USPS-ready facing slips for your mailings with one click</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div class="p-4 bg-gray-50 border-t flex justify-between items-center">
        <div class="flex gap-2">
          <span id="onboardingDot1" class="w-2 h-2 rounded-full bg-indigo-600"></span>
          <span id="onboardingDot2" class="w-2 h-2 rounded-full bg-gray-300"></span>
          <span id="onboardingDot3" class="w-2 h-2 rounded-full bg-gray-300"></span>
        </div>
        <div class="flex gap-2">
          <button onclick="skipOnboarding()" class="px-4 py-2 text-gray-600 hover:text-gray-800 text-sm font-medium">Skip</button>
          <button onclick="nextOnboardingStep()" id="onboardingNextBtn" class="px-6 py-2 bg-indigo-600 text-white rounded-lg font-bold text-sm hover:bg-indigo-700">
            Next ‚Üí
          </button>
        </div>
      </div>
    </div>
  </div>

</body>
</html>
